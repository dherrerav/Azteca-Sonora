(function(){var WFEditor={_bookmark:{},getBase:function(gzip){var marker=gzip?'index.php?option=com_jce&view=editor&layout=editor&task=pack':'components/com_jce/editor/tiny_mce';var u=document.location.href;var script=tinymce.DOM.select('script[src*="'+marker+'"]')[0];if(script){var src=script.src;if(src){var base=src.substr(0,src.indexOf(marker));if(base.indexOf('/administrator/')!=-1){base=base.substr(0,base.indexOf('administrator/'))}return base.indexOf('://')==-1?u.substr(0,u.indexOf(base)+base.length):base}}return null},getSite:function(base){var u=document.location.href;var host=base.substr(base.indexOf('://')+3);var site=host.substr(host.indexOf('/'));if(u.indexOf('/administrator/')!=-1){site=site+'administrator/'}return site},init:function(settings){var self=this;var base=this.getBase(settings.compress.javascript)||'';var site=this.getSite(base);window.tinyMCEPreInit={};tinymce.extend(tinymce,{baseURL:base+'components/com_jce/editor/tiny_mce',suffix:'',query:'cid='+settings.component_id});this.settings=tinymce.extend({document_base_url:base,site_url:site,mode:'textareas',editor_selector:'wfEditor',editor_deselector:'wfNoEditor',urlconverter_callback:'WFEditor.convertURL',popup_css:false,theme:'none',invalid_elements:'applet,iframe,object,embed,script,style',plugins:''},settings);if(this.settings){try{if(this.settings.compress.css){tinymce.extend(this.settings,{content_css:false,editor_css:false})}if(this.settings.compress.javascript){this._markLoaded()}WFEditor.create()}catch(e){alert('Unable to initialize TinyMCE : '+e)}}},_markLoaded:function(){var self=this,s=this.settings,each=tinymce.each,ln=s.language.split(',');var suffix=s.suffix||'';function load(u){tinymce.ScriptLoader.markDone(tinyMCE.baseURI.toAbsolute(u))}each(ln,function(c){if(c){load('langs/'+c+'.js')}});each(s.theme.split(','),function(n){if(n){load('themes/'+n+'/editor_template'+suffix+'.js');each(ln,function(c){if(c){load('themes/'+n+'/langs/'+c+'.js')}})}});each(s.plugins.split(','),function(n){if(n){load('plugins/'+n+'/editor_plugin'+suffix+'.js');each(ln,function(c){if(c){load('plugins/'+n+'/langs/'+c+'.js')}})}})},setBookmark:function(ed){var self=this,DOM=tinymce.DOM,Event=tinymce.dom.Event;Event.add(document.body,'mousedown',function(e){var el=e.target,ta=ed.getElement();if(DOM.getParent(el,ta.id+'_parent')){return}function isHidden(ed){return ed.isHidden||DOM.getStyle(ed.id+'_ifr','visibility')=='hidden'}if(!isHidden(ed)&&ed.selection){self._bookmark[ed.id]=ed.selection.getBookmark()}})},create:function(elements){var self=this,Event=tinymce.dom.Event,s=this.settings;if(!Event.domLoaded){Event.add(document,'init',function(){self.create()});return}else{WFEditor.showLoader();tinyMCE.onAddEditor.add(function(mgr,ed){if(s.compress.css){var token=tinymce.DOM.getAttrib('wf_'+ed.id+'_token','name');ed.onPreInit.add(function(){ed.dom.loadCSS(s.site_url+'index.php?option=com_jce&view=editor&layout=editor&task=pack&type=css&context=content&cid='+s.component_id+'&'+token+'=1')})}WFEditor.hideLoader(ed.getElement());if(tinymce.isIE){self.setBookmark(ed)}});if(elements){s.mode='exact';s.elements=elements}try{if(s.theme!='none'){this.toggle(elements)}tinyMCE.init(s)}catch(e){alert(e)}}},toggle:function(elements){var self=this,DOM=tinymce.DOM,Event=tinymce.dom.Event,s=this.settings;tinymce.each(DOM.select('.wfEditor'),function(el){var state=s.editor_state||1;var cookie=tinymce.util.Cookie.get('wf_editor_'+el.id+'_state');var use_cookies=(s.use_cookies=='undefined')?true:s.use_cookies;if(parseInt(state)==0){el.className='wfNoEditor'}else{if(parseInt(cookie)==0){el.className='wfNoEditor'}else{el.className='wfEditor'}}if(parseInt(state)==1){var div=DOM.create('span',{'role':'button','class':'wf_editor_toggle','aria-labelledby':'wf_editor_'+el.id+'_toggle'},'<span id="wf_editor_'+el.id+'_toggle">[show/hide]</span>');DOM.setStyle(div,'cursor','pointer');el.parentNode.insertBefore(div,el);Event.add(div,'click',function(e){var ed=tinyMCE.get(el.id);if(!ed){if(use_cookies){tinymce.util.Cookie.set('wf_editor_'+el.id+'_state',1)}el.className='wfEditor';tinyMCE.execCommand('mceAddControl',0,el.id)}else{if(ed.isHidden()){if(use_cookies){tinymce.util.Cookie.set('wf_editor_'+el.id+'_state',1)}el.className='wfEditor';ed.load();ed.show()}else{if(use_cookies){tinymce.util.Cookie.set('wf_editor_'+el.id+'_state',0)}el.className='wfNoEditor';ed.save();ed.hide()}}})}})},showLoader:function(el){tinymce.DOM.addClass('.wfEditor','loading')},hideLoader:function(el){tinymce.DOM.removeClass(el,'loading')},setContent:function(id,html){var ed=tinyMCE.get(id);if(ed){ed.setContent(html)}else{document.getElementById(id).value=html}},getContent:function(id){var ed=tinyMCE.get(id);if(ed){return ed.getContent()}return document.getElementById(id).value},save:function(id){tinyMCE.triggerSave()},insert:function(el,v){var bm,ed;if(typeof el=='string'){el=document.getElementById(el)}if(/wfEditor/.test(el.className)){ed=tinyMCE.get(el.id);if(tinymce.isIE){if(window.parent.tinymce){var ed=window.parent.tinyMCE.get(el.id);if(ed){if(this._bookmark[ed.id]){ed.selection.moveToBookmark(this._bookmark[ed.id])}}}}ed.execCommand('mceInsertContent',false,v,true)}else{this.insertIntoTextarea(el,v)}},insertIntoTextarea:function(el,v){if(document.selection){el.focus();var s=document.selection.createRange();s.text=v}else{if(el.selectionStart||el.selectionStart=='0'){var startPos=el.selectionStart;var endPos=el.selectionEnd;el.value=el.value.substring(0,startPos)+v+el.value.substring(endPos,el.value.length)}else{el.value+=v}}},convertURL:function(u,e,save){var ed=tinymce.EditorManager.activeEditor,s=tinymce.settings,base=s.document_base_url;if(!u)return u;if(!s.convert_urls||(e&&e.nodeName=='LINK')||u.indexOf('file:')===0)return u;if(u==base||u==base.substring(0,base.length-1)||u.charAt(0)=='/'){return u}if(s.relative_urls)return ed.documentBaseURI.toRelative(u);u=ed.documentBaseURI.toAbsolute(u,s.remove_script_host);return u}};window.WFEditor=WFEditor})();