var idProperties;identity=identity||{};var identityOnloadCallbacks=[],identityLoaded=false;var runIdentityOnloadCallbacks=function(){var A;for(A in identityOnloadCallbacks){identityOnloadCallbacks[A]();delete identityOnloadCallbacks[A]}};identity.onLoad=function(){return function(B){if(typeof B=="function"){if(identityLoaded){B();return true}else{var A=identityOnloadCallbacks.length;identityOnloadCallbacks[A]=B;return A}}return false}}();identity.status=function(){var K={},G,E,I,D,N={},B=false,S,H={},F,A,R=false;idProperties.panelAppearTimeout=8000;idProperties.panelActionTimeout=8000;idProperties.css_id_status="id-status";idProperties.css_element_status=["#",idProperties.css_id_status].join("");idProperties.css_element_status_allLinks=["#",idProperties.css_id_status," a"].join("");idProperties.css_element_status_allPtrtLinks=["#",idProperties.css_id_status," a.has-ptrt"].join("");idProperties.css_element_status_signinLink=["#",idProperties.css_id_status," a#idSignin"].join("");idProperties.css_element_status_registerLink=["#",idProperties.css_id_status," a#idRegister"].join("");idProperties.css_element_status_settingsLink=["#",idProperties.css_id_status," a#idSettings"].join("");idProperties.css_element_status_signoutLink=["#",idProperties.css_id_status," a#idSignout"].join("");idProperties.url_status="/users/widget/status";var Q=function(){if(N.signin){D(N.signin)}};var J=function(){if(B){identity.app.parseStatusLinks()}else{Q();var V=E(idProperties.css_element_status_signinLink);if(V){I(V,"mousedown",function(W){identity.status.mousepressed=true});N.signin=I(V,"click",function(W){if(identity.status.mousepressed){W.preventDefault();Q();if(!identity.status.hasChanged()){M("signin",W)}}})}}};var M=function(X,V){if(B){L(X,V)}else{identity.status.showSpinner();if(typeof V!="undefined"&&idProperties.env!="sandbox"&&idProperties.env!="dev"){S=setTimeout(function(){try{window.location=V.source.href}catch(Y){}},idProperties.panelAppearTimeout)}var W=G.dom.create('<div class="id-panel-css-load-test"></div>');E("body").append(W);if(typeof identity.app!="undefined"&&"init" in identity.app&&typeof identity.cta!="undefined"&&"init" in identity.cta&&typeof identity.util!="undefined"&&"init" in identity.util&&typeof idPanelObj!="undefined"&&"init" in idPanelObj&&typeof idInfoPanelObj!="undefined"&&"init" in idInfoPanelObj&&typeof identity.forms!="undefined"&&"init" in identity.forms&&W.width()==50){if(idProperties.env!="sandbox"&&idProperties.env!="dev"){clearTimeout(S)}T();identity.status.hideSpinner();identity.app.init(G,V);idPanelObj.init(G);idInfoPanelObj.init(G);identity.forms.init(G);B=true;L(X,V)}}};var L=function(V,W){switch(V){case"signin":identity.app.showPanel("signin",W);break;default:break}};var T=function(){var V;for(V in N){G.events.removeListener(N[V])}};var O=function(){identity.addSigninHandler=function(V){return I(identity,"signin",V)};identity.addSigninCancelHandler=function(V){return I(identity,"signinCancel",V)};identity.addStatusbarRefreshHandler=function(V){return I(identity,"statusbarRefresh",V)};identity.removeHandler=function(V){D(V)};identity.showSigninPanel=function(V){M("signin",V)};identity.setStatusbarPtrt=function(V,X){if(A){identity.removeHandler(A);A=null}if(typeof X!="boolean"){X=true}var W=function(){U(V)};W();if(X){A=identity.addStatusbarRefreshHandler(function(){W()})}return true};identity.setStatusbarEnv=function(V){if(typeof V==null||typeof V==undefined||V==""||V=="dev"||V=="sandbox"||V=="int"||V=="test"||V=="stage"||V=="live"){F=V;identity.status.refresh();return true}else{return false}};identity.removeSigninHandler=identity.removeHandler;identity.removeSigninCancelHandler=identity.removeHandler;identity.removeStatusbarRefreshHandler=identity.removeHandler;identity.addLoginHandler=identity.addSigninHandler;identity.removeLoginHandler=identity.removeSigninHandler;identity.showLoginPanel=identity.showSigninPanel;identity.addLoginCancelHandler=identity.addSigninCancelHandler;identity.removeLoginCancelHandler=identity.removeSigninCancelHandler};var P=function(){I(identity,"signin",function(){G.events.fire(identity,"login")})};var U=function(X){var Z=E(idProperties.css_element_status_allPtrtLinks),W=Z.length;if(!X){while(W--){Z[W].href=C(Z[W].href);Z[W].href+=("&ptrt="+encodeURIComponent(window.location.href))}}else{if(typeof (X)=="string"){while(W--){Z[W].href=C(Z[W].href);Z[W].href+=("&ptrt="+encodeURIComponent(X))}}else{if(typeof (X)=="object"){var V,Y;for(V in X){switch(V){case"register":Y=E(idProperties.css_element_status_registerLink);break;case"signin":Y=E(idProperties.css_element_status_signinLink);break;case"settings":Y=E(idProperties.css_element_status_settingsLink);break;case"signout":Y=E(idProperties.css_element_status_signoutLink);break;default:Y=[];break}if(Y.length&&Y.is("a")){Y[0].href=C(Y[0].href);Y[0].href+=("&ptrt="+encodeURIComponent(X[V]))}}}}}};var C=function(X){var W=X.split("?"),Y="",V;args=identity.util.getArgsFromUrl(X);delete args.ptrt;for(V in args){Y+=((Y=="")?"":"&")+V+"="+args[V]}return W[0]+"?"+Y};K.mousepressed=false;K.refresh=function(){identity.status.showSpinner();var V=(E("#id-status.id-gel").length>0)?"?renderGel":"";G.net.get([idProperties.url_status,(F?"/"+F:""),V].join(""),{onLoad:function(W){identity.status.hideSpinner();E(idProperties.css_element_status).after(G.dom.create(W.text())).remove();J();identity.cta.parseLinks();H=identity.status.getUserStatus();identity.user.refresh();identity.statusbar.init(G);G.events.fire(identity,"statusbarRefresh")}})};K.showSpinner=function(){E(idProperties.css_element_status).addClass("id-status-working")};K.hideSpinner=function(){E(idProperties.css_element_status).removeClass("id-status-working")};K.getUserStatus=function(){var V,W={},X=identity.util.getCookie("IDENTITY");V=X?X.split("%7C"):null;if(X!=V&&V.length==4){W.username=X[1];W.userid=X[0];W.status="loggedin"}else{W.username="";W.status="loggedout";W.userid=0}return W};K.hasChanged=function(X){var Z,V=(typeof X!="undefined"&&X.suppressActions)?true:false,W=identity.status.getUserStatus();Z=((W.status!=H.status)||(W.userid!=H.userid))?true:false;if(Z&&!V){var Y;if(W.status=="loggedin"){Y=new G.events.Event();G.events.fire(identity,"signin",Y)}}H=W;return Z};K.loadAndShowPanel=function(V,W){if(typeof W!="string"){W=false}M(W,V)};K.enableJavaScript=function(){if(R){return }identity.util.init(G);identity.cta.init(G);J();identity.cta.parseLinks();O();P();identity.addSigninHandler(function(V){identity.status.refresh()});R=true;identityLoaded=true;runIdentityOnloadCallbacks()};K.init=function(V){G=V;E=G.dom.get;I=G.events.addListener;D=G.events.removeListener;H=identity.status.getUserStatus();if(!G.isSupported||navigator.userAgent.match(/^.*mobile.*$/i)||navigator.userAgent.match(/^.*blackberry.*$/i)||navigator.userAgent.match(/^.*opera mini.*$/i)||navigator.userAgent.match(/^.*windows ce.*$/i)||(navigator.userAgent.match(/^.*ppc.*$/i)&&!navigator.userAgent.match(/^.*ppc\smac.*$/i))||navigator.userAgent.match(/^.*symbian.*$/i)||navigator.userAgent.match(/^.*avantgo.*$/i)||navigator.userAgent.match(/^.*opera mini.*$/i)||navigator.userAgent.match(/^.*wii.*$/i)||navigator.userAgent.match(/^.*playstation.*$/i)){return }identity.onLoad(function(){identity.setStatusbarPtrt()});if(idProperties.dynamicServer==window.location.protocol+"//"+window.location.hostname||idProperties.env=="stage"||idProperties.env=="live"){identity.status.enableJavaScript()}else{U()}};K.showDisplayName=function(){var V=decodeURIComponent(identity.util.getCookie("IDENTITY").replace("+"," ")).split("|");E("#idUsername").text(V[2]||V[1])};return K}();identity.cta=function(){var G,K,B,H,A={},F,D="IDENTITY",J="IDENTITY_ENV",N=[];var L="/users/authorized.bool";var I=function(Q,P){if(!P){P={}}if(typeof P.onSuccess!="function"){P.onSuccess=function(){}}if(typeof P.onFailure!="function"){P.onFailure=function(){}}var O=M(Q);K.net.get([L,"?url=",O].join(""),{onLoad:function(S){var R=S.text();if(R=="0"){P.onFailure()}else{if(R=="1"){P.onSuccess()}}}})};var E=function(P){var Q=P.split("?");if(!Q[1]||Q[2]){return false}var O=K.data.decodeUrl(Q[1]);return O.ptrt||false};var M=function(P){var Q=P.split("?");if(!Q[1]||Q[2]){return window.location.href}var O=K.data.decodeUrl(Q[1]);return O.target_resource||O.ptrt||window.location.href};var C=function(){var Q=function(R){F=R};var O=identity.util.getCookie(D);var P=F;if(typeof F=="undefined"){Q(O);return 2}else{if(O==P){return false}else{Q(O);return true}}};A.parseLinks=function(){var O=G("a.id-cta").filter(function(Q){var P=G(this).attr("href");if(P.match(/((^https?:\/\/(www|id|www\.int|id\.int|www\.test|id\.test|www\.stage|id\.stage|pal\.sandbox\.dev)\.bbc\.co\.uk)|^)?\/users\/(login|signin)\/?.*/i)){return true}else{return false}});for(l in N){H(N[l])}N=[];O.each(function(Q){var P=G(this);N[N.length]=B(P,"click",function(T){T.preventDefault();var S=E(P.attr("href"));var R=M(P.attr("href"));if(identity.user.signedIn){if(S){window.location.href=S}else{K.events.fire(identity,"signin")}}else{G(T.attachedTo).addClass("id-cta-working");identity.showSigninPanel(T);var U;U=identity.addSigninHandler(function(){identity.removeSigninHandler(U);if(S){window.location.href=S}else{P.removeClass("id-cta-working")}});identity.addSigninCancelHandler(function(){G(T.attachedTo).removeClass("id-cta-working");identity.removeSigninHandler(U)})}})})};A.init=function(O){K=O;G=K.dom.get;B=K.events.addListener;H=K.events.removeListener;C()};return A}();identity.util=function(){var C={},E,D,A,B;C.authorized=function(G){var F=E.net.get(["/users/authorized.bool?url=",G].join(""),{async:false});try{if(F.text()==1){return true}}catch(H){}return false};C.setCookie=function(H,I,J){var F,G;if(J){G=new Date();G.setTime(G.getTime()+(J*24*60*60*1000));F=[";expires=",G.toGMTString()].join("")}else{F=""}document.cookie=[H,"=",I,F,";path=/;domain=.bbc.co.uk"].join("")};C.getCookie=identity.util.getCookie;C.deleteCookie=function(F){identity.util.setCookie(F,"",-1)};C.getArgsFromUrl=function(I){var J,H=[],K="",L=I.split("?");if(L.length>1){var F="",G;for(G in L){if(G!=0){F+=((F=="")?"":"?")+L[G]}}L=[L[0],F];K=L[1].split("&");if(K.length>=1){for(J in K){argParts=K[J].split("=");H[argParts[0]]=argParts[1]}}}return H};C.random=function(J){var H="";var I="bcdfghjklmnpqrstvwxyzBCDFGHJKLMNPQRSTVWXYZ0123456789";for(var G=0;G<J;G++){var F=new Date();H=[H,I.charAt(Math.floor(Math.random(F.getTime())*I.length))].join("")}return H};C.var_dump=function(N,H,F){var I="";if(!H){H=20}if(!F){F=1}var G="  ";var L="";for(var J=0;J<F;J++){L=[L,G].join("")}if(typeof (N)=="object"){I=[I,"{\n"].join("");var K=true,M;for(M in N){I=[I,(F>=H)?"...":L,'"',M,'": ',var_dump(N[M],H,F+1),",\n"].join("");K=false}if(K){I=[I.substr(0,I.length-1),"}"].join("")}else{I=[I.substr(0,I.length-2),"\n",L.substr(0,L.length-G.length),"}"].join("")}}else{if(typeof (N)=="string"){I=[I,('"'+N+'"')].join("")}else{if(typeof (N)=="boolean"){I=[I,(N?"true":"false")].join("")}else{if(typeof (N)=="function"){I=[I,"function"].join("")}else{I=[I,(N)].join("")}}}}return I};C.getScrollPosition=function(G){if(typeof G=="undefined"){G=""}var F=0,H=0;if(typeof (window.pageYOffset)=="number"){F=window.pageXOffset;H=window.pageYOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){F=document.body.scrollLeft;H=document.body.scrollTop}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){F=document.documentElement.scrollLeft;H=document.documentElement.scrollTop}}}if(G=="x"){return F}else{if(G=="y"){return H}else{return{x:F,y:H}}}};C.init=function(F){E=F;D=E.dom.get;A=E.events.addListener;B=E.events.removeListener;if(!("console" in window)){window.console=function(){var H={},K,J,I,G=false;H.enable=function(){G=true};H.disable=function(){G=false};H.clear=function(){I.empty()};H.log=function(L){if(G){if(typeof (I)=="undefined"){I=K.dom.create('<p id="console-log" style="position: fixed; bottom: 0; left: 0; height: 100px; width: 100%; overflow-y: auto; overflow-x: noscroll;background: white;border-top: 1px solid gray;"></p>');J("body").append(I);J("body").css("padding-bottom","100px");if(K.env.ie&&K.env.ie<=6){J("#console-log").css("position","absolute");setInterval(function(){I.css("height","99px");I.css("height","100px")},250)}}I.append([L,"<br />"].join(""));I[0].scrollTop=I[0].scrollHeight}};H.init=function(L){K=L;J=K.dom.get};return H}();console.init(E)}};return C}();if(gloader&&gloader.load){gloader.load(["glow","1","glow.anim","glow.dom","glow.net","glow.widgets","glow.widgets.Panel","glow.widgets.InfoPanel","glow.forms"],{onLoad:function(A){A.ready(function(){try{identity.status.init(A)}catch(B){console.log(B)}})},async:true})}if(identity&&identity.statusbar&&identity.statusbar.scriptLoadCallback){identity.statusbar.scriptLoadCallback("id-status.js")};