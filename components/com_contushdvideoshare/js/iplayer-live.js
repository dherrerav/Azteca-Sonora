require.pause();
var glow;
require.def("iplayer/begin",function(){var k={config:{},controllers:{},events:{},models:{ishout:{}},views:{},utils:{events:{}},net:{},localisation:{},tokens:[]},f={controllers:{},models:{},views:{},services:{},utils:{}};window.iplayer=window.iplayer||k;window.radioplayer=window.radioplayer||f;k=function(){};if(!window.console)window.console={log:k,debug:k,info:k,warn:k,error:k,assert:k,alert:k,dir:k,dirxml:k,trace:k,group:k,groupCollapsed:k,groupEnd:k,time:k,timeEnd:k,profile:k,profileEnd:k,count:k}});
require.def("iplayer/modules/bootstrap",["iplayer/begin","iplayer/models/config","pal/config","iplayer/utils/utils","iplayer/events","iplayer/net","iplayer/utils/events","iplayer/utils/queue","iplayer/models/cookie","iplayer/models/useragent","iplayer/end"],function(){return iplayer});
require.def("iplayer/models/config",["iplayer/begin"],function(){var k={drawerLoadAttemps:3,cookie:{name:"BBCiPlayer",expires:90,key:{consoleSize:"consolesize",labs:"labs",empSize:"empsize",audioBandwidth:"ab",lastFavouriteModified:"fm",recentlyPlayedModified:"rp",isActive:"ia",hasTvLicense:"htl"},session:{name:"BBCiPlayerSession",key:{videoBandwidth:"vb"}}},ctaOverlay:'<div id="cta-overlay" class="cta-overlay {style}" > <a href="{my_url}" class="cta-play {extra_class}"><span>Play {title}</span><img src="{img_source}" width="{img_width}" height="{img_height}" /></a><h1><a href="{my_url}" title="{fullTitle}">{title}</a></h1><h2>{subtitle}</h2><p>{description}</p></div>',
root:function(){var f=/^[^:]+:\/\/[^\/]+(\/[^\/]+)(?:\/(en|cy|gd))?/.exec(window.location.href);return f[1]+"/"+(f[2]?f[2]:"en")+"/"}()};return glow.lang.apply(iplayer.config,k)});
require.def("pal/config",["iplayer/begin","iplayer/models/config"],function(){glow.lang.apply(iplayer.config,{bguid:{url:"http://stats.bbc.co.uk/setbguid"},identity:{bbcIdUrl:"https://id.bbc.co.uk/users",loginUrl:"https://id.bbc.co.uk/users/signin/"},pelican:{serviceUrl:"https://www.bbc.co.uk/iplayer/xdomainpost"},choicestream:{serviceUrl:"http://api.choicestream.com/instr/api?json={json}",enabled:"1",apiKey:"6a1543716fd5e5fe"},mediaselector:{assetRequestUrl:"http://open.live.bbc.co.uk/mediaselector/4/jsfunc",
bitrateSway:"60",bitrate:{computerWMV:"850",mobileWMV:"528",aac:"50"}},help:{baseURL:"http://iplayerhelp.external.bbc.co.uk/help/"},electra:{version:"3.0",flashVersionRequired:{mac:{major:"9",minor:"0",release:"115",full:"9.0.115"},win:{major:"9",minor:"0",release:"115",full:"9.0.115"},linux:{major:"10",minor:"0",release:"15",full:"10.0.15"}},debug:""},emp:{baseUrl:"http://www.bbc.co.uk",flashVersionRequired:{major:"9",minor:"0",release:"115",full:"9.0.115"},consoleStationsAnimationUrl:"http://www.bbc.co.uk/emp/channelbrands/{stationId}.swf"},
emp_mp3:{flashVersionRequired:{major:"7",minor:"0",release:"0",full:"7.0.0"}},desktop:{baseUrl:"http://www.bbc.co.uk/iplayer/dm/version2/"},flow:{loginUrl:"https://www.bbc.co.uk/settings/people?appId=iplayer&appPtrt={ptrt}",findOutMoreUrl:"http://iplayerhelp.external.bbc.co.uk/help/information/how_to_tips?theVid=p008dw0r#"},upsell:{favouritesRadioConsolePid:"p007cfkf"},talkback:{url:"https://talkback.live.bbc.co.uk/useractivity/"},migration:{enabled:"1"},radio:{useConsole:""},radioplayer:{server:{iframeProxy:{url:"http://radioplayerdev.uniqueinteractive.com/radioplayer-jr/serverproxy.html"},
iframe:{url:"http://radioplayerdev.uniqueinteractive.com/radioplayer-jr/server.html"},hostname:"http://radioplayerdev.uniqueinteractive.com"}},titling:{listing:{_filter:{title:{lines:1,count:35},subtitle:{lines:1,count:70},description:{lines:2,count:134}},e:{time:"h:ia",title:"{xtitle}",subtitle:"",description:"{short_synopsis}"},"b-e":{time:"h:ia",title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-e":{time:"h:ia",title:"{brand_title} - {series_title}",subtitle:"{xtitle}",
description:"{short_synopsis}"},"s-e":{time:"h:ia",title:"{series_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-ss-e":{time:"h:ia",title:"{brand_title} - {series_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"},"s-ss-e":{time:"h:ia",title:"{series_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"}},"listing-brand-title":{_filter:{title:{lines:2,count:32}},e:{title:"{title}"},"b-e":{title:"{brand_title}"},"b-s-e":{title:"{brand_title}"},"s-e":{title:"{series_title}"},
"b-s-ss-e":{title:"{brand_title}"},"s-ss-e":{title:"{series_title}"}},"drawers-a":{_filter:{title:{lines:3,count:35},subtitle:{lines:2,count:40},description:{lines:3,count:200}},e:{title:"{xtitle}",subtitle:"{short_synopsis}",description:"{synopsis}"},"b-e":{title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-e":{title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"s-e":{title:"{series_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-ss-e":{title:"{brand_title}",
subtitle:"{xmetatitle}",description:"{short_synopsis}"},"s-ss-e":{title:"{series_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"}},"drawers-b":{_filter:{title:{lines:2,count:23},subtitle:{lines:1,count:18},description:{lines:2,count:70}},e:{title:"{xtitle}",subtitle:"",description:"{short_synopsis}"},"b-e":{title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-e":{title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"s-e":{title:"{series_title}",
subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-ss-e":{title:"{brand_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"},"s-ss-e":{title:"{series_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"}},"favourites-bar":{_filter:{title:{lines:1,count:21},subtitle:{lines:1,count:21},multi_episode_link:{lines:1,count:21},description:{lines:3,count:69}},e:{title:"{xtitle}",subtitle:"{xtitle}",multi_episode_link:"",description:"{short_synopsis}"},"b-e":{title:"{brand_title}",
subtitle:"{xtitle}",multi_episode_link:"",description:"{short_synopsis}"},"b-s-e":{title:"{brand_title}",subtitle:"{xtitle}",multi_episode_link:"",description:"{short_synopsis}"},"s-e":{title:"{series_title}",subtitle:"{xtitle}",multi_episode_link:"",description:"{short_synopsis}"},"b-s-ss-e":{title:"{brand_title}",subtitle:"{xmetatitle}:",multi_episode_link:"",description:"{short_synopsis}"},"s-ss-e":{title:"{series_title}",subtitle:"{xmetatitle}:",multi_episode_link:"",description:"{short_synopsis}"}},
item:{_filter:{title:{lines:1,count:70},subtitle:{lines:1,count:95}},e:{title:"{xtitle}",subtitle:""},"b-e":{title:"{brand_title}",subtitle:"{xtitle}"},"b-s-e":{title:"{brand_title} - {series_title}",subtitle:"{xtitle}"},"s-e":{title:"{series_title}",subtitle:"{xtitle}"},"b-s-ss-e":{title:"{brand_title}",subtitle:"{series_title}: {xmetatitle}"},"s-ss-e":{title:"{series_title}",subtitle:"{xmetatitle}"}},"drawers-c":{_filter:{heading:{lines:1,count:30},title:{lines:1,count:22},subtitle:{lines:1,count:23},
description:{lines:2,count:70}},e:{heading:"{xtitle}",title:"{xtitle}",subtitle:"",description:""},"b-e":{heading:"{brand_title}",title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-e":{heading:"{brand_title}",title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"s-e":{heading:"{series_title}",title:"{series_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-ss-e":{heading:"{brand_title}",title:"{brand_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"},
"s-ss-e":{heading:"{series_title}",title:"{series_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"}},"drawers-d":{_filter:{title:{lines:1,count:20},subtitle:{lines:1,count:20},description:{lines:2,count:70}},e:{title:"{xtitle}",subtitle:"",description:"{short_synopsis}"},"b-e":{title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-e":{title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"s-e":{title:"{series_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},
"b-s-ss-e":{title:"{brand_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"},"s-ss-e":{title:"{series_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"}},"favourites-manager":{_filter:{header:{lines:1,count:30},title:{lines:2,count:30},description:{lines:2,count:84},lastplayed_title:{lines:2,count:60},lastplayed_subtitle:{lines:1,count:30}},e:{header:"{xtitle}",title:"{xtitle}",description:"{short_synopsis}",lastplayed_title:"{xtitle}",lastplayed_subtitle:""},"b-e":{header:"{brand_title} {xtitle}",
title:"{xtitle}",description:"{short_synopsis}",lastplayed_title:"{brand_title}",lastplayed_subtitle:"{xtitle}"},"b-s-e":{header:"{brand_title} {xtitle}",title:"{xtitle}",description:"{short_synopsis}",lastplayed_title:"{brand_title} {series_title}",lastplayed_subtitle:"{xtitle}"},"s-e":{header:"{series_title} {xtitle}",title:"{xtitle}",description:"{short_synopsis}",lastplayed_title:"{series_title}",lastplayed_subtitle:"{xtitle}"},"b-s-ss-e":{header:"{brand_title} {xmetatitle}:",title:"{xmetatitle}:",
description:"{short_synopsis}",lastplayed_title:"{brand_title} {series_title}",lastplayed_subtitle:"{xmetatitle}"},"s-ss-e":{header:"{series_title} {xmetatitle}",title:"{xmetatitle}",description:"{short_synopsis}",lastplayed_title:"{series_title}",lastplayed_subtitle:"{xmetatitle}"}},"categories-large":{_filter:{title:{lines:1,count:25},subtitle:{lines:3,count:75},description:{lines:2,count:70}},e:{title:"{xtitle}",subtitle:"",description:"{short_synopsis}"},"b-e":{title:"{brand_title}",subtitle:"{xtitle}",
description:"{short_synopsis}"},"b-s-e":{title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"s-e":{title:"{series_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-ss-e":{title:"{brand_title}",subtitle:"{xmetatitle} - {xtitle}: ",description:"{short_synopsis}"},"s-ss-e":{title:"{series_title}",subtitle:"{xmetatitle} - {xtitle}: ",description:"{short_synopsis}"}},"categories-small":{_filter:{title:{lines:1,count:16},subtitle:{lines:3,count:48},description:{lines:2,
count:70}},e:{title:"{xtitle}",subtitle:"",description:"{short_synopsis}"},"b-e":{title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-e":{title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"s-e":{title:"{series_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-ss-e":{title:"{brand_title}",subtitle:"{xmetatitle} - {xtitle}: ",description:"{short_synopsis}"},"s-ss-e":{title:"{series_title}",subtitle:"{xmetatitle} - {xtitle}: ",description:"{short_synopsis}"}},
"listing-small":{_filter:{title:{lines:2,count:32},subtitle:{lines:1,count:18},description:{lines:2,count:134}},e:{time:"h:ia",title:"{xtitle}",subtitle:"",description:"{short_synopsis}"},"b-e":{time:"h:ia",title:"{brand_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-e":{time:"h:ia",title:"{brand_title} - {series_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"s-e":{time:"h:ia",title:"{series_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-ss-e":{time:"h:ia",
title:"{brand_title} - {series_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"},"s-ss-e":{time:"h:ia",title:"{series_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"}},"radio-console-nowplaying-now":{_filter:{title:{lines:1,count:26},subtitle:{lines:999,count:999},description:{lines:3,count:90}},e:{title:"{xtitle}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"b-s-e":{title:"{brand_title}",
subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"s-e":{title:"{series_title}",subtitle:"{series_title} : {xtitle}",description:"{short_synopsis}"},"b-s-ss-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"s-ss-e":{title:"{series_title}",subtitle:"{series_title} : {xtitle}",description:"{short_synopsis}"}},"radio-console-nowplaying-next":{_filter:{title:{lines:1,count:26},subtitle:{lines:999,count:999},description:{lines:2,count:50}},
e:{title:"{xtitle}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"b-s-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"s-e":{title:"{series_title}",subtitle:"{series_title} : {xtitle}",description:"{short_synopsis}"},"b-s-ss-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"s-ss-e":{title:"{series_title}",
subtitle:"{series_title} : {xtitle}",description:"{short_synopsis}"}},"radio-console-nowplaying-aod":{_filter:{title:{lines:1,count:26},subtitle:{lines:999,count:999},description:{lines:4,count:90}},e:{title:"{xtitle}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"b-s-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"s-e":{title:"{series_title}",subtitle:"{series_title} : {xtitle}",
description:"{short_synopsis}"},"b-s-ss-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"s-ss-e":{title:"{series_title}",subtitle:"{series_title} : {xtitle}",description:"{short_synopsis}"}},"radio-console-more":{_filter:{title:{lines:1,count:36},subtitle:{lines:999,count:999},description:{lines:2,count:90}},e:{title:"{xtitle}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-e":{title:"{xtitle}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},
"b-s-e":{title:"{xtitle}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"s-e":{title:"{xtitle}",subtitle:"{series_title} : {xtitle}",description:"{short_synopsis}"},"b-s-ss-e":{title:"{xtitle}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"s-ss-e":{title:"{xtitle}",subtitle:"{series_title} : {xtitle}",description:"{short_synopsis}"}},"radio-console-favourite-item":{_filter:{title:{lines:1,count:25},subtitle:{lines:999,count:999},description:{lines:1,count:36}},
e:{title:"{xtitle}",subtitle:"{xtitle}",description:"{xtitle}"},"b-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{xtitle}"},"b-s-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{xtitle}"},"s-e":{title:"{series_title}",subtitle:"{series_title} : {xtitle}",description:"{xtitle}"},"b-s-ss-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{xtitle}"},"s-ss-e":{title:"{series_title}",subtitle:"{series_title} : {xtitle}",description:"{xtitle}"}},
"radio-console-foryou-item":{_filter:{title:{lines:1,count:25},subtitle:{lines:999,count:999},description:{lines:2,count:90}},e:{title:"{xtitle}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-e":{title:"{brand_title} : {xtitle}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"b-s-e":{title:"{brand_title} : {xtitle}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"s-e":{title:"{series_title} : {xtitle}",subtitle:"{series_title} : {xtitle}",description:"{short_synopsis}"},
"b-s-ss-e":{title:"{brand_title} : {xtitle}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"s-ss-e":{title:"{series_title} : {xtitle}",subtitle:"{series_title} : {xtitle}",description:"{short_synopsis}"}},"radio-console-stations-now-hover":{_filter:{title:{lines:1,count:55},subtitle:{lines:5,count:55},description:{lines:4,count:50}},e:{title:"{xtitle}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},
"b-s-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"s-e":{title:"{series_title}",subtitle:"{series_title} : {xtitle}",description:"{short_synopsis}"},"b-s-ss-e":{title:"{brand_title}",subtitle:"{brand_title} : {xtitle}",description:"{short_synopsis}"},"s-ss-e":{title:"{series_title}",subtitle:"{series_title} : {xtitle}",description:"{short_synopsis}"}},"radio-player-item":{_filter:{title:{lines:1,count:32},subtitle:{lines:1,count:32},synopsis:{lines:5,
count:180}},e:{title:"{xtitle}",subtitle:"",time:"G:i l, jS F",synopsis:"{short_synopsis}"},"b-e":{title:"{brand_title}",subtitle:"{xtitle_strip_date}",time:"G:i l, jS F",synopsis:"{short_synopsis}"},"b-s-e":{title:"{xtitle_remove_series_text}",time:"G:i l, jS F",subtitle:"{xtitle_strip_date}",synopsis:"{short_synopsis}"},"s-e":{title:"{series_title}",subtitle:"{xtitle_strip_date}",time:"G:i l, jS F",synopsis:"{short_synopsis}"},"b-s-ss-e":{title:"{brand_title}",subtitle:"{series_title}: {xmetatitle}",
time:"G:i l, jS F",synopsis:"{short_synopsis}"},"s-ss-e":{title:"{series_title}",subtitle:"{xmetatitle}",time:"G:i l, jS F",synopsis:"{short_synopsis}"}},"radio-player-sub-item":{_filter:{title:{lines:1,count:25},subtitle:{lines:1,count:25},synopsis:{lines:3,count:180}},e:{title:"{xtitle}",subtitle:"",time:"H:i",synopsis:"{short_synopsis}"},"b-e":{title:"{brand_title}",subtitle:"{xtitle_strip_date}",time:"H:i",synopsis:"{short_synopsis}"},"b-s-e":{title:"{xtitle_remove_series_text}",time:"H:i",subtitle:"{xtitle_strip_date}",
synopsis:"{short_synopsis}"},"s-e":{title:"{series_title}",subtitle:"{xtitle_strip_date}",time:"H:i",synopsis:"{short_synopsis}"},"b-s-ss-e":{title:"{brand_title}",subtitle:"{series_title}: {xmetatitle}",time:"H:i",synopsis:"{short_synopsis}"},"s-ss-e":{title:"{series_title}",subtitle:"{xmetatitle}",time:"H:i",synopsis:"{short_synopsis}"}},atoz:{_filter:{title:{lines:1,count:32},toplevel_container_title:{lines:1,count:32}},e:{time:"h:ia",title:"{xtitle}",toplevel_container_title:"{toplevel_container_title}",
subtitle:"",description:"{short_synopsis}"},"b-e":{time:"h:ia",title:"{brand_title}",toplevel_container_title:"{toplevel_container_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"b-s-e":{time:"h:ia",title:"{brand_title} - {series_title}",toplevel_container_title:"{toplevel_container_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},"s-e":{time:"h:ia",title:"{series_title}",toplevel_container_title:"{toplevel_container_title}",subtitle:"{xtitle}",description:"{short_synopsis}"},
"b-s-ss-e":{time:"h:ia",title:"{brand_title} - {series_title}",toplevel_container_title:"{toplevel_container_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"},"s-ss-e":{time:"h:ia",title:"{series_title}",toplevel_container_title:"{toplevel_container_title}",subtitle:"{xmetatitle}",description:"{short_synopsis}"}}}})});
require.def("iplayer/models/cookie",["iplayer/begin","iplayer/models/config"],function(){var k=function(){function f(n){return!!(typeof n==="string"&&n.length>0)}function g(n){return typeof n!=="undefined"}function b(n,u){return g(n)&&g(n[u])?n[u]:v[u]}function e(n){return b(n,"expires")}function h(n,u){return b(n,u?"delimiter":"key_delimiter")}function c(n){return b(n,"domain")}function j(n){return b(n,"path")}function l(n,u){g(u)||(u="=");return new RegExp("^\\s*"+n+u)}function m(n){for(var u="",
t=document.cookie.split(";"),x=0,y=t.length,z=l(n);x<y;x++){n=t[x];if(z.test(n)){u=n.replace(z,"");break}}return unescape(u)}function r(n,u,t){n=m(n).split("&");u=l(u,h(t,true));t=0;for(var x=n.length,y={};t<x;t++)if(u.test(n[t])){y.key=n[t];n.splice(t,1);break}if(n.length>0)y.cookie=n.join("&");return y}function o(n,u,t,x){n=r(n,u,x);n.key=n.key?n.key.replace(new RegExp("("+h(x,true)+").*$"),"$1"+t):u+h(x)+t;return n.key+(n.cookie?"&"+n.cookie:"")}function w(n,u,t){return r(n,u,t).cookie}function s(n,
u,t,x){u||(u="");u=u.split("&");for(var y=0,z=u.length;y<z;y++)u[y]=escape(u[y]);u=u.join("&");n=[n+"="+u,"domain="+c(t),"path="+j(t)];if(g(t)||x){t=x?e(t):t.expires;if(g(t)){if(typeof t==="number"||f(t)&&/^-?\d+$/.test(t)){x=new Date;x.setTime(x.getTime()+864E5*t);t=x.toGMTString()}n.push("expires="+t)}}return n.join(";")+";"}var v={expires:90,delimiter:"(:|=)",key_delimiter:"=",domain:".bbc.co.uk",path:"/iplayer"};return{get:function(n,u,t){if(f(n))if(f(u)){n=r(n,u,t);if(n.key)return n.key.replace(l(u,
h(t,true)),"")}else return m(n);return""},remove:function(){var n=arguments,u=n.length,t=n[0],x,y={};if(u>1)if(u===2)if(typeof n[1]==="string")x=n[1];else y=n[1];else{x=n[1];y=n[2]}if(g(x))document.cookie=s(t,w(t,x,y),y,true);else{if(!g(y.expires))y.expires=-1;document.cookie=s(t,"0",y)}},set:function(){var n=arguments,u=n[0],t,x,y;switch(n.length){case 2:t=n[1];break;case 3:if(typeof n[2]==="string"){t=n[1];x=n[2];t=o(u,t,x)}else{x=n[1];y=n[2];t=x}break;case 4:t=n[1];x=n[2];y=n[3];t=o(u,t,x,y);break;
default:break}document.cookie=s(u,t,y,u===iplayer.config.cookie.name&&(!y||!y.expires)?true:false)},enabled:function(){var n=false;this.set("iplayerCookieCheck","test");if(this.get("iplayerCookieCheck")==="test")n=true;this.remove("iplayerCookieCheck");this.enabled=function(){return n};return n}}}();return iplayer.cookie=k});
require.def("iplayer/utils/utils",["iplayer/begin","iplayer/models/config","pal/config","iplayer/models/cookie","iplayer/localisation/en","lib/mustache"],function(k,f,g,b,e){var h=Object.prototype.toString;k={isFunction:function(c){return h.call(c)==="[object Function]"},isArray:function(c){return h.call(c)==="[object Array]"},rscript:"<script[^>]*>(?!\\s*<\\/script>)([\\s\\S]*?)<\\/script>",isChild:function(c,j){return!!this.rebase(c,j)},isSimpleSelector:/^[\.]?[^\s:#\[\.,]*$/,grep:function(c,j){for(var l=
c.length,m=0,r=[];m<l;m++)j.call(c[m],c[m],m,c)===true&&r.push(c[m]);return r},rebase:function(c,j){var l=this;c=glow.dom.get(c);var m=null;if(this.isSimpleSelector.test(j)){c=c[0];if(j.substr(0,1)==="."){j=j.substr(1);m=(new glow.dom.NodeList).hasClass}else{j=j.toUpperCase();m=function(o){return this[0].nodeName===o}}for(;!m.call([c],j)&&c!==document&&c.parentNode;)c=c.parentNode;c=c!==document?[c]:[]}else{var r=glow.dom.get(j);c.is(j)||(c=c.ancestors().filter(function(){var o=this;return!!l.grep(r,
function(w){return o===w}).length}))}return c.length?c[0]:false},getAncestor:function(c,j,l){c=glow.dom.get(c)[0];j=j.toLowerCase();for(c=c.parentNode;c&&(c.nodeName.toLowerCase()!==j||c.className.indexOf(l)===-1);)c=c.parentNode;return c?c:false},getPosition:function(c){var j,l;c=glow.dom.get(c)[0];j=l=0;if(c.offsetParent){do{j+=c.offsetLeft;l+=c.offsetTop}while(c=c.offsetParent);return{x:j,y:l}}return false},setPid:function(c,j){c.attr("class",c.attr("class").replace(/pid-\S+/,"pid-"+j));return c},
getPid:function(c){c=glow.dom.get(c);var j=c.attr("class")||"",l=/\b(pid-([wpbrc][0-9|b-d|f-h|j-n|p-t|v-z]{7,14}))\b/,m;m=j.match(l);if(!m)if(c[0].href)m=c[0].href.match(l);if(m!==null&&m[2])return m[2];else throw new Error("the cta does not have a pid attached to it!: "+j);},getString:function(c,j){c=e[c];if(!c)return"";if(!j)return c;for(var l=0,m=j.length;l<m;l++)c=c.replace("%"+(l+1),j[l]);return c},object:{isEmpty:function(c){for(var j in c)return false;return true},length:function(c){var j,
l=0;for(j in c)c.hasOwnProperty(j)&&l++;return l}},addUrlHash:function(c){if(typeof c!="object")throw new Error("iplayer.utils.addUrlHash: parameter passed is not an object");else if(window.location.hash.indexOf("#")===0&&window.location.hash.indexOf("=")!==-1)try{var j=glow.data.decodeUrl(window.location.hash);window.location.hash=glow.data.encodeUrl(glow.lang.apply(j,c))}catch(l){log("Failed to decode / encode hash");window.location.hash=glow.data.encodeUrl(c)}else window.location.hash=glow.data.encodeUrl(c)},
removeUrlHash:function(c){if(window.location.hash.indexOf("#")===0&&window.location.hash.indexOf("=")!==-1&&window.location.hash.indexOf(c)!==-1)try{var j=glow.data.decodeUrl(window.location.hash.slice(1));delete j[c];window.location.hash=glow.data.encodeUrl(j)}catch(l){log("Failed to decode / encode hash")}},getUrlHashValue:function(c){if(window.location.hash.indexOf("#")===0&&window.location.hash.indexOf("=")!==-1)try{var j=glow.data.decodeUrl(window.location.hash.slice(1));return typeof j[c]!==
"undefined"?j[c]:false}catch(l){log("Failed to decode / encode hash")}},shouldReloadPage:function(){return!!/\/iplayer\/(?:\w{2}\/)?(?:tv|radio(.)*|console(.)*|favourites(.)*)?$/i.test(window.location.pathname)},arrayToObject:function(c){for(var j={},l=0,m=c.length;l<m;l++)j[c[l]]="";return j},arrayIndexOf:function(c,j){if(c.indexOf)return c.indexOf(j);for(var l=0,m=c.length,r=-1;l<m;l++)if(c[l]==j){r=l;break}return r},getScripts:function(c){var j=new RegExp(this.rscript,"i"),l=[],m;do{(m=j.exec(c))&&
m[1]&&l.push(m[1]);c=c.replace(j,"")}while(m);return l},removeInlineScripts:function(c){return c.replace(new RegExp(this.rscript,"gi"),"")},evalScripts:function(c){for(var j=[],l=0,m=c.length;l<m;l++)j.push(eval(c[l]));return j},log:function(){var c=b.get("BBCiPlayer","debug");if(typeof console!=="undefined"&&typeof console.log!=="undefined"&&(iplayer.config.debug||c))if(typeof console.log==="function")console.log.apply(console,arguments);else{c=Array.prototype.slice.call(arguments);console.log(c)}}};
window.log=window.log||k.log;iplayer.utils=glow.lang.apply(iplayer.utils,k);return iplayer.utils});
require.def("iplayer/localisation/en",function(){return iplayer.localisation={softwareUpgradeRequired:"Software upgrade required",upgradeWMPVersion:'To download BBC iPlayer programmes please upgrade your version of Windows Media Player. Click <a href="%1">here</a> to get the latest version from Microsoft.',close:"Close",cancel:"Cancel",pleaseWait:"Please wait",pleaseWaitAcquireInfoDownload:"Please wait while we acquire information for your download.",downloadUnavailable:"Download unavailable",cannotDownloadRightNowServersBusy:"BBC iPlayer cannot download %1 right now. Our servers seem to be a bit busy - please try again later.",
mediaDownloadIsNotAvailable:"Media download is not available for %1.",computerWMVDownloadPrompt:'<p>Prefer to play your BBC iPlayer downloads in Windows Media Player or Windows Media Centre? If so, this option is for you.</p><p>Simply download the programme to your desktop or directly to your Windows Media Player library, then play it in Windows Media Player or Windows Media Centre.</p><p>You can also use this option to stream programmes to your TV via a compatible Windows Media Extender device (<a href="%1">see list of supported Home Media Hubs</a>).</p><p>You have up to 30 days to watch any programmes downloaded to your computer before they expire. Remember to delete expired programmes from your computer to free up space.</p>',
download:"Download",mobileDownloadPrompt:'<p>You can now play BBC iPlayer programmes on a range of portable media players from these manufacturers:</p><div class="highlight">%1</div><p><a href="%2">See the full list here</a></p><p>%3</p><p><a href="%4">Full instructions here</a></p>',portableDevices:"Portable devices",mediaPlayerDownloadSaveCopy:"To use, save this file to your computer and then copy it to your portable device.",mediaPlayerDownloadSavePlayFirstCopy:"To use, save this file to your computer, play the first few seconds in Windows Media Player and then copy it to your portable device.",
updateWMPIndividualise:'We need to update your Windows Media Player software to let you play this programme.</p><p>Click <a href="%1">here</a> to visit the Microsoft website then hit the <strong>Upgrade</strong> button in the web page and follow the instructions.</p><p>If this does not help, please click <a href="%2">here</a> for information on settings you may have to change.',drmLicenceExpired:'%1 has expired and is unfortunately no longer available for download. <a href="%2">Why?</a>',drmSorryWithdrawn:"We are sorry but %1 has been withdrawn and is no longer available for download.",
yellowBarMessage:'<div id="yellow-bar-top"><p id="yellow-bar-graphic">Did you see a yellow bar at the top of the page?<p></div><p>Click the bar and select "Run ActiveX Control", then click the Download button again when the page has reloaded.</p><p>You will only have to do this once to start downloading BBC programmes.</p><p><a href="%1">Click here for further help</a>.</p>',yellowBarTitle:"Click the yellow bar at the top of this page",licenceDeliveryError:"Licence delivery error",drmCouldNotRetrieveLicence:"The licence could not be retrieved to play %1.",
forIplayerDesktop:"For iPlayer Desktop",airDownloadLoading:"Loading"}});
require.def("iplayer/events",["iplayer/begin"],function(){var k=function(f,g){this.events={};for(var b=this,e=0;e<f.length;e++)(function(h){b.events[h]=null;glow.events.addListener(b,h,function(){delete b.events[h];for(var c in b.events)return;g();glow.events.removeAllListeners(b)})})(f[e]);DEBUG&&window.setTimeout(function(){for(var h in b.events){console.error("iplayer.events.WaitAll object still waiting for: "+glow.data.encodeJson(b.events));return}},1E4)};k.prototype={fire:function(f,g){glow.events.fire(this,
f,g)}};iplayer.events.WaitAll=k;iplayer.events.publish=function(f,g){g=g||{};glow.events.fire(document,f,g)};return iplayer.events});
require.def("iplayer/net",["iplayer/begin","iplayer/models/config","pal/config"],function(){return iplayer.net={tokens:[],send:function(k,f,g,b){g=g||"";b=b||{};var e=b.headers||{};if(typeof g=="object"){g=glow.data.encodeUrl(g);e["Content-Type"]="application/x-www-form-urlencoded"}if(b.useCsrf){var h=iplayer.net.tokens.pop();if(h)e.Authorization="CSRF "+h;else throw"Can't send: CSRF token store is exhausted";}h=f;if(b.endPoint)h=b.endPoint+h;glow.net.xDomainPost(h,{_request:glow.data.encodeJson({uri:b.uri||
f,method:k,headers:e,body:g})},{onLoad:function(c){b.onLoad&&b.onLoad(new (function(){var j=null;try{j=glow.data.decodeJson(c);if(b.useCsrf){if(!j.headers["X-Csrf-Token"])throw new Error("[X-Csrf-Token] header missing from response, can't replenish token store");iplayer.net.tokens.push.apply(iplayer.net.tokens,j.headers["X-Csrf-Token"].split(" "));if(iplayer.net.tokens.length>10)iplayer.net.tokens.length=10}arguments.callee.prototype.json=function(){return glow.data.decodeJson(j.body)};arguments.callee.prototype.text=
function(){return j.body};arguments.callee.prototype.header=function(m){return j.headers[m]};arguments.callee.prototype.self=function(){return j}}catch(l){b.onError&&b.onError();if(DEBUG)throw new Error(l+" ["+c+"]");}}))},onTimeout:function(){if(b.onError)b.onError();else throw new Error("Request for ["+f+"] timed out");},blankUrl:iplayer.config.pelican.blankUrl||"/includes/blank/"})}}});
require.def("iplayer/utils/events",["iplayer/begin","iplayer/utils/utils"],function(k,f){var g=/^\s*(.+)\s+(\S+)\s*$/;k=function(){};k.prototype={bind:function(b){function e(s,v,n){if(!(v in j._eventRegistry)){j._eventRegistry[v]={};o[v]=true}if(s in j._eventRegistry[v])throw new Error("the selector"+s+" has already been used in this context");else{j._eventRegistry[v][s]={};j._eventRegistry[v][s].callback=n}return j._eventRegistry}function h(){var s,v,n,u;if(b)for(var t=0,x=w.length;t<x;t++)if(w[t]in
j._eventRegistry){u=w[t];delete o[u];j._eventRegistry[u].delegate=function(y,z,A){return glow.events.addListener(y,z,function(B){var C=null;C=glow.dom.get(y).get(B.source);var D=false;if(z.indexOf("click")!==-1)for(v in A[z])if(A[z].hasOwnProperty(v)&&v!=="delegate")if(C.length&&C.is(v)){D=true;try{A[z][v].callback.call(j,B)}catch(E){throw new Error("Callback could not be called. "+E+"\nEvent: "+z+"\nSelector: "+v);}}if(!D)for(v in A[z])if(A[z].hasOwnProperty(v)&&v!=="delegate")if(C=f.rebase(B.source,
v)){B.source=C;try{A[z][v].callback.call(j,B)}catch(F){throw new Error("Callback could not be called. "+F+"\nEvent: "+z+"\nSelector: "+v);}}})}(b,u,j._eventRegistry)}for(s in o){if(o.hasOwnProperty(s))if(s==="subscribe")for(n in j._eventRegistry[s]){if(j._eventRegistry[s].hasOwnProperty(n))j._eventRegistry[s][n].listener=c(document,n,j._eventRegistry[s][n].callback,j)}else for(v in j._eventRegistry[s])if(j._eventRegistry[s].hasOwnProperty(v))j._eventRegistry[s][v].listener=c(v,s,j._eventRegistry[s][v].callback,
j);delete o[s]}}function c(s,v,n,u){return glow.events.addListener(s,v,function(t){n.call(u,t)},u)}var j=this,l,m,r,o={},w=["click","dblclick","mouseover","mouseout","focus","blur","keyup"];this._eventRegistry={};if(b){l=glow.dom.get(b);b=l[0]}for(r in this)if(m=g.exec(r)){l=m[1];m=m[2];e(l,m,this[r])}h()},unbind:function(b){var e,h=this._eventRegistry,c=[];if(b){if(e=g.exec(b)){b=e[1];e=e[2];if(h[e][b].listener)c.push(h[e][b].listener);else h[e].delegate&&delete h[e][b]}}else for(e in h){if(h[e].delegate){c.push(h[e].delegate);
delete h[e]}for(var j in h[e])if(h[e][j].listener){c.push(h[e][j].listener);delete h[e][j]}delete h[e]}glow.events.removeListener(c)},rebind:function(b){this.unbind();this.bind(b)}};iplayer.utils.events=new k;return k});
require.def("iplayer/utils/queue",["iplayer/begin"],function(){var k=function(){this._queue=[]};k.prototype={add:function(f,g){g=g||[];g=g.callee?Array.prototype.slice.call(g):g;this._queue.push({fn:f,args:g})},length:function(){return this._queue.length},flush:function(){for(var f=this._queue.length,g=0,b,e=[];g<f;g++){b=this._queue[g];e.push(b.fn.apply(b.fn,b.args))}this._queue=[];return e},stackFlush:function(){for(var f,g=[];f=this._queue.pop();)g.push(f.fn.apply(f.fn,f.args));this._queue=[];
return g}};return iplayer.utils.Queue=k});
require.def("iplayer/models/useragent",["iplayer/begin"],function(){var k=function(){function f(){if(!e){e=window.glow&&glow.embed?glow.embed.Flash.version():window.deconcept?deconcept.SWFObjectUtil.getPlayerVersion():{major:0};if(e.rev)e.release=e.rev}return e}function g(s){if(!s.hasOwnProperty("major")||!s.hasOwnProperty("minor")||!s.hasOwnProperty("release"))throw"Cannot check users flash version, required version info is missing required properties";var v=f(),n=v.major,u=v.minor;v=v.release;var t=
s.major,x=s.minor;s=s.release;return!(n<t||n==t&&u<x||n==t&&u==x&&v<s)}function b(s){o=o||document.createElement("div");if(o.style[s]!==undefined)return true;s=s.charAt(0).toUpperCase()+s.slice(1);for(var v in w)if(o.style[w[v]+s]!==undefined)return true;return false}var e,h=navigator,c=h.userAgent.toLowerCase(),j=/windows/.test(c),l={},m,r=/opera\/([\d.]+)/;if(l.opera=/opera/.test(c))m=parseFloat(c.match(r)[1]);if(l.chrome=/chrome/.test(c))m=parseFloat(c.match(/chrome\/([\d.]+)/)[1]);if(l.wii=/nintendo wii/.test(c))m=
parseFloat(c.match(r)[1]);if(l.msie=/msie/.test(c)&&!l.opera)m=parseFloat(c.match(/msie ([\d.]+)/)[1]);if(l.firefox=/firefox/.test(c))m=parseFloat(c.match(/firefox\/([\d.]+)/)[1]);if(l.netscape=/netscape/.test(c))m=parseFloat(c.match(/netscape\/([\d.]+)/)[1]);if(l.safari=/safari/.test(c)&&!l.chrome)m=parseFloat(c.match(/safari\/([\d.]+)/)[1]);l.iphone=/(iphone|ipod)/.test(c)&&window.orientation;l.version=m;var o,w=["Webkit","Moz","O"];return{os:{win:j,winXP:j&&/nt 5\./.test(c),winVista:j&&/nt 6\./.test(c),
mac:/mac/.test(c),linux:/linux/.test(c),unix:/x11/.test(c)},browser:l,pluginMimeTypeExists:function(s){return h.mimeTypes&&h.mimeTypes[s]?!!h.mimeTypes[s].enabledPlugin:false},flashSupported:function(s){var v=g(s);k.flashSupported=function(){return v};return v},hasFlash:function(){var s=f().major!==0;k.hasFlash=function(){return s};return s},getFlashVersion:f,init:function(){glow.dom.get("html").addClass(b("transform")?"css-transforms":"no-css-transforms")}}}();k.init();return iplayer.useragent=k});
require.def("iplayer/end",["iplayer/models/config","pal/config","iplayer/utils/queue","iplayer/models/cookie"],function(k,f,g,b){if(!iplayer.config.debug)window.onerror=function(){return true};window.DEBUG=iplayer.config.debug?iplayer.config.debug:false;if(iplayer.config.electra.debug){window.flashDebugOutput=function(e){function h(j){return j.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;")}var c=document.getElementById("air-debug");if(c)c.innerHTML+=h(e)+"\n\n"};glow.ready(function(){/^\??electra-debug/.test(window.location.search)&&
glow.dom.create('<textarea id="air-debug" cols="120" rows="12"></textarea>').insertAfter(glow.dom.get("#bip-main"))})}(function(){function e(){if(b.get("BGUID")){if(j){j.flush();glow.net=glow.lang.apply(glow.net,c);j=null}clearInterval(l)}}if(!(b.get("BGUID")||b.get("IDENTITY"))){var h=Array.prototype.slice,c={del:glow.net.del,put:glow.net.put,post:glow.net.post,send:glow.net.send,xDomainPost:glow.net.xDomainPost},j=new g,l;glow.net=glow.lang.apply(glow.net,{del:function(){var m=h.call(arguments);
j.add(c.del,m)},put:function(){var m=h.call(arguments);j.add(c.put,m)},post:function(){var m=h.call(arguments);j.add(c.post,m)},send:function(){var m=h.call(arguments);j.add(c.send,m)},xDomainPost:function(){var m=h.call(arguments);j.add(c.xDomainPost,m)}});l=setInterval(e,200)}})()});
require.def("iplayer/accordion/accordion",function(){return iplayer.accordion=function(k,f,g,b){function e(o){o.open||o.container.css("height","auto");var w=o.container.height();o.open||o.container.css("height","0px");return w}function h(o){var w=glow.anim.css(o.container,b.ANIM_SPEED,{height:{to:0},opacity:{to:0}},{tween:glow.tweens.easeBoth()});glow.events.addListener(w,"complete",function(){o.parent.removeClass(b.OPEN_CLASS);o.container.css("visibility","hidden");o.open=false});r.push(w);b.openStateText&&
o.eventSelect.html(o.eventSelectDefaultText)}function c(o){if(b.OPEN_EXCLUSIVE)for(var w=0,s=m.length;w<s;w++)m[w].open&&h(m[w]);w=glow.anim.css(o.container,b.ANIM_SPEED,{height:{to:e(o)},opacity:{to:1}},{tween:glow.tweens.easeBoth()});glow.events.addListener(w,"complete",function(){o.container.css("height","auto")});r.push(w);o.open=true;o.parent.addClass(b.OPEN_CLASS);o.container.css("visibility","visible");if(b.openStateText){o.eventSelectDefaultText=o.eventSelect.html();o.eventSelect.html(b.openStateText)}}
function j(o){if(!l){l=true;r=[];o.open?h(o):c(o);o=[];for(var w=0;w<r.length;w++)o.push([r[w]]);o=(new glow.anim.Timeline(o)).start();glow.events.addListener(o,"complete",function(){l=false})}}b=glow.lang.apply({ANIM_SPEED:0.4,ANIMATE_OPACITY:true,OPEN_EXCLUSIVE:true,OPEN_CLASS:"open",EMPTY_CLASS:"empty"},b);var l=false,m=[],r=[];glow.dom.get(k).each(function(){var o=glow.dom.get(this),w=o.get(g),s=o.get(f);w.css("overflow","hidden");if(!o.hasClass(b.OPEN_CLASS)){w.css("height","0px");w.css("visibility",
"hidden")}var v={parent:o,container:w,eventSelect:s,open:o.hasClass(b.OPEN_CLASS)};m.push(v);glow.events.removeAllListeners(s);glow.events.addListener(s,"click",function(n){n.preventDefault();o.hasClass(b.EMPTY_CLASS)||j(v)})})}});
require.def("iplayer/modules/app",["iplayer/modules/bootstrap","iplayer/accordion/accordion","iplayer/controllers/analytics","iplayer/controllers/arialandmarks","iplayer/controllers/categories","iplayer/controllers/categoriescomponent","iplayer/controllers/consolepopupmanager","iplayer/controllers/diagnostics","iplayer/controllers/drawermanager","iplayer/controllers/electra","iplayer/controllers/favouritescarouselinit","iplayer/controllers/favouritescarouselmanager","iplayer/controllers/favouritesmanager",
"iplayer/controllers/friendsactivity","iplayer/controllers/homepageupdate","iplayer/controllers/identity","iplayer/controllers/install","iplayer/controllers/listviewctamanager","iplayer/controllers/livestats","iplayer/controllers/migrationoverlay","iplayer/controllers/overlaymanager","iplayer/controllers/pagination","iplayer/controllers/schedule","iplayer/controllers/schedulecomponent","iplayer/controllers/search","iplayer/controllers/signin","iplayer/controllers/tabs","iplayer/controllers/urlaction",
"iplayer/controllers/user","iplayer/controllers/userrecommendations","iplayer/localisation/en","iplayer/models/categories","iplayer/models/comment","iplayer/models/cta","iplayer/models/dialog","iplayer/models/drawer","iplayer/models/drawercontent","iplayer/models/episode","iplayer/models/episoderegistry","iplayer/models/favouritesbrandcarousel","iplayer/models/favouritescarousel","iplayer/models/favouritescarouselcontainer","iplayer/models/favouritesregistry","iplayer/models/genericdialog","iplayer/models/loader",
"iplayer/models/overlay","iplayer/models/popularityregistry","iplayer/models/promotesregistry","iplayer/models/schedule","iplayer/models/schedulecomponent","iplayer/models/socialdialog","iplayer/models/user",'text!templates/addremove_category.html!<a href="#" id="usercategories-{{mode}}-{{serviceType}}-{{categoryId}}" class="usercategories-{{mode}}-link add-remove-usercategory">\n\t{{text}} My Categories\n</a>\n',"iplayer/views/addremove_category","iplayer/views/diagnostics","iplayer/views/error"],
function(){return window.iplayer});
require.def("iplayer/models/user",function(){return iplayer.models.user={profile:false,age:false,socialConnections:null,getId:function(){return this.getUserId()||this.getUid()},getUid:function(){return iplayer.cookie.get("BGUID").substr(0,64)},getUserId:function(){return iplayer.cookie.get("IDENTITY").split("|")[0]},setHasProfile:function(k){this.profile=k},hasProfile:function(){return this.profile},setAge:function(k){this.age=k},isUnder16:function(){return this.age<16?true:false},setSocialConnections:function(k){this.socialConnections=
k},getSocialConnections:function(){return this.socialConnections},isSociallyConnected:function(){return this.socialConnections.length>0?true:false},isLoggedIn:function(){return!!this.getUserId()},isFreshSignin:function(){return window.location.hash&&window.location.hash.indexOf("freshSignin")!==-1?true:false},getParentalGuidanceStatus:function(){var k=2,f=iplayer.cookie.get("BBCPGstat");if(f)k=f.substr(0,1)===2?1:0;return k},canPromote:function(){return!!this.getUserId()},getMigrationStatus:function(){iplayer.config.migration.enabled&&
glow.net.get("/iplayer/usercomponents/migration/checkcanmigrate",{onLoad:function(k){if(k.json().canMigrate===true){log("User can migrate");iplayer.events.publish("iplayer:user:canmigrate")}else log("User cannot migrate")},useCache:false,onError:function(){log("Migration status Error")}})},doMigration:function(){glow.net.get("/iplayer/usercomponents/migration/migrate",{onLoad:function(k){k=k.json();iplayer.cookie.set(iplayer.config.cookie.name,iplayer.config.cookie.key.lastFavouriteModified,"1");
iplayer.cookie.set(iplayer.config.cookie.name,iplayer.config.cookie.key.recentlyPlayedModified,"1");if(k.migrationComplete===true){log("Migration succes");iplayer.events.publish("iplayer:user:migrationcomplete")}else log("Migration not fully completed")},onError:function(){log("Migration error");iplayer.events.publish("iplayer:user:migrationerror")}})},deferMigration:function(){log("Defering migration");glow.net.get("/iplayer/usercomponents/migration/defer",{onLoad:function(k){log("Migration defered count set to "+
k.json().migrationCount)},onError:function(){log("Defer action Error")}})},setBGUIDCookie:function(){if(iplayer.cookie.get("BGUID"))log("bguid cookie already set");else{glow.dom.create('<img id="webbug" class="blq-hide" src="'+iplayer.config.bguid.url+'" alt="" />').prependTo("body");log("bguid cookie requested from "+iplayer.config.bguid.url)}return true}}});
require.def("iplayer/controllers/analytics",["iplayer/utils/events","iplayer/models/user"],function(k,f){var g=function(){this.bind();this._recommendSource=this._recommendId=null};glow.lang.extend(g,k,{"iplayer:emp:watched subscribe":function(b){if(iplayer.config.choicestream.enabled){this._recommendSource=b.episode._episode.media_type==="video"?"tv_episode_page":window.location.href.indexOf("/console")==-1?"radio_episode_page":"radio_console";this._createImageElement(glow.data.encodeJson({activities:[{type:"item_views",
appcontext:this._recommendSource,attrs:{item_id:b.episode._episode.id}}],context:{api_key:iplayer.config.choicestream.apiKey,user_id:f.getUserId()||f.getUid(),recommendation_id:this._recommendId}}))}},"iplayer:emp:initialised subscribe":function(b){this._recommendId=iplayer.utils.getUrlHashValue("recommendId");this._recommendSource=iplayer.utils.getUrlHashValue("recommendSource")?iplayer.utils.getUrlHashValue("recommendSource"):null;if(iplayer.config.choicestream.enabled&&this._recommendSource){b=
b.episode.pid;log("pid is: ",b);this._createImageElement(glow.data.encodeJson({activities:[{type:"item_clicks",appcontext:this._recommendSource,attrs:{item_id:b}}],context:{api_key:iplayer.config.choicestream.apiKey,user_id:f.getUserId()||f.getUid(),recommendation_id:this._recommendId}}))}},_createImageElement:function(b){b=glow.lang.interpolate(iplayer.config.choicestream.serviceUrl,{json:encodeURIComponent(b)});var e=document.createElement("div");e.style.width="1px";e.style.height="1px";e.style.backgroundImage=
"url("+b+")";document.body.appendChild(e)}});return g});
require.def("iplayer/controllers/arialandmarks",function(){var k=function(f){switch(f){case "HOMEPAGE":this._addModuleLandmark("#drawer-container #drawer-1","drawer1","complementary");this._addModuleLandmark("#drawer-container #drawer-2","drawer2","complementary");this._addModuleLandmark("#drawer-container #drawer-3","drawer3","complementary");this._addModuleLandmark("#drawer-container #drawer-4","drawer4","complementary");this._addModuleLandmark("#schedule","schedule","navigation");this._addModuleLandmark("#categories",
"categories","navigation");break;case "EPISODE":this._addLandmark("#emp-container #emp","emp","main","Video player");this._addLandmark("#programme-info .content","programme-info","complementary","Programme information");this._addModuleLandmark("#drawer-container #drawer-1","drawer1","complementary");this._addModuleLandmark("#drawer-container #drawer-2","drawer2","complementary");break;case "SIMULCAST":this._addLandmark("#emp-container #emp","emp","main","Video player");this._addLandmark("#services-list-switcher #services-list",
"channels","navigation","Change TV channel");this._addLandmark("#programme-info .content","programme-info","complementary","Programme information");this._addLandmark("#programme-info .next","on-next","complementary","On next");this._addModuleLandmark("#drawer-container #drawer-1","drawer1","complementary");this._addModuleLandmark("#drawer-container #drawer-2","drawer2","complementary");break;case "SCHEDULE":this._addLabelledLandmark("#schedule-services-column #services-list","#schedule-services-column > p",
"select-service","navigation");this._addLabelledLandmark("#schedule-content","#schedule-content > h2","schedule","main");this._addModuleLandmark("#schedule-on-now","on-now","complementary");this._addModuleLandmark("#most-popular","most-popular","complementary");break;case "CATEGORY":this._addLandmark("#categories .category-list","category-list","navigation","Select a category");this._addLabelledLandmark(".category-container",".category-container > h1","category-list","main");this._addLabelledLandmark(".category-mostpopular",
".category-mostpopular > h2","most-popular","complementary");this._addModuleLandmark(".category-container .plain-module","other-service","complementary");break;case "FAVOURITES":this._addModuleLandmark("#manage-favourites","favourites","main");break;case "FAVOURITES-LASTPLAYED":this._addModuleLandmark("#manage-favourites #last-played","last-played","complementary");break;default:break}};k.prototype={_addLandmark:function(f,g,b,e){f=glow.dom.get(f);if(f.length>0){glow.dom.create('<p class="blq-hide" id="'+
g+'-aria-label">'+e+"</p>").insertBefore(f);f.attr("aria-labelledby",g+"-aria-label");f.attr("role",b)}},_addModuleLandmark:function(f,g,b){f=glow.dom.get(f);try{if(f.length>0){var e=f.get("> .content");f.get("h2")[0].id=g+"-aria-label";e.attr("aria-labelledby",g+"-aria-label");e.attr("role",b)}}catch(h){}},_addLabelledLandmark:function(f,g,b,e){f=glow.dom.get(f);g=glow.dom.get(g);if(f.length>0&&g.length>0){g[0].id=b+"-aria-label";f.attr("aria-labelledby",b+"-aria-label");f.attr("role",e)}}};return k});
require.def("iplayer/models/categories",["iplayer/utils/events"],function(k){var f=function(g){this._currentCategoryPid=g;this.myCategoriesRegistry=[];this.bind()};glow.lang.extend(f,k,{currentOperation:false,manageUserCategory:function(g,b,e){var h=null,c;false===glow.dom.get("#categorylist-user-toggle").parent().hasClass("open")&&glow.events.fire("#categorylist-user-toggle","click");if(this.currentOperation!==null){c=e.source;if(undefined!==c){e=/usercategories-([a-z]*)-([a-z]*)-(.*)/.exec(c.id);
h=e[2]}else h=iplayer.servicetype.master;iplayer.events.publish("iplayer:categories:removeButton",{element:c});this.currentOperation=g;e=null;switch(g){case "add":e="PUT";break;case "remove":e="DELETE";break;default:throw new Error("iplayer.models.Categories.manageUserCategory: operation "+g+"not supported.");}iplayer.net.send(e,iplayer.config.root+"usercomponents/mycategories/editcategories/"+b,null,{useCache:true,onLoad:function(){iplayer.events.publish("iplayer:categories:update",c)},onError:function(){glow.anim.fadeIn(c)}})}},
updateCategoryList:function(g){var b=this,e=glow.dom.get("#categorylist-user"),h=e.parent();if(undefined!==g){g=/usercategories-([a-z]*)-([a-z]*)-(.*)/.exec(g.id);g=g[2]}else g=iplayer.servicetype.master;g=iplayer.config.root+"usercomponents/mycategories/mycategories?servicetype="+g;b.myCategoriesRegistry=[];glow.net.get(g,{onLoad:function(c){c=c.json();var j;glow.dom.get("#categorylist-user li").destroy();if(c.categories&&c.categories.length>0){j=false;if(""!==window.location.search)if(/uc=true/g.exec(window.location.search)!==
null)j=true;h.removeClass("empty");for(var l=0;l<c.categories.length;l++){var m=b._currentCategoryPid==c.categories[l].id,r=glow.dom.create('<li><a href="{url}"id="user-category-{serviceType}-{categoryId}">{label}</a></li>',{interpolate:{url:iplayer.config.root+c.categories[l].serviceType+"/categories/"+c.categories[l].path+"?uc=true",serviceType:c.categories[l].serviceType,categoryId:c.categories[l].id,label:c.categories[l].title}});m&&r.addClass("selected");e.append(r);b.myCategoriesRegistry[b.myCategoriesRegistry.length]=
c.categories[l]}e.css("visibility","visible");if(j){glow.events.fire(glow.dom.get("#categorylist-user-toggle"),"click");var o=glow.dom.get("#category-results .pagination-control a"),w=glow.dom.get("#category-results .result-sorter a");o.each(function(s){o[s].href+="&uc=true"});w.each(function(s){w[s].href+="&uc=true"})}}else{h.addClass("empty");e.css("visibility","hidden")}iplayer.events.publish("iplayer:categories:addButton")},onError:function(){log("My Categories failed to load successfully")}})},
updateHeader:function(g){var b=g.parent();if(g.get("li").length>0)b.removeClass("empty");else{b.removeClass("open");b.addClass("empty")}},addToUser:function(g,b){this.manageUserCategory("add",g,b)},removeFromUser:function(g,b){this.manageUserCategory("remove",g,b)}});return iplayer.models.Categories=f});
require.def("iplayer/controllers/categories",["iplayer/utils/events","iplayer/accordion/accordion","iplayer/models/categories","iplayer/views/addremove_category"],function(k,f,g,b){var e=function(h){new f("ul.category-list > li","a.toggle","> ul",{ANIM_SPEED:0.4});new f("ul.episodelist > li","a.more-in-this-series","ol",{openStateText:"close"});this._currentCategoryPid=h;this._categoriesModel=new g(this._currentCategoryPid);this._categoriesAnimation=null;this._categoriesAnimationLock=false;this.bind(document);
this._categoriesModel.updateCategoryList()};glow.lang.extend(e,k,{"iplayer:categories:addButton subscribe":function(){var h=glow.dom.get("#categories li.selected > a");if(h.length)var c=/category-([a-z]*)-(.*)?/.exec(h[0].id);var j=false;if(c!=undefined){if(this._categoriesModel.myCategoriesRegistry.length>0)for(i=0;i<this._categoriesModel.myCategoriesRegistry.length;i++)if(c[2]==this._categoriesModel.myCategoriesRegistry[i].id)j=true;h="add";if(j===true)h="remove";j=glow.dom.get(".usercategories-remove-link");
j.destroy();j=glow.dom.get(".usercategories-add-link");j.destroy();c=(new b(h,c[2],c[1])).createButton();c.css({opacity:0});glow.dom.get(".add-remove-usercategory").length&&glow.dom.get(".add-remove-usercategory").destroy();c.insertAfter("h1");if(this._categoriesAnimation){this._categoriesAnimation.stop();this._categoriesAnimation.destroy()}this._categoriesAnimation=glow.anim.fadeIn(c,0.4);this._categoriesAnimationLock=false}},"iplayer:categories:removeButton subscribe":function(h){this._removeButton("#"+
h.element.id)},_removeButton:function(h){var c=glow.dom.get(h);if(this._categoriesAnimation){this._categoriesAnimation.stop();this._categoriesAnimation.destroy()}this._categoriesAnimation=glow.anim.fadeOut(c,0.4,{onComplete:function(){c.destroy()},onStop:function(){c.destroy()}})},".usercategories-add-link click":function(h){if(this._categoriesAnimationLock)return false;this._categoriesAnimationLock=true;var c=/usercategories-add-([a-z]*)-(.*)?/.exec(h.source.id)[2];undefined!=c&&this._categoriesModel.addToUser(c,
h);return false},".usercategories-remove-link click":function(h){if(this._categoriesAnimationLock)return false;this._categoriesAnimationLock=true;var c=/usercategories-remove-([a-z]*)-(.*)?/.exec(h.source.id)[2];undefined!=c&&this._categoriesModel.removeFromUser(c,h);return false},"iplayer:categories:update subscribe":function(h){this._categoriesModel.updateCategoryList(h)},"iplayer:signin subscribe":function(){this._categoriesModel.updateCategoryList()}});return iplayer.controllers.categories=e});
require.def("iplayer/views/addremove_category",['text!templates/addremove_category.html!<a href="#" id="usercategories-{{mode}}-{{serviceType}}-{{categoryId}}" class="usercategories-{{mode}}-link add-remove-usercategory">\n\t{{text}} My Categories\n</a>\n'],function(k){var f=function(g,b,e){this._mode=g;this._categoryId=b;this._serviceType=e};f.prototype={createButton:function(){var g="Remove from";if(this._mode=="add")g="Add to";return glow.dom.create(Mustache.to_html(k,{mode:this._mode,categoryId:this._categoryId,
serviceType:this._serviceType,text:g}))}};return iplayer.views.AddRemove_Category=f});
require.def("iplayer/models/loader",function(){var k=function(f,g,b){this._size=g==="small"?0:1;this._position=b;this._$loaderElement=this._createLoaderDom();this._$container=glow.dom.get(f).slice(0,1);this._$content=null};k.prototype={_opts:{LARGE_IMG:"/load_large.gif",SMALL_IMG:"/load_small.gif"},getBaseUrl:function(){return iplayer.config.IPLAYER_STATIC+"/img/loader"},show:function(f){var g=this;return this._animate({opacity:{from:0,to:1}},{onStart:function(){if(g._position=="prepend")g._$loaderElement.prependTo(g._$container);
else if(g._position=="after")g._$container.after(g._$loaderElement);else g._position=="before"?g._$container.before(g._$loaderElement):g._$loaderElement.appendTo(g._$container);g._$loaderElement.css("display","block")}},f)},hide:function(f){var g=this;return this._animate({opacity:{from:1,to:0}},{onComplete:function(){g._$loaderElement.css("display","none");g._$loaderElement.remove()}},f)},setContainer:function(f){this._$container=glow.dom.get(f).slice(0,1);return this},addClass:function(f){return this._$loaderElement.addClass(f)},
_animate:function(f,g,b){b=b!==false?true:false;f=glow.anim.css(this._$loaderElement,0.2,f,g);return b?f.start():f},_createLoaderDom:function(){var f=this.getBaseUrl()+(this._size?this._opts.LARGE_IMG:this._opts.SMALL_IMG);f=glow.dom.create('<div class="loader"><img src="{src}" alt="" /></div>',{interpolate:{src:f}});f.css({display:"none",opacity:0});return f}};return iplayer.models.Loader=k});
require.def("iplayer/controllers/categoriescomponent",["iplayer/utils/events","iplayer/accordion/accordion","iplayer/models/categories","iplayer/models/loader","iplayer/models/episoderegistry"],function(k,f,g,b,e){var h=function(){new f("ul.category-list > li","a.toggle","ul",{ANIM_SPEED:0.5});this._categoriesModel=new g;this.bind("#categories");this._categoriesModel.updateCategoryList()};glow.lang.extend(h,k,{bodyWait:function(){glow.dom.get("#categories").prepend('<div class="link-protector"></div>');
glow.anim.fadeTo(glow.dom.get(".category-list-body"),0.1,0.5);glow.dom.get("#categories .loader").remove();this._loader=new b(glow.dom.get(".category-list-body"),"large","after");this._loader.show()},bodyLoad:function(c){$listBody=glow.dom.get(".category-list-body");$listBody.html(c);this._loader.hide();delete this._loader;glow.anim.fadeIn($listBody,0.5);glow.dom.get("#categories .link-protector").destroy()},"#categories .section li > a click":function(c){var j=this,l=glow.dom.get(c.source),m=/(user\-)?category-([a-z]*)-(.*)?/.exec(l[0].id);
if(l.parent().hasClass("selected"))return true;else{c.preventDefault();c.stopPropagation();l.addClass("outlinenone");this.bodyWait();c=glow.lang.interpolate("/iplayer/pagecomponents/categories/fragment?category={category}&servicetype={serviceType}",{category:m[3],serviceType:m[2]});glow.net.get(c,{onLoad:function(r){var o=r.json().html;e.addData(r.json().episodeRegistry);j.bodyLoad(o);l.parent().parent().parent().parent().get("li.selected").removeClass("selected");l.parent().addClass("selected")},
headers:{Accept:"application/json"}});return false}}});return iplayer.controllers.categoriescomponent=h});
require.def("iplayer/models/favouritesregistry",function(){return iplayer.models.favouritesRegistry={_data:{},addData:function(k){if(k)if(!(k instanceof Array))if(typeof k==="string"||k instanceof String)this._data[k]=true;else if(typeof k=="object")this._data=glow.lang.apply(k,this._data)},load:function(k,f){k=k||"tv";var g=this;glow.net.get("/iplayer/pagecomponents/favourites/suggestedlist?servicetype="+k,{onLoad:function(b){g.addData(b.json());f&&f(b)},onError:function(){log("iplayer.models.favouritesRegistry.load: could not load favourites data from server")}})},
remove:function(k){if(this.exists(k)){delete this._data[k];return true}else return false},exists:function(k){return k in this._data}}});
require.def("iplayer/models/episode",["iplayer/models/favouritesregistry","iplayer/models/promotesregistry","iplayer/models/popularityregistry","iplayer/models/comment","iplayer/utils/date"],function(k,f,g,b,e){var h=function(c,j){this.setEpisode(c);this.setStyle(j)};h.prototype={_interpolate:function(c){if(!(c in this._format))return"";return this._format[c].replace(/\{(\w+)\}/g,function(j){var l=function(m){switch(m){case "xmetatitle":return this._episode.subseries_title&&this._episode.title.indexOf(this._episode.subseries_title)!==
-1?this._episode.title:this._episode.subseries_title+" - "+this._episode.title;case "xtitle":return this._episode.title===this._episode.brand_title&&this._episode.availability==="CURRENT"?"[DATE]":this._episode.title;case "xtitle_strip_date":return/^\d{2}\/\d{2}\/\d{4}$/.test(this._episode.title)?"":this._episode.title;case "xtitle_remove_series_text":m=this._episode.brand_title+": "+this._episode.series_title;var r=/^(Series \d+)/;return m.length>this._filter.title.count&&r.test(this._episode.series_title)?
this._episode.brand_title:m;default:return this._episode[m]}};return function(m,r){return l.call(j,r)}}(this))},_get_display:function(c,j){var l=this._interpolate(c);j||(j="");if(!(c in this._format))return l;c=this._filter[c].count-j.length;var m=glow.dom.create("<div>&#8230;</div>").text();if(l.length>c)l=l.substr(0,c-1)+m;return l+j},displayTitle:function(){return this._get_display("title")},displaySubtitle:function(){return this._get_display("subtitle")},displayFulltitle:function(){return this._episode.complete_title},
displayDescription:function(){return this._get_display("description")},displayTime:function(){var c="time"in this._format?this._format.time:null,j=this.startEpoch?this.startEpoch:this._episode.original_broadcast_datetime;if(c!==null)j=e.date.format(c,j);return j},hasGuidance:function(){return!!this._episode.play_version_guidance_text},setStyle:function(c){if(!c){var j;for(j in iplayer.config.titling){c=j;break}}this._format=iplayer.config.titling[c][this._episode.contextual_family_tree];this._filter=
iplayer.config.titling[c]._filter},setEpisode:function(c){this._episode=c},addToFavourites:function(c){if(!this._episode.favourite_type||!this._episode.favourite_id)if(this._episode.brand_id){this._episode.favourite_type="brand";this._episode.favourite_id=this._episode.brand_id}else if(this._episode.series_id){this._episode.favourite_type="series";this._episode.favourite_id=this._episode.series_id}else{this._episode.favourite_type="episode";this._episode.favourite_id=this._episode.id}var j=this,l=
{favouriteType:this._episode.favourite_type,favouriteId:this._episode.favourite_id};c=glow.lang.apply({onLoad:null,onError:null},c);iplayer.net.send("PUT","sendfavourite",l,{endPoint:iplayer.config.talkback.url,uri:"/iplayer/favourites/"+this._episode.favourite_type+"/"+this._episode.favourite_id,onLoad:function(m){k.addData(j.getPid());iplayer.cookie.set(iplayer.config.cookie.name,iplayer.config.cookie.key.lastFavouriteModified,m.self().event_time_epoch_ms);c.onLoad&&c.onLoad(j);iplayer.events.publish("iplayer:episode:update",
j);iplayer.events.publish("iplayer:addFavourite",{episode:j})},onError:c.onError});return true},removeFromFavourites:function(c){if(!this._episode.favourite_type||!this._episode.favourite_id)if(this._episode.brand_id){this._episode.favourite_type="brand";this._episode.favourite_id=this._episode.brand_id}else if(this._episode.series_id){this._episode.favourite_type="series";this._episode.favourite_id=this._episode.series_id}else{this._episode.favourite_type="episode";this._episode.favourite_id=this._episode.id}var j=
this,l=this._episode.favourite_type,m=this._episode.favourite_id;iplayer.net.send("DELETE","sendfavourite",{favouriteId:m,favouriteType:l+"_id"},{endPoint:iplayer.config.talkback.url,uri:"/iplayer/favourites/"+l+"/"+m,useCache:true,onLoad:function(r){c.onLoad&&c.onLoad(j);iplayer.cookie.set(iplayer.config.cookie.name,iplayer.config.cookie.key.lastFavouriteModified,r.self().event_time_epoch_ms)},onError:function(r){c.onError&&c.onError(r);log(r?r.text():"Error removing a favourite.")}})},setPromoted:function(c,
j,l){l=glow.lang.apply({onLoad:null,onError:null},l);var m=this,r="/iplayer/restepisode/"+this._episode.id;iplayer.net.send("PUT",r.replace(/\//g,"-"),glow.data.encodeJson({is_promoted:c,has_comment:j,favourite_type:this._episode.favourite_type,favourite_id:this._episode.favourite_id,media_type:this._episode.media_type,play_version_id:this._episode.play_version_id,format:this._episode.format,title:this.displayTitle()}),{endPoint:iplayer.config.pelican.serviceUrl,uri:r,useCsrf:true,onLoad:function(o){f.addData(m.getPid());
m._episode.is_promoted=c;o=o.json().popularity;if(typeof o=="number"&&(c&&o>m.getPopularity()||!c&&o<m.getPopularity()))m.setPopularity(o);else typeof m.getPopularity()=="number"?m.setPopularity(c?m.getPopularity()+1:m.getPopularity()-1):m.setPopularity(c?1:0);l.onLoad&&l.onLoad(m);iplayer.events.publish("iplayer:episode:update",m)},onError:l.onError,headers:{"Content-Type":"application/json"}})},addComment:function(c,j){(new b(this,c)).save(j)},isFavourited:function(){return k.exists(this.getPid())},
isPromoted:function(){return f.exists(this.getPid())},getPopularity:function(){return g.getPopularity(this.getPid())},setPopularity:function(c){return g.setPopularity(this.getPid(),c)},isHD:function(){return this._episode.my_playlist_url.indexOf("hd")!=-1},isSign:function(){return this._episode.my_playlist_url.indexOf("sign")!=-1},isAD:function(){return this._episode.my_playlist_url.indexOf("ad")!=-1},getServiceType:function(){return this._episode.media_type==="audio"?"radio":"tv"},getVersionType:function(){var c=
null;if(this.isHd())c="hd";else if(this.isAd())c="ad";else if(this.isSign())c="sign";return c},getPid:function(){return this._episode.id},getVersionId:function(){return this._episode.play_version_id},getStartTime:function(){return this.startTime},getEndTime:function(){return this.endTime},getTopLevelContainer:function(){switch(this._episode.contextual_family_tree.charAt(0)){case "b":return this._episode.brand_id;case "s":return this._episode.series_id;case "e":return this._episode.id;default:return this._episode.id}},
getContainersId:function(){switch(this._episode.contextual_family_tree){case "b-s-ss-e":return this._episode.brand_id+"-"+this._episode.series_id;case "b-s-e":return this._episode.brand_id+"-"+this._episode.series_id;case "b-e":return this._episode.brand_id;case "s-ss-e":return this._episode.series_id;case "s-e":return this._episode.series_id;case "e":return this._episode.id;default:return this._episode.id}},getAvailableUntil:function(){return this._episode.available_until},getDuration:function(){return this._episode.duration},
getCategories:function(){return this._episode.categories},getSynopsis:function(){return this._episode.synopsis},getLongSynopsis:function(){var c=this._episode.long_synopsis;if(!c){c=this._episode.medium_synopsis;if(!c)c=this._episode.synopsis}return c},getShortSynopsis:function(){var c=this._episode.short_synopsis;if(!c)c=this._episode.synopsis;return c},getGuidanceText:function(){return this._episode.play_version_guidance_text},getSeoFriendName:function(){try{var c=this._episode.my_url.match(/\/iplayer\/(episode|console)\/[0-9b-df-hj-np-tv-z]{8,15}(\/(ad|sign|hd))?\/(.*)\//);
if(c.length<5)return"";return c[4]}catch(j){return""}},getPageUrl:function(c){return this.getServiceType()==="radio"&&iplayer.config.radio.useConsole||c=="console"?"/iplayer/console/"+this.getPid()+"/"+this.getSeoFriendName()+"/":this._episode.my_url},getRecommendPageUrl:function(c){recommendIdHash=typeof this._episode.recommendId!=="undefined"?"&recommendId="+this._episode.recommendId:"";return this.getPageUrl(c)+"#recommendSource="+this.getServiceType()+"_"+c+recommendIdHash},getVersionUrl:function(){},
reloadEpisodeFromRest:function(c){var j=this;glow.net.get("/iplayer/restepisode/"+this.getPid(),{onLoad:function(l){l=glow.data.decodeJson(l.text());j._episode=glow.lang.apply(j._episode,l);c&&c(j)},useCache:true})},getImageUrl:function(c){var j=this._getImageHeight(c);return(this._episode.my_image_base_url||"http://node1.bbcimg.co.uk/iplayer/images/episode/")+this._episode.id+"_"+c+"_"+j+".jpg"},getImageDetails:function(c){return{src:this.getImageUrl(c),width:c,height:this._getImageHeight(c),alt:""}},
_getImageHeight:function(c){switch(c){case 86:c=48;break;case 120:c=68;break;case 126:c=71;break;case 150:c=84;break;case 172:c=96;break;case 196:c=110;break;case 246:c=138;break;case 261:c=147;break;case 314:c=176;break;case 366:c=206;break;case 406:c=228;break;case 477:c=268;break;case 640:c=360;break;case 832:c=468;break;default:c=100;break}return c},getPlaylistUrl:function(){return this._episode.my_playlist_url},isDownloadable:function(){return(this.isHD()?this._episode.is_downloadable_hd:this._episode.is_downloadable_sd)===
"1"&&this.getServiceType()!=="radio"},getOndemandStart:function(){return this._episode.ondemand_start},getAvailability:function(){return this._episode.availability},getActualStart:function(){return this._episode.actual_start},getPassionsiteLink:function(){return this._episode.passionsite_link},getEmp:function(){if(!this._emp)this._emp=new Emp(this);return this._emp}};return iplayer.models.Episode=h});
require.def("iplayer/models/episoderegistry",["iplayer/models/episode"],function(k){var f=function(){var g={},b={};return{_data:b,addCache:function(e){return g[e._episode.id]=e},addData:function(e){e instanceof Array||glow.lang.apply(b,e)},appendData:function(e){for(pid in e)b[pid]=pid in b?glow.lang.apply(e[pid],b[pid]):glow.lang.clone(e[pid])},clear:function(){b={};g={}},find:function(e,h){if(!e){h&&h(null);return null}!(e in g)&&e in b&&this.addCache(new k(b[e]));if(e in g){var c=g[e];h&&h(c);
return c}else{var j=this,l="/iplayer/restepisode/"+e;glow.net.get(l,{onLoad:function(m){m=glow.data.decodeJson(m.text());j.addCache(new k(m));h&&h(g[e])},onError:function(m){h&&h(null);console&&DEBUG&&console.error("EpisodeRegistry failed retrieving pid:\n",e,"\nRest end point:\n",l,"\nError Obj:\n",m)},useCache:true});return null}}}}();return iplayer.models.episodeRegistry=f});
require.def("iplayer/models/promotesregistry",["iplayer/models/user"],function(k){return iplayer.models.promotesRegistry={_data:{},addData:function(f){if(!(f instanceof Array))if(typeof f==="string"||f instanceof String)this._data[f]=true;else if(typeof f=="object")this._data=glow.lang.apply(f,this._data)},load:function(f,g){f=f||"tv";var b=this,e=k.getUserId();f=glow.lang.interpolate("/iplayer/usercomponents/restpromotes/{id}?servicetype={serviceType}",{id:e,serviceType:f});e?glow.net.get(f,{onLoad:function(h){var c=
h.json();b.addData(c.promotedEpisodes);if(c.tokens)iplayer.net.tokens=iplayer.net.tokens.concat(c.tokens);g&&g(h)},onError:function(){log("iplayer.models.promotesRegistry.load: \tcould not load promotes data for "+e+" from server")}}):iplayer.events.publish("iplayer:user:notloggedin")},remove:function(f){if(this.exists(f)){delete this._data[f];return true}else return false},exists:function(f){return f in this._data}}});
require.def("iplayer/models/popularityregistry",function(){return iplayer.models.popularityRegistry={_data:{},addData:function(k){glow.lang.apply(this._data,k)},getPopularity:function(k){return k in this._data?this._data[k]:null},setPopularity:function(k,f){this._data[k]=f}}});
require.def("iplayer/models/comment",function(){var k=function(f,g){this._episode=f;this._text=g};k.prototype={save:function(f){f=glow.lang.apply({onLoad:null,onError:null},f);var g=this;iplayer.net.send("POST","/iplayer/restcomment".replace(/\//g,"-"),glow.data.encodeJson({id:this._episode._episode.id,serviceType:this._episode.getServiceType(),text:this._text,title:this._episode.displayTitle()}),{endPoint:iplayer.config.pelican.serviceUrl,uri:"/iplayer/restcomment",useCsrf:true,onLoad:function(b){f.onLoad&&
f.onLoad(b,g);iplayer.events.publish("iplayer:comment:add",g)},onError:f.onError,headers:{"Content-Type":"application/json"}})}};return iplayer.models.Comment=k});
require.def("iplayer/utils/date",["iplayer/utils/utils"],function(k){return glow.lang.apply(k,{date:{dateToEpoch:function(f){return(f.getTime()-f.getMilliseconds())/1E3},epochToDate:function(f){return new Date(f*1E3)},dateToIso:function(f){return f.getUTCFullYear()+"-"+this._padZero(f.getUTCMonth()+1)+"-"+this._padZero(f.getUTCDate())+"T"+this._padZero(f.getUTCHours())+":"+this._padZero(f.getUTCMinutes())+":"+this._padZero(f.getUTCSeconds())+"Z"},untilExpiry:function(f){var g=this.dateToEpoch(new Date);
if(typeof f!=="number")f=this.dateToEpoch(f);f=Math.round((f-g)/60);g=f/60;if(g>1)g=Math.round(f/60);return g<1?f+" minute"+(f!=1?"s":"")+" left":g<12?g+" hour"+(g!=1?"s":"")+" left":g<=24?"1 day left":g<=48?"2 days left":""},getDayShort:function(f){var g=0;g=typeof f==="number"?f:f.getDay();switch(g){case 0:return"Sun";case 1:return"Mon";case 2:return"Tue";case 3:return"Wed";case 4:return"Thu";case 5:return"Fri";case 6:return"Sat"}},getDayFull:function(f){var g=0;g=typeof f==="number"?f:f.getDay();
switch(g){case 0:return"Sunday";case 1:return"Monday";case 2:return"Tuesday";case 3:return"Wednesday";case 4:return"Thursday";case 5:return"Friday";case 6:return"Saturday"}},getDaySuffix:function(f){var g=0;g=typeof f==="number"?f:f.getDate();switch(g){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},getMonthFull:function(f){var g=0;g=typeof f==="number"?f:f.getMonth();switch(g){case 0:return"January";case 1:return"Feburary";case 2:return"March";
case 3:return"April";case 4:return"May";case 5:return"June";case 6:return"July";case 7:return"August";case 8:return"September";case 9:return"October";case 10:return"November";case 11:return"December"}},getMonthShort:function(f){var g=0;g=typeof f==="number"?f:f.getMonth();switch(g){case 0:return"Jan";case 1:return"Feb";case 2:return"Mar";case 3:return"Apr";case 4:return"May";case 5:return"Jun";case 6:return"Jul";case 7:return"Aug";case 8:return"Sep";case 9:return"Oct";case 10:return"Nov";case 11:return"Dec"}},
getYearShort:function(f){var g=0;g=typeof f==="number"?f:f.getFullYear();g=new String(g);g=g.split("");return g[2]+""+g[3]},getPostfixLower:function(f){var g=0;g=typeof f==="number"?f:f.getHours();if(g<12)return"am";return"pm"},getPostfixUpper:function(f){return this.getPostfixLower(f).toUpperCase()},get12Hours:function(f){var g=0;g=typeof f==="number"?f:f.getHours();if(g>12)g+=-12;return g},format:function(f,g){var b="";if(typeof g==="number")g=this.epochToDate(g);else if(typeof g==="undefined")g=
new Date;f=f.split("");for(var e in f)switch(f[e]){case "d":b+=this._padZero(g.getDate());break;case "D":b+=this.getDayShort(g.getDay());break;case "j":b+=g.getDate();break;case "l":b+=this.getDayFull(g.getDay());break;case "S":b+=this.getDaySuffix(g.getDate());break;case "w":b+=g.getDay();break;case "F":b+=this.getMonthFull(g.getMonth());break;case "m":b+=this._padZero(g.getMonth()+1);break;case "M":b+=this.getMonthShort(g.getMonth());break;case "n":b+=this._padZero(g.getMonth()+1);break;case "Y":b+=
g.getFullYear();break;case "y":b+=this.getYearShort(g.getFullYear());break;case "a":b+=this.getPostfixLower(g.getHours());break;case "A":b+=this.getPostfixUpper(g.getHours());break;case "g":b+=this.get12Hours(g.getHours());break;case "G":b+=g.getHours();break;case "h":var h=this.get12Hours(g.getHours());b+=this._padZero(h);break;case "H":b+=this._padZero(g.getHours());break;case "i":b+=this._padZero(g.getMinutes());break;case "s":b+=this._padZero(g.getSeconds());break;case "u":b+=this._padZero(g.getMilliseconds(),
3);break;default:b+=f[e];break}return b},iso8601ToTimestamp:function(f){var g;g=f.split("T");f=g[0].split("-");g=g[1].slice(0,8).split(":");f[1]-=1;g=f.concat(g);return(new Date(g[0],g[1],g[2],g[3],g[4],g[5])).getTime()},_padZero:function(f,g){if(typeof g==="undefined")g=2;for(f=new String(f);f.length<g;)f="0"+f;return f}}})});
require.def("iplayer/controllers/consolepopupmanager",["iplayer/utils/events"],function(){var k={init:function(){if(iplayer.useragent.browser.chrome)this.console.height+=50;this.bind(document.documentElement)},console:{height:576,width:352,topOffset:null,leftOffset:null,popName:"radioconsole",resizable:false,scrollbars:false},tvconsole:{height:400,width:512,topOffset:null,leftOffset:null,popName:"tvconsole",resizable:false,scrollbars:false},barlesque:{height:800,width:989,topOffset:null,leftOffset:null,
popName:"_blank",resizable:true,scrollbars:true},complaint:{height:400,width:669,topOffset:null,leftOffset:null,popName:"_blank",resizable:false,scrollbars:true},".complain click":function(f){if(f.source.className.indexOf("complain")!==-1){f.preventDefault();f.stopPropagation();return this.popupWindow(glow.dom.get(f.source).attr("href"),this.complaint)}},".pop-new-window click":function(f){if(f.source.className.indexOf("pop-new-window")!==-1){f.preventDefault();f.stopPropagation();return this.popupWindow(glow.dom.get(f.source[0]?
f.source[0]:f.source).attr("href"),this.barlesque)}},".console-only-pop-new-window click":function(f){if(window.location.pathname.indexOf("/iplayer/console")!==-1){f.preventDefault();f.stopPropagation();return this.popupWindow((f.source[0]?f.source[0]:f.source).href,this.barlesque)}},"#_guidance_forgot_ click":function(f){if(window.location.pathname.indexOf("/iplayer/console")!==-1){f.preventDefault();f.stopPropagation();return this.popupWindow((f.source[0]?f.source[0]:f.source).href,this.barlesque)}},
"a click":function(f){var g=f.source[0]?f.source[0]:f.source;if(!(window.location.pathname.indexOf("/iplayer/console")!==-1||g.nodeName.toLowerCase()!=="a"||g.href.indexOf("/iplayer/console")===-1)){f.preventDefault();f.stopPropagation();return this.popupWindow(g.href,this.console)}},popupWindow:function(f,g){var b=this._getOptions(g);if(f=window.open(f,g.popName,b)){f.focus();return false}return true},_getOptions:function(f){var g;if(f.height>window.screen.availHeight)f.height=window.screen.availHeight;
g="width="+f.width+",height="+f.height;g+=f.scrollbars?",scrollbars=yes":",scrollbars=no";g+=f.resizable?",toolbar=yes,personalbar=yes,location=yes,directories=yes,statusbar=yes,menubar=yes,status=yes,resizable=yes,":",toolbar=no,personalbar=no,location=no,directories=no,statusbar=no,menubar=no,status=no,resizable=yes,";if(f.leftOffset)g+=",left="+f.leftOffset+",screenX="+f.leftOffset;if(f.topOffset)g+=",top="+f.topOffset+",screenY="+f.topOffset;return g}};glow.lang.apply(k,iplayer.utils.events);
require.ready(function(){k.init()});return iplayer.controllers.consolePopupManager=k});
require.def("i18n!iplayer/nls/diagnostics",{root:{testAgainLabel:"Test Again",errorUnableText:"Sorry, we are unable to carry out the speed test",errorUnavailableText:"The service is not currently available. Please try again, or come back later.",resultsTitle:"Connection speed test results",resultsTableTitle:"How your speed compares with recommended speeds:",resultsTableSummary:"iPlayer Speed Test results",descriptionHeading:"Description",speedHeading:"Speed",statusHeading:"Status",connectionSpeed:"{{connectionSpeed}} kbps",
notApplicable:"not applicable",notApplicableAbbreviation:"n/a",yourConnection:"Your connection",availableBandwidth:"Your available bandwidth is {{connectionSpeed}} kbps.",bandwidthUsage:"Uses {{bandwidthPercent}}% of your available bandwidth.",passed:"passed",failed:"failed",startButtonLabel:"Start speed diagnostics test",dataCollectTitle:"How this data is collected",hd:"HD",tv:"TV",radio:"Radio",testRunningText:"The internet connection speed test is currently running. It may take a few minutes to provide your result."},
"cy-gb":true});
require.def("iplayer/views/diagnostics",["i18n!iplayer/nls/diagnostics",'text!templates/diagnostics/results-table.html!<h2>{{resultsTableTitle}}</h2>\r\n<table id="result-table" summary="{{resultsTableSummary}}">\r\n<colgroup>\r\n\t<col id="desc" />\r\n\t<col id="speed" />\r\n\t<col id="bar" />\r\n\t<col id="status" />\r\n</colgroup>\r\n<thead>\r\n\t<tr>\r\n\t\t<th class="desc">{{descriptionHeading}}</th>\r\n\t\t<th class="speed" colspan="2">{{speedHeading}}</th>\r\n\t\t<th class="status">{{statusHeading}}</th>\r\n\t</tr>\r\n</thead>\r\n<tbody>\r\n\t<tr class="first">\r\n\t\t<td class="desc">{{yourConnection}}</td>\r\n\t\t<td class="speed">{{connectionSpeed}}</td>\r\n\t\t<td class="bar"><div>{{availableBandwidth}}</div></td>\r\n\t\t<td class="status"><abbr title="{{notApplicable}}">{{notApplicableAbbreviation}}</abbr></td>\r\n\t</tr>\r\n\t{{#connectionList}}\r\n\t<tr class="{{class}}">\r\n\t\t<td class="desc">{{{label}}}</td>\r\n\t\t<td class="speed">{{speed}}</td>\r\n\t\t<td class="bar"><div>{{bandwidth}}</div></td>\r\n\t\t<td class="status"><div>{{status}}</div></td>\r\n\t</tr>\r\n\t{{/connectionList}}\r\n</tbody></table>','text!templates/diagnostics/flash-install.html!<p>You need to install Flash in order to check your connection speed.</p>\r\n<p><a href="{{flashUrl}}">Download the Flash player now</a>.</p>',
'text!templates/diagnostics/flash-upgrade.html!<p>Your current version of Flash player is unable to run the BBC iPlayer diagnostics.</p>\r\n<p>Please <a href="{{flashUrl}}">upgrade your Flash player</a>.</p>'],function(k,f,g,b){var e=function(){this.flashUrl="http://www.adobe.com/go/getflashplayer"};e.prototype={createTestAgainButton:function(){var h=glow.dom.create('<a class="button" id="test-again" href="#"><span>'+k.testAgainLabel+"</span></a>");glow.dom.get("#results-help h3.related").before(h)},
showErrorPage:function(){glow.dom.get("#bip-diagnostics-container").removeClass("start");glow.dom.get("#bip-diagnostics h1").text(k.errorUnableText);glow.dom.get("#bip-diagnostics .intro").remove();glow.dom.get("#bip-diagnostics #diagnostics-flash-container").remove();glow.dom.get("#bip-diagnostics").append(glow.dom.create("<p>"+k.errorUnavailableText+"</p>"))},showResultsPage:function(){glow.dom.get("#bip-diagnostics-container").removeClass("start");glow.dom.get("#bip-diagnostics h1").text(k.resultsTitle);
glow.dom.get("#bip-diagnostics #results-help").css("display","block")},getResultsGraphHtml:function(h,c){k.connectionSpeed=Mustache.to_html(k.connectionSpeed,{connectionSpeed:h});k.availableBandwidth=Mustache.to_html(k.availableBandwidth,{connectionSpeed:h});k.connectionList=[];for(var j=0;j<c.length;j++){var l=c[j];k.connectionList.push({"class":l.speed<=h?"pass":"fail",label:l.label,speed:l.speed,bandwidth:Mustache.to_html(k.bandwidthUsage,{bandwidthPercent:Math.floor(l.speed/h*100)}),status:l.speed<=
h?"passed":"failed"})}return Mustache.to_html(f,k)},initDataCollectUI:function(){var h=glow.dom.create('<button id="diagnostics-activate"><span class="blq-hide">'+k.startButtonLabel+"</span></button>");glow.dom.get("#diagnostics-flash-container").append(h);glow.dom.get("#datacollect-showhide").html('<p><a href="">'+k.dataCollectTitle+"</a></p>");glow.dom.get("#datacollect-information").css("height","0px")},htmlInstallFlash:function(){k.flashUrl=this.flashUrl;return Mustache.to_html(g,k)},htmlUpgradeFlash:function(){k.flashUrl=
this.flashUrl;return Mustache.to_html(b,k)},showFauxFlash:function(){var h=glow.dom.get("#diagnostics-flash-container"),c=glow.embed.Flash.version();if(c.major>=8)for(h.addClass("flashinstalledfaux");h.firstChild;)h.removeChild(h.firstChild);else h.append(glow.dom.create(c.major===0?this.htmlInstallFlash():this.htmlUpgradeFlash()))}};return iplayer.views.diagnostics=e});
require.def("iplayer/controllers/diagnostics",["iplayer/utils/events","iplayer/views/diagnostics","i18n!iplayer/nls/diagnostics"],function(k,f,g){var b=function(){this.view=new f;this.animationPlaying=false;this.graphWidth=256;this.graphMaxSpeed=4E3;this.graphScale=this.graphWidth/this.graphMaxSpeed;this.connectionList=[{label:"<em>"+g.tv+"</em> - "+g.hd,speed:3500},{label:"<em>"+g.tv+"</em>",speed:1500},{label:"<em>"+g.tv+"</em>",speed:800},{label:"<em>"+g.tv+"</em>",speed:500},{label:"<em>"+g.radio+
"</em>",speed:128}];this.bind(document.documentElement)};glow.lang.extend(b,k,{init:function(){this.view.initDataCollectUI();this.view.showFauxFlash();glow.events.addListener("#bip-diagnostics #datacollect-showhide a","click",function(e){e.stopPropagation();e.preventDefault();var h=this;e=glow.dom.get("#datacollect-information");e.css("display","block");this.animationPlaying||glow.anim.slideToggle(e,0.5,{onStart:function(){h.animationPlaying=true;glow.dom.get("#datacollect-showhide p").toggleClass("closed").toggleClass("open")},
onComplete:function(){h.animationPlaying=false}})})},buildGraph:function(e){var h=this,c=0;e=this.view.getResultsGraphHtml(e,this.connectionList);this.tableGraph=glow.dom.create(e);this.tableGraph.get("td.bar div").each(function(){var j=c===0?0:h.connectionList[c-1].speed*h.graphScale;glow.dom.get(this).css("width",j+"px");c++})},animateGraph:function(e){e=glow.anim.css("tr.first td.bar div",1,{width:{from:0,to:(e>this.graphMaxSpeed?this.graphWidth:e*this.graphScale)+"px"}},{tween:glow.tweens.easeOut()});
var h=[];this.tableGraph.get("tbody tr.fail, tbody tr.pass").each(function(){h.push(glow.anim.css(this,0.2,{opacity:{from:0,to:1}},{tween:glow.tweens.easeOut()}))});(new glow.anim.Timeline(h)).start();e.start()},showResultsPage:function(){this.view.showResultsPage();this.view.createTestAgainButton();glow.events.addListener("#bip-diagnostics #test-again","click",function(e){e.stopPropagation();e.preventDefault();window.location.reload();return false});window.location.href="#results"},showErrorPage:function(){this.view.showErrorPage();
this.view.createTestAgainButton();window.location.href="#results"},calculateSpeed:function(e){for(var h=e.length,c=h,j=0,l=0;l<h;l++)if(e[l][0]>-1)j+=e[l][0];else c--;return c>0?Math.floor(j/c):-1},"#bip-diagnostics #diagnostics-flash-container #diagnostics-activate click":function(e){e.stopPropagation();e.preventDefault();(new glow.embed.Flash("http://www.bbc.co.uk/iplayer/dm/speedtest/speedtest.swf","#diagnostics-flash-container","8",{width:904,height:300,params:{flashvars:{configURL:"http://www.bbc.co.uk/iplayer/dm/speedtest/settings.xml"},
bgcolor:"#000",quality:"high"}})).embed();glow.dom.get("#diagnostics-flash-container").addClass("flashinstalled").removeClass("flashinstalledfaux");e=glow.dom.create('<p class="test-running">'+g.testRunningText+"</p>");glow.dom.get("#diagnostics-flash-container").after(e)},simulateGraph:function(){function e(c,j){window.setTimeout(function(){var l=h.calculateSpeed(j);if(l>-1){h.showResultsPage();h.buildGraph(l);glow.dom.get("#diagnostics-flash-container").append(h.tableGraph);h.animateGraph(l)}else h.showErrorPage()},
1200)}var h=this;e({},[[10696,80,"rtmp"],[10696,80,"rtmp"],[10696,80,"rtmp"]])}});k=function(){return{reportResults:function(e,h){window.setTimeout(function(){var c=new b,j=c.calculateSpeed(h);if(j>-1){glow.dom.get("#bip-diagnostics #test-running").destroy();c.showResultsPage();c.buildGraph(j);glow.dom.get("#diagnostics-flash-container").append(c.tableGraph);c.animateGraph(j)}else c.showErrorPage()},1200)}}}();iplayer.diagnostics=k;return iplayer.controllers.diagnostics=b});
require.def("iplayer/controllers/pagination",["iplayer/utils/events","iplayer/models/episoderegistry"],function(k,f){var g=function(b,e){this._$paginatorElement=glow.dom.get(b);this._drawer=e||null;this._$next=this._$paginatorElement.get("li.next > a");this._$prev=this._$paginatorElement.get("li.prev > a");this._$pages=this._$paginatorElement.get("li.pages > a");this._$active=this._$paginatorElement.get("a.active");this._currentPage=1;this.bind(this._$paginatorElement)};glow.lang.extend(g,k,{".pagination li a click":function(b){b.preventDefault();
var e=glow.dom.get(b.source);if(!(e.hasClass("disabled")||e.hasClass("active")))if(b.source.nodeName.toLowerCase()==="a"){b.stopPropagation();var h=this._getUrl(b.source);e=this._hideContent();glow.events.addListener(e,"complete",function(){this.getPage(h)},this);this._setActive(b.source);e.start()}},"drawer:open subscribe":function(b){if(b.drawer===this._drawer){this._$paginatorElement.css("display")==="none"&&this._$paginatorElement.css({opacity:0,display:"block"});glow.anim.fadeIn(this._$paginatorElement,
0.4)}},"drawer:close subscribe":function(b){var e=this;b.drawer===this._drawer&&glow.anim.fadeOut(this._$paginatorElement,0.3,{onComplete:function(){e._$paginatorElement.css("display","none")}})},getPage:function(b){var e=this,h={headers:{Accept:"application/json"},useCache:true,timeout:30,onLoad:function(c){c=c.json();f.addData(c.episodeRegistry);e._drawer.getContents().set(c.html);iplayer.events.publish("pagination:loaded");e._drawer.getContents().initialise();e._showContent().start();glow.dom.get("#drawer-container .link-protector").destroy()},
onError:function(){e._drawer.getContents().set('<div class="error-state"><div><h3>Sorry,</h3><p>The list is temporarily unavailable due to a technical problem.</p></div></div>');e._drawer.getContents().initialise();e._showContent().start()}};glow.dom.get("#drawer-container").prepend('<div class="link-protector"></div>');glow.net.get(b,h)},_setActive:function(b){this._$active.removeClass("active");this._$active=glow.dom.get(b).parent().hasClass("next")||glow.dom.get(b).parent().hasClass("prev")?glow.dom.get(this._$pages[this._currentPage-
1]).addClass("active"):glow.dom.get(b).addClass("active");this._updatePrevNext()},_getPageNumber:function(b){b=this._getQueries(b);return"page"in b?parseInt(b.page,10):false},_updatePrevNext:function(){this._currentPage>1?this._$prev.removeClass("disabled"):this._$prev.addClass("disabled");this._currentPage===this._$pages.length?this._$next.addClass("disabled"):this._$next.removeClass("disabled")},_getUrl:function(b){var e;if(glow.dom.get(b).parent().hasClass("prev"))this._currentPage-=1;else if(glow.dom.get(b).parent().hasClass("next"))this._currentPage+=
1;else this._currentPage=this._getPageNumber(b);e=b.pathname;b=this._getQueries(b);e=this._setQueries(e,b);return e[0]==="/"?e:"/"+e},_setQueries:function(b,e){var h=0;if(e.length===0)return b;b+="?";for(q in e)if(e.hasOwnProperty(q)){if(h)b+="&";b+=q==="page"?"page="+this._currentPage:q+"="+e[q];h++}return b},_getQueries:function(b){b=b.search.replace("?","").split("&");var e={},h,c;for(c in b){h=b[c].split("=");e[h[0]]=h[1]}return e},_hideContent:function(){return new glow.anim.Timeline([[this._drawer.getContents().hide("main")],
[this._drawer.getContents().hide("optional")]])},_showContent:function(){return new glow.anim.Timeline([[this._drawer.getContents().show("main")],[this._drawer.getContents().show("optional")]])}});return iplayer.controllers.Pagination=g});
require.def("iplayer/models/drawer",["iplayer/controllers/pagination","iplayer/models/episoderegistry","iplayer/views/error"],function(k,f,g){var b=function(e,h){h=glow.lang.apply({BACKGROUND_WIDTH:974},h);this._id=e.id;this._el=e;this._defaultWidth=glow.dom.get(this._el).width();this._minWidth=h.minWidth;this._maxWidth=h.maxWidth;this._BACKGROUND_WIDTH=h.BACKGROUND_WIDTH;this._open=this._contracted=this._expanded=this._isMoving=false;this._index=h.index;this._contents=h.contents;this._dataProvider=
h.dataProvider;this._failedRequestAttempts=0;this._isExpandable=false;this._updateIsExpandable();glow.events.addListener(this,this._id+"-loaded",function(c){this._updateDrawer(c)});glow.events.addListener(this,this._id+"-failed",function(c){this._updateFailedDrawer(c)});glow.env.ie<=7&&glow.dom.get(this._el).css("background-position","-"+(this._BACKGROUND_WIDTH-this._defaultWidth)+"px 0px")};b.prototype={getId:function(){return this._id},getDomElement:function(){return this._el},getIndex:function(){return this._index},
getContents:function(){return this._contents},close:function(){var e=this,h=[],c={onStart:function(){e._isMoving=true;glow.dom.get(e._el).removeClass("drawer-open");e._open=false;iplayer.events.publish("drawer:close",{drawer:e})},onComplete:function(){e._isMoving=false;glow.dom.get(e._el).addClass("drawer-closed");e.isExpandable()||e._contents.uncloakToggleLink();e.isInContractedState()||e._contents.show("heading").start();e._contracted=true;e._expanded=false}};if(!this.isInContractedState()){h.push([this._contents.hide()]);
h.push([this._contents.hide("alternative")])}h.push([this._animate(this._minWidth,c)]);return h},open:function(){var e=this,h=[],c={onStart:function(){e._isMoving=true;glow.dom.get(e._el).addClass("drawer-open");e._open=true;iplayer.events.publish("drawer:open",{drawer:e})},onComplete:function(){e._isMoving=false;glow.dom.get(e._el).removeClass("drawer-closed");if(e.isInContractedState())e._contents.show().start();else e.isInDefaultState()&&e._contents.show("optional").start();e._contracted=false;
e._expanded=true}};this.isInContractedState()&&h.push([this._contents.hide()]);h.push([this._contents.hide("alternative")]);h.push([this._animate(this._maxWidth,c)]);return h},reset:function(){var e=this,h=[],c={onStart:function(){e._isMoving=true;glow.dom.get(e._el).removeClass("drawer-open");iplayer.events.publish("drawer:close",{drawer:e})},onComplete:function(){e._isMoving=false;glow.dom.get(e._el).removeClass("drawer-closed");e.isExpandable()||e._contents.cloakToggleLink();e.isInContractedState()&&
e._contents.show("default").start();e._contents.show("alternative").start();e._contracted=false;e._expanded=false}};e.isInContractedState()?h.push([e._contents.hide()]):h.push([e._contents.hide("optional")]);h.push([this._animate(this._defaultWidth,c)]);return h},isInDefaultState:function(){return!this._expanded&&!this._contracted},isInContractedState:function(){return this._contracted},isInOpenState:function(){return this._open},isMoving:function(){return this._isMoving},_animate:function(e,h){var c=
{tween:glow.tweens.easeBoth()};c=glow.lang.apply(c,h);e=glow.env.ie<=7?{width:{to:e},"background-position":{from:"-"+(this._BACKGROUND_WIDTH-glow.dom.get(this._el).width())+"px 0px",to:"-"+(this._BACKGROUND_WIDTH-e)+"px 0px"}}:{width:{to:e}};return glow.anim.css(this._el,0.5,e,c)},setDataProvider:function(e){this._dataProvider=e;return this},loadContentFromProvider:function(e){var h=this;if(e==undefined)e=this._dataProvider;glow.events.fire(this,this._id+"-loading");glow.net.get(e,{headers:{Accept:"application/json",
"X-Iplayer-Drawer-Status":"Initialise"},onLoad:function(c){if(c.status==200){h._failedRequestAttempts=0;c=c.json();glow.events.fire(h,h._id+"-loaded",{content:c,drawer:h})}else h._failedRequest(c)},onError:function(c){h._failedRequest(c)}})},isExpandable:function(){return this._isExpandable},_updateIsExpandable:function(){if(this._isExpandable!==true)if(this.getContents().hasOptionalContent()){this._isExpandable=true;this._contents.uncloakToggleLink()}else this._contents.cloakToggleLink()},_failedRequest:function(e){this._failedRequestAttempts++;
log("Failed attempts to load : "+this._dataProvider,this._failedRequestAttempts);this._failedRequestAttempts<iplayer.config.drawerLoadAttemps?this.loadContentFromProvider():glow.events.fire(this,this._id+"-failed",{content:e.statusText(),drawer:this})},_updateDrawer:function(e){var h=glow.dom.create(e.content.html);for(i=0;i<h.length;i++)if(h[i].className=="pagination"){var c=h.slice(i,i+1);delete h[i];h.length--}this.getContents().set(h.html());this.getContents().initialise();if(c!=undefined){c.css({opacity:"0",
display:"none"});glow.dom.get("#"+this.getId()+" div.content").after(c);iplayer.managers.drawerManager[this.getId()]=new k(c,iplayer.managers.drawerManager._drawers[this.getId()])}var j=this,l=function(){if(!e.drawer.isInContractedState()){var r=[];r.push([j.getContents().show("main")]);if(e.drawer.isInOpenState()){r.push([j.getContents().show("optional")]);c!=undefined&&r.push([glow.anim.css(c,0.4,{opacity:{from:0,to:1}},{onStart:function(){c.css("display","block")}})])}else r.push([j.getContents().show("alternative")]);
(new glow.anim.Timeline(r)).start()}};if(e.drawer.isMoving())var m=glow.events.addListener(document,"drawermanager:animationcomplete",function(){l();glow.events.removeListener(m)});else l();e.content.episodeRegistry!=undefined&&f.addData(e.content.episodeRegistry);this._updateIsExpandable()},_updateFailedDrawer:function(){this.getContents().set((new g("Sorry, ","The list is temporarily unavailable due to a technical problem.")).render());this.getContents().show("default")}};return iplayer.models.Drawer=
b});
require.def("iplayer/controllers/drawermanager",["iplayer/utils/events","iplayer/models/drawer","iplayer/models/drawercontent","iplayer/controllers/pagination"],function(k,f,g,b){var e=function(h,c){var j=this;c=glow.lang.apply({MIN_WIDTH:50,drawerClass:"drawer"},c);this._$drawerContainer=glow.dom.get(h);if(this._$drawerContainer.length!==0){this._$drawers=glow.dom.get("."+c.drawerClass);if(this._$drawers.length!==0){this._drawers={};this._paginators={};this._MIN_WIDTH=c.MIN_WIDTH;this._MAX_WIDTH=this._getMaxExpansionWidth();
this._isMoving=false;this._masterId=null;this._$drawers.each(function(l){var m=glow.dom.get(this).get("h2 > a"),r=glow.dom.get(this).get("div.content"),o=glow.dom.get(this).get("div.pagination");j._drawers[this.id]=new f(this,{minWidth:j._MIN_WIDTH,maxWidth:j._MAX_WIDTH,index:l,contents:new g(r,m)});if(o.length)j._paginators[this.id]=new b(o,j._drawers[this.id])});this.bind(this._$drawerContainer)}}};glow.lang.extend(e,k,{"a.drawer-toggle click":function(h){h.preventDefault();h.stopPropagation();
if(!this._isMoving)if(this._$drawers.length!==1){this._masterId=this._getMasterDrawerId(h.source);this.toggle()}},getDrawerByIndex:function(h){return h==undefined?this._drawers:this._drawers[h]},_getMasterDrawerId:function(h){return iplayer.utils.getAncestor(h,"div","drawer").id},toggle:function(h){var c=this;this._masterId=h=h||this._masterId;var j,l,m=[];if(this._drawers[h].isInDefaultState()||this._drawers[h].isInContractedState()){j=f.prototype.open;l=f.prototype.close}else j=l=f.prototype.reset;
if(!this._drawers[h].isExpandable())if(this._drawers[h].isInContractedState())j=l=f.prototype.reset;else return;for(d in this._drawers)m=d===h?m.concat(j.call(this._drawers[d])):m.concat(l.call(this._drawers[d]));(new glow.anim.Timeline(m,{onStart:function(){c._isMoving=true},onComplete:function(){c._masterId=null;c._isMoving=false;iplayer.events.publish("drawermanager:animationcomplete")}})).start()},"iplayer:drawermanager:toggle subscribe":function(h){this.toggle(h.id)},_getMaxExpansionWidth:function(){return this._$drawerContainer.width()-
(this._$drawers.length-1)*this._MIN_WIDTH}});return iplayer.controllers.DrawerManager=e});require.def("iplayer/views/error",function(){var k=function(f,g){this._title=f;this._message=g};k.prototype={render:function(){return glow.dom.create('<div><div class="error-state"><div><h3>{title}</h3><p>{message}</p></div></div></div>',{interpolate:{title:this._title,message:this._message}}).html()}};return iplayer.views.Error=k});
require.def("iplayer/models/drawercontent",function(){var k=function(f,g){this._$content=glow.dom.get(f);this._$heading=glow.dom.get(g);this._$defaultContent=this._$content.get(".default");this._$optionalContent=this._$content.get(".optional");this._$alternativeContent=this._$content.get(".alternative")};k.prototype={hasOptionalContent:function(){return this._$optionalContent.length!==0?true:false},cloakToggleLink:function(){glow.dom.get(this._$heading).addClass("toggle-cloaked")},uncloakToggleLink:function(){glow.dom.get(this._$heading).removeClass("toggle-cloaked")},
hide:function(f){var g=this._getContents(f);return glow.anim.css(g,0.4,{opacity:{to:0}},{onComplete:function(){g.css("display","none")}})},show:function(f){var g=this._getContents(f);return glow.anim.css(g,0.4,{opacity:{from:0,to:1}},{onStart:function(){g.css("display","block")}})},_getContents:function(f){var g=new glow.dom.NodeList;switch(f){case "heading":g=this._$heading;break;case "optional":g=this._$optionalContent;break;case "alternative":g=this._$alternativeContent;break;case "main":g=this._$defaultContent;
break;case "default":g.push(this._$heading,this._$defaultContent);break;default:g.push(this._$heading,this._$defaultContent,this._$optionalContent);break}return g},makeVisible:function(f){f=f?"block":"none";this._getContents().css("display",f)},set:function(f){this._$content[0].innerHTML=f;this._$defaultContent=this._$content.get(".default");this._$optionalContent=this._$content.get(".optional");this._$alternativeContent=this._$content.get(".alternative")},initialise:function(){this._$defaultContent.css("opacity",
"0");this._$defaultContent.css("display","none");this._$optionalContent.css("opacity","0");this._$optionalContent.css("display","none");this._$alternativeContent.css("opacity","0");this._$alternativeContent.css("display","none")}};return iplayer.models.DrawerContent=k});
require.def("iplayer/controllers/electra",["iplayer/models/episoderegistry"],function(k){return iplayer.controllers.electra={returnPath:"",episode:false,isRedirecting:false,setPid:function(f){this.episode=k.find(f)},_goToInstallUrl:function(f,g){window.location.href="/iplayer/install/"+(g?"upgrade/":"")+"?pid="+this.episode.getPid()+"&vpid="+this.episode.getVersionId()+"&downloadaction="+f+(this.episode.isHD()?"&hd=1":this.episode.isSign()?"&sign=1":this.episode.isAD()?"&ad=1":"")},installComplete:function(){if(this.isRedirecting)return false;
window.location.href=this.returnPath;return this.isRedirecting=true},flashCallback:function(f,g,b,e){this[f]&&this[f].apply(this,[g,b,e])},openInstallPage:function(f,g,b){this._goToInstallUrl(b)},openUpgradePage:function(f,g,b){this._goToInstallUrl(b,true)},downloadComplete:function(f){iplayer.events.publish("iplayer:livestats:download",{pid:f})}}});
require.def("iplayer/controllers/favouritescarouselinit",["iplayer/utils/events"],function(k){var f=function(g){this._failedRequestAttempts=0;this._circuitBreakerKill=3;iplayer.config.showFavouritesCarousel&&this.loadFavouritesCarousel();this.bind(g)};glow.lang.extend(f,k,{loadFavouritesCarousel:function(){var g=this;glow.net.get(iplayer.config.root+"usercomponents/favourites/invoke?service_type="+iplayer.servicetype.master,{onLoad:function(b){var e=iplayer.utils.getScripts(b.text());b=iplayer.utils.removeInlineScripts(b.text());
b=glow.dom.create(b);b.get("#my-favourites-menu").css("opacity",0);glow.dom.get("#bip-nav").after(b);iplayer.utils.evalScripts(e);g._failedRequestAttempts=0},onError:function(){g._failedRequestAttempts++;g._failedRequestAttempts<g._circuitBreakerKill&&g.loadFavouritesCarousel()}})},"iplayer:carousel:ready subscribe":function(){glow.anim.fadeIn("#my-favourites-menu",2)},"iplayer:signin subscribe":function(){if(iplayer.config.showFavouritesCarousel){var g=glow.dom.get("#my-favourites"),b=this;glow.anim.fadeOut(g,
0.4,{onComplete:function(){iplayer.events.publish("iplayer:favouritescarousel:reset");g.children().destroy();b.loadFavouritesCarousel()}})}}});return iplayer.controllers.FavouritesCarouselInit=f});
require.def("i18n!iplayer/nls/favourites",{root:{itemCount:"{items} items",itemCountSingle:"1 item",newCount:"{newItems} new",expiringCount:"{expiringItems} expiring",favouritesUnavailableError:"Sorry, your favourites are not available right now.",lastPlayedPlaceholderText:"Your last played programmes will appear here.",lastPlayedClearButton:'Clear<span class="blq-hide"> your last played items</span>'},"cy-gb":true,"gd-gb":true});
require.def("iplayer/models/favouritescarousel",["iplayer/models/episoderegistry","i18n!iplayer/nls/favourites"],function(k,f){var g=function(b){this._$container=glow.dom.get(b);this._$parentContainer=this._$container.parent();this.carousel=null;this._isVisible=false};g.prototype={_create:function(){var b;this._$parentContainer&&this._$parentContainer.css({position:"absolute",left:"-9999px"});b=this._$container.get("> ul");b.css("display","block");this.carousel=new glow.widgets.Carousel(b,{loop:false,
size:6,step:6});this._$parentContainer.css({position:"relative",left:0});this._$container.css({display:"none",opacity:0});this._$container.get("> div").css("position","static")},sortTopLevelItems:function(){var b,e;b=this._$container.get("> ul");e=b.get("> li");e=e.slice(1);e=this.sortListItems(e,"new");b.append(e)},show:function(){this.carousel||this._create();var b=this,e={tween:glow.tweens.easeBoth(),onStart:function(){b._$container.css({display:"block"});b._isVisible=true}};return glow.anim.css(this._$container,
0.4,{opacity:{from:0,to:1}},e)},hide:function(){var b=this,e={tween:glow.tweens.easeBoth(),onComplete:function(){b._$container.css("display","none");b._isVisible=false}};return glow.anim.css(this._$container,0.4,{opacity:{from:1,to:0}},e)},toggle:function(){return this._isVisible?this.hide():this.show()},addNewFavourite:function(b){b.setStyle("favourites-bar");var e=this._$container.get("li.last-played");b=glow.lang.interpolate('<li class="new-favourite"><a href="{my_url}">{display_title}\t<img src="{image_120.src}" width="{image_120.width}" height="{image_120.height}" alt="{image_120.alt}" />\t</a><span>New favourite</span></li>',
{my_url:b.getPageUrl(),display_title:b.displayTitle(),image_120:b.getImageDetails(120)});var h=glow.dom.get("#my-favourites-all-menu"),c=parseInt(h.text(),10)+1;c=c===1?f.itemCountSingle:glow.lang.interpolate(f.itemCount,{items:c});h.text(c);if(this.carousel){b=glow.dom.create(b);e.length?this.carousel.addItems(b,1):this.carousel.addItems(b,0);this._$container.get("li.no-favourites").length&&this.carousel.removeItem(2)}else{this._$container.get("> ul > li.last-played").after(b);this._$container.get("li.no-favourites").destroy()}},
getListItems:function(b){var e=this._$container.get("ul.carousel li");e=e.filter(function(){return glow.dom.get(this).hasClass(b)&&!glow.dom.get(this).hasClass("carousel-pad")});return!e.length?e:e.clone()},sortListItems:function(b,e){var h=function(l,m){l=j(l);m=j(m);l=iplayer.utils.date.iso8601ToTimestamp(l.getActualStart());m=iplayer.utils.date.iso8601ToTimestamp(m.getActualStart());return-(l-m)},c=function(l,m){l=j(l);m=j(m);l=iplayer.utils.date.iso8601ToTimestamp(l.getAvailableUntil());m=iplayer.utils.date.iso8601ToTimestamp(m.getAvailableUntil());
return l-m},j=function(l){l=iplayer.utils.getPid(l);var m=k.find(l);if(!m)throw new Error("No episode with pid "+l+" found");return m};if(e==="new")e=h;else if(e==="expiring")e=c;else throw new Error("No sort order provided");return b=b.sort(e)}};return iplayer.models.FavouritesCarousel=g});
require.def("iplayer/controllers/favouritescarouselmanager",["iplayer/utils/events","iplayer/models/favouritescarousel","iplayer/models/favouritesbrandcarousel","iplayer/models/favouritescarouselcontainer","i18n!iplayer/nls/favourites"],function(k,f,g,b,e){var h=function(c,j){this._carouselContainer=c;this._carousels=j;this._visibleCarousel=this._currentCarousel=null;this._brandCarousels=[];this._isMoving=false;this._setupFilters();this._container=glow.dom.get("#my-favourites");this._$triggers=this._container.get("#my-favourites-menu a.trigger");
this._$filters=this._container.get("#my-favourites-menu a.filter");this._$selected=this._$filters.filter(function(){return glow.dom.get(this).hasClass("selected")});this._titleTrigger=this._$triggers.get(".title");this._setCurrentCarousel(this._getCarouselId(this._$selected.item(0).id));this._currentCarousel.sortTopLevelItems();this.bind(this._container);this._container.hasClass("open")&&this.toggleCarousel(this._$triggers.slice(0,1))};glow.lang.extend(h,k,{"iplayer:favouritescarousel:reset subscribe":function(){this.unbind();
this._brandCarousels=this._visibleCarousel=this._currentCarousel=this._carousels=this._carouselContainer=null},"iplayer:emp:play subscribe":function(){this.closeCarousel()},"#my-favourites-menu a.trigger click":function(c){c.preventDefault();c=glow.dom.get(c.source);if(!this._isMoving){this._isMoving=true;this.toggleCarousel(c)}},"a.brand-show click":function(c){c.preventDefault();this._showBrandCarousel(this._getBrandCarousel(c.source))},"a.brand-close click":function(c){c.preventDefault();this._hideBrandCarousel(this._getBrandCarousel(c.source))},
"iplayer:addFavourite subscribe":function(c){c=c.episode;iplayer.servicetype.master==c.getServiceType()&&c.getAvailability()==="CURRENT"&&this._carousels["my-favourites-all-carousel"].addNewFavourite(c)},_getCarouselId:function(c){c=c.split("-");c.pop();c.push("carousel");return c.join("-")},_getSelected:function(){return this._$selected},_setSelected:function(c){this._$selected.removeClass("selected");this._$selected=c;this._$selected.addClass("selected")},_isSelected:function(c){return c.hasClass("selected")},
_getCurrentFilter:function(){return this._getSelected()},_isFilter:function(c){return c.hasClass("filter")},_setCurrentCarousel:function(c){this._isCarousel(c)||this._createCarousel(c);this._currentCarousel=this._carousels[c]},_isUnselectedFilter:function(c){return this._isFilter(c)&&!this._isSelected(c)},_addCarousel:function(c,j){if(this._isCarousel(c))throw new Error("this carousel id is already taken");else this._carousels[c]=j},_createCarousel:function(c){var j;j=this._getType(c);this._constructCarouselStructure(c,
j);j=new f(document.getElementById(c));this._addCarousel(c,j)},_getType:function(c){if(c.indexOf("new")!==-1)c="new";else if(c.indexOf("expiring")!==-1)c="expiring";else throw new Error("no type found");return c},_constructCarouselStructure:function(c,j){var l=this._carousels["my-favourites-all-carousel"],m=l.getListItems(j);m=l.sortListItems(m,j);c=glow.dom.create('<div id="{id}" class="favourites-carousel"><ul class="carousel"></ul></div>',{interpolate:{id:c}});c.get("ul.carousel").append(m);this._carouselContainer.append(c)},
_isCarousel:function(c){return c in this._carousels},toggleCarousel:function(c){var j=this,l=[],m=[],r=null;r=null;this._favouritesBlock();if(this._isUnselectedFilter(c)){this._setSelected(c);r=this._getCarouselId(this._$selected.item(0).id);if(this._carouselContainer.isOpen()){m.push(f.prototype.hide);m.push(f.prototype.show);this._setCurrentCarousel(r);l.push([m[0].call(this._visibleCarousel),m[1].call(this._currentCarousel)])}else{this._setCurrentCarousel(r);this._visibleCarousel=this._currentCarousel;
m.push(f.prototype.show);m.push(b.prototype.show);l.push([m[0].call(this._visibleCarousel)]);l.push([m[1].call(this._carouselContainer)])}}else{if(!this._visibleCarousel)this._visibleCarousel=this._currentCarousel;m.push(f.prototype.toggle);m.push(b.prototype.toggle);l.push([m[0].call(this._visibleCarousel)]);l.push([m[1].call(this._carouselContainer)])}r=new glow.anim.Timeline(l,{destroyOnComplete:true,onComplete:function(){j._carouselContainer.isOpen()||j._container.removeClass("open");j._visibleCarousel=
j._currentCarousel;j._isMoving=false}});j._carouselContainer.isOpen()||j._container.addClass("open");r.start();this._favouritesUnblock()},closeCarousel:function(){var c=this,j=[],l=[];this._favouritesUnblock();if(this._carouselContainer.isOpen()){l.push(f.prototype.toggle);l.push(b.prototype.toggle);j.push([l[0].call(this._visibleCarousel)]);j.push([l[1].call(this._carouselContainer)]);j=new glow.anim.Timeline(j,{destroyOnComplete:true,onComplete:function(){c._carouselContainer.isOpen()||c._container.removeClass("open");
c._visibleCarousel=c._currentCarousel;c._isMoving=false}});this._isMoving=true;j.start()}},_getBrandCarousel:function(c){var j;if(glow.dom.get(c).hasClass("brand-show"))if("brandCarousel"in c)j=this._brandCarousels[c.brandCarousel];else{c.brandCarousel=j=this._brandCarousels.length;c=glow.dom.get(c).parent().get("div.brand-container").clone(true);c.attr("id","brand-"+j);this._carouselContainer.append(c);c.css("display","block");j=this._brandCarousels[j]=new g(c)}else if(glow.dom.get(c).hasClass("brand-close")){for(c=
c.parentNode;c.id.indexOf("brand")!==0;)c=c.parentNode;j=c.id.split("-")[1];j=this._brandCarousels[j]}return j},_showBrandCarousel:function(c){var j=[],l=this;j.push(this._visibleCarousel.hide());j.push(c.show());(new glow.anim.Timeline(j,{destroyOnComplete:true,onComplete:function(){l._visibleCarousel=c}})).start()},_hideBrandCarousel:function(c){var j=[],l=this;j.push(c.hide());j.push(this._currentCarousel.show());animation=(new glow.anim.Timeline(j,{destroyOnComplete:true,onComplete:function(){l._visibleCarousel=
l._currentCarousel}})).start()},_setupFilters:function(){var c=this._carousels["my-favourites-all-carousel"],j=c.getListItems("new").length;c=c.getListItems("expiring").length;j=glow.dom.create("<li>"+(j>0?'<a href="#" class="filter trigger" id="my-favourites-new-menu">'+e.newCount+"</a>":e.newCount)+"</li><li>"+(c>0?'<a href="#" class="filter trigger" id="my-favourites-expiring-menu">'+e.expiringCount+"</a>":e.expiringCount)+"</li>",{interpolate:{newItems:j,expiringItems:c}});glow.dom.get("#my-favourites-menu > div > ul").append(j)},
_favouritesBlock:function(){this._container.height()>0&&this._container.css({display:"block",height:this._container.height()})},_favouritesUnblock:function(){this._container.css({display:"",height:""})}});return iplayer.controllers.FavouritesCarouselManager=h});require.def("iplayer/models/favouritesbrandcarousel",["iplayer/models/favouritescarousel"],function(k){var f=function(){arguments.callee.base.apply(this,arguments)};glow.lang.extend(f,k,{});return iplayer.models.FavouritesBrandCarousel=f});
require.def("iplayer/models/favouritescarouselcontainer",function(){var k=function(f){this._CAROUSEL_HEIGHT="156px";this._$carouselContainer=glow.dom.get(f);this._isOpen=false};k.prototype={append:function(f){this._$carouselContainer.append(glow.dom.get(f))},show:function(){var f=this;return this._slideElement("down",{onStart:function(){f._isOpen=true}})},hide:function(){var f=this;return this._slideElement("up",{onComplete:function(){f._isOpen=false}})},toggle:function(){return this._isOpen?this.hide():
this.show()},_slideElement:function(f,g){var b,e,h=this._CAROUSEL_HEIGHT;g=glow.lang.apply({tween:glow.tweens.easeBoth(),onStart:function(){},onComplete:function(){}},g);if(f==="up"){this._$carouselContainer.css("overflow","hidden");glow.env.ie<8&&this._$carouselContainer.css("zoom",1);e=0;b=h}else if(f==="down"){b=0;e=h}f=glow.anim.css(this._$carouselContainer,0.4,{height:{from:b,to:e}},g);glow.events.addListener(f,"frame",function(){iplayer.events.publish("ishout:frame:calculation",{value:this.value,
start:b,end:e})});return f},isOpen:function(){return this._isOpen}};return iplayer.models.FavouritesCarouselContainer=k});
require.def("iplayer/controllers/favouritesmanager",["iplayer/utils/events","iplayer/accordion/accordion","iplayer/controllers/arialandmarks","iplayer/models/loader","i18n!iplayer/nls/favourites"],function(k,f,g,b,e){var h=function(c){this._$favouritesManager=glow.dom.get("#"+c);this._$filterSpinner=glow.dom.get("#favourites-manager-service_types ul");if(this._$favouritesManager.length!==0){new f("#favourites-manager-list .brand",".toggle",".episode_list");this._updateStats();this.bind(this._$favouritesManager);
this._isToggling=this._isProcessing=false;this._loader=null}};glow.lang.extend(h,k,{"a.favourites-manager-service_types-link click":function(c){if(this._isToggling)return false;this._isToggling=true;this.getFavouritesForServiceType(/favourites-manager-service_type-link-(.*)/.exec(c.source.id)[1])},getFavouritesForServiceType:function(c){var j=this;this._startAnimatedOperation();var l=glow.dom.get("#favourites-manager-list");glow.anim.fadeTo(l,0.1);glow.net.get(iplayer.config.root+"usercomponents/favouritesmanager/invoke?servicetype="+
c+"&render=list",{useCache:true,onLoad:function(m){glow.dom.get(".favourites-manager-service_types-link").parent().removeClass("selected");glow.dom.get("#favourites-manager-service_type-link-"+c).parent().addClass("selected");l.html(m.text());glow.anim.fadeIn(l,1);j._updateStats();new f("#favourites-manager-list .brand",".toggle",".episode_list");j._endAnimatedOperation()},onError:function(){j._endAnimatedOperation();l.html("<p>"+e.favouritesUnavailableError+"</p>");glow.anim.fadeIn(l,1);glow.anim.slideDown(l,
1)}});glow.net.get(iplayer.config.root+"usercomponents/lastplayed/invoke?servicetype="+c,{useCache:true,onLoad:function(m){var r=glow.dom.get("#last-played"),o=glow.dom.create(m.text());o.css({opacity:0});if(r.length>0)glow.anim.fadeOut(r,1,{onComplete:function(){r.destroy();glow.dom.get("#manage-favourites div.list").append(o);glow.anim.fadeIn(o,1);glow.events.fire(o,"lastplayed::ready");j._isToggling=false}});else{glow.dom.get("#manage-favourites div.list").append(o);glow.anim.fadeIn(o,1);glow.events.fire(o,
"lastplayed::ready")}new g("FAVOURITES-LASTPLAYED")}})},"#favourites-manager-list .actions .download click":function(c){if(!this._isProcessing)try{var j=c.source,l=/favourites-download-(.*)-(.*)/.exec(j.id),m=l[1],r=l[2],o=glow.dom.get(j).hasClass("selected");this._startOperation();glow.anim.fadeTo(j,0.5,1);var w=this;iplayer.net.send("PUT","sendfavourite",{isAutomaticDownload:!o?1:0,favouriteId:r,favouriteType:m+"_id"},{endPoint:iplayer.config.talkback.url,uri:"/iplayer/favourites/"+m+"/"+r,useCache:true,
onLoad:function(){o?glow.dom.get(j).removeClass("selected"):glow.dom.get(j).addClass("selected");glow.anim.fadeTo(j,1,1);w._endOperation()},onError:function(v){glow.anim.fadeTo(j,1,0.5);w._endOperation();log(v.text())}})}catch(s){glow.anim.fadeTo(j,1,0.5);this._endOperation();log(s)}finally{return false}},"#favourites-manager-list .actions .remove click":function(c){if(!this._isProcessing)try{var j=c.source,l=/favourites-remove-(.*)-(.*)/.exec(j.id),m=l[1],r=l[2];this._startOperation();var o=this;
iplayer.net.send("DELETE","sendfavourite",{favouriteId:r,favouriteType:m+"_id"},{endPoint:iplayer.config.talkback.url,uri:"/iplayer/favourites/"+m+"/"+r,useCache:true,onLoad:function(s){var v=glow.dom.get(j).parent().parent().parent().parent();glow.anim.fadeOut(v,1);var n=glow.anim.fadeOut(v,0.5);glow.events.addListener(n,"complete",function(){v.remove();o._updateStats();new f("#favourites-manager-list .brand",".toggle",".episode_list")});iplayer.cookie.set(iplayer.config.cookie.name,iplayer.config.cookie.key.lastFavouriteModified,
s.self().event_time_epoch_ms);o._endOperation()},onError:function(s){o._endOperation();log(s?s.text():"Error removing a favourite.")}})}catch(w){this._endOperation();log(w)}finally{return false}},"#clear-lastplayed click":function(){var c=glow.dom.get("#last-played"),j=c.get("> div.content");glow.anim.fadeOut(c,1);iplayer.net.send("POST","sendclearplays",{},{endPoint:iplayer.config.talkback.url,uri:"/iplayer/lastplayed/clear",onLoad:function(l){iplayer.cookie.set(iplayer.config.cookie.name,iplayer.config.cookie.key.recentlyPlayedModified,
l.self().event_time_epoch_ms);j.html('<div class="lastplayed-empty"><p>'+e.lastPlayedPlaceholderText+'</p></div><p class="button button-disabled"><a href="#" id="clear-lastplayed-disabled">'+e.lastPlayedClearButton+"</a></p>");glow.anim.fadeIn(c,1)}})},_startOperation:function(){this._isProcessing=true},_startAnimatedOperation:function(){this._startOperation();if(glow.dom.get("#favourites-manager-list").text().length>1){glow.dom.get("#manage-favourites").prepend('<div class="link-protector"></div>');
glow.dom.get("#manage-favourites .loader").remove();this._loader=new b(glow.dom.get("#favourites-manager-list"),null,"before");this._loader.show()}},_endOperation:function(){this._isProcessing=false},_endAnimatedOperation:function(){this._endOperation();if(this._loader!==null){glow.dom.get("#manage-favourites .link-protector").destroy();this._loader.hide();this._loader=null}},_updateStats:function(){var c;c=glow.dom.get("#favourites-manager-list .brand").hasClass("readOnly")?0:glow.dom.get("#favourites-manager-list .episode").length;
glow.dom.get("#favourites-manager-menu li.first").text(c==1?e.itemCountSingle:glow.lang.interpolate(e.itemCount,{items:c}));c=glow.dom.get("#favourites-manager-list .episode.new").length;glow.dom.get("#favourites-manager-menu li.new").text(glow.lang.interpolate(e.newCount,{newItems:c}));c=glow.dom.get("#favourites-manager-list .episode.expiring").length;glow.dom.get("#favourites-manager-menu li.expiring").text(glow.lang.interpolate(e.expiringCount,{expiringItems:c}))}});return iplayer.controllers.FavouritesManager=
h});require.def("iplayer/controllers/friendsactivity",function(){return iplayer.controllers.FriendsActivity=function(){var k=iplayer.config.root+"usercomponents/friendsactivity/fragment?servicetype="+iplayer.servicetype.master;iplayer.managers&&iplayer.managers.drawerManager&&iplayer.managers.drawerManager.getDrawerByIndex("drawer-4").setDataProvider(k).loadContentFromProvider()}});
require.def("iplayer/controllers/homepageupdate",function(){return function(k){this.handlerId=null;this.identity=k;if(this.identity.addLoginHandler)this.handlerId=this.identity.addLoginHandler(function(){window.location.reload()})}});
require.def("iplayer/controllers/identity",function(){return function(k){var f=glow.dom.get("#blq-mast");glow.dom.create('<div id="id-status"></div>').prependTo(f);k.onLoad(function(){k.status.refresh()});if(DEBUG){if(typeof idProperties==="undefined"||typeof k.status==="undefined"||typeof k.status.enableJavaScript==="undefined")throw new Error("identity js enable code for dev  & debugis not working anymore. Please check whether their Api has changed");if(document.location.host!="pal.sandbox.dev.bbc.co.uk")idProperties.secureServer=
document.location.protocol+"//"+document.location.host;k.status.enableJavaScript()}}});
require.def("iplayer/controllers/install",["iplayer/controllers/electra"],function(k){var f=function(g,b,e,h,c){this._playlistUrl=g;this._episodePid=b;this._episodeVersionPid=e;this._downloadAction=c;this._flashVersion=this._requiredFlashVersion();this._electraVersion=iplayer.config.electra.version;k.returnPath=h;(new glow.embed.Flash(iplayer.config.desktop.baseUrl+"iplayer_install_badge.swf","#install #badge",this._flashVersion,{width:"217",height:"180",message:'<p>To install the BBC iPlayer Desktop, you first need to <a href="http://get.adobe.com/flashplayer/">upgrade your flash</a>.</p>',
attributes:{id:"electraFlash",name:"electrabadge",allowfullscreen:"false",scale:"showall",wmode:"window"},params:{flashVars:{flashVersionRequired:this._flashVersion,electraVersionRequired:this._electraVersion,pid:this._episodePid,playItem:this._episodeVersionPid,playlist:this._playlistUrl,base:iplayer.config.desktop.baseUrl,debugging:"on",domain:location.href,jscallback:"iplayer.controllers.electra.flashCallback",action:this._downloadAction}}})).embed()};f.prototype={_requiredFlashVersion:function(){var g=
iplayer.useragent.os.linux||iplayer.useragent.os.unix,b=iplayer.config.electra.flashVersionRequired.win.full,e=iplayer.config.electra.flashVersionRequired.mac.full,h=iplayer.config.electra.flashVersionRequired.linux.full;return iplayer.useragent.os.mac?e:g?h:b}};return iplayer.controllers.Install=f});
require.def("iplayer/models/cta",["iplayer/models/episoderegistry","iplayer/controllers/electra"],function(k,f){var g=function(b){this._pid=b;this._episode=k.find(b);this._playlistUrl=iplayer.config.emp.baseUrl+this._episode.getPlaylistUrl();this._versionId=this._episode.getVersionId();this._$downloadBadge=this._$html=null;this._flashConfig.params.flashVars.pid=this._pid;this._flashConfig.params.flashVars.playItem=this._versionId;this._flashConfig.params.flashVars.playlist=this._playlistUrl;if(this._episode.isHD()){this._flashConfig.params.flashVars.bitrateCeiling=
4E3;this._flashConfig.params.flashVars.bitrateFloor=2500}};g.prototype={FAVOURITE_TOOLTIP:"Add to favourites",CTA_HTML:'<ul class="ctas"><li class="cta-add-favourite"><a href="#" class="pid-{pid} cta-add-to-favourites {isFavourited}" title="{favouritesToolTip}" to favourites">Add to favourites</a></li><li class="cta-download"><span></span></li></ul>',_flashConfig:{width:"100%",height:"100%",message:"",id:"electraFlash",params:{bgcolor:"#111111",name:"electrashim",allowfullscreen:"false",scale:"showall",
wmode:"window",allowScriptAccess:"always",flashVars:{action:"download",base:iplayer.config.desktop.baseUrl,flashVersionRequired:iplayer.config.emp.flashVersionRequired.full,electraVersionRequired:iplayer.config.electra.version,pid:null,playItem:null,playlist:null,domain:location.href,bitrateCeiling:null,bitrateFloor:null,debugging:"on",installUrl:"iplayer/install",jscallback:"iplayer.controllers.electra.flashCallback"}}},getHtml:function(){var b="",e=this.FAVOURITE_TOOLTIP;if(this._episode.isFavourited()){b=
"disabled";e=""}this._$html=glow.dom.create(this.CTA_HTML,{interpolate:{pid:this._pid,isFavourited:b,favouritesToolTip:e}});this._episode.isDownloadable()||this._$html.get("li.cta-download").destroy();return this._$html},showDownloadCta:function(b){var e,h;e=b?glow.dom.get(b):this._$html.get(" > li.cta-download > span");if(this._episode.isDownloadable()){b=this._getDownloadCta();h=iplayer.utils.getPosition(e);e=!e.height()?0:e.height()-2+"px";if(glow.env.gecko){h.x+=1;h.y+=1}h&&glow.dom.get(b).css({left:h.x+
"px",top:h.y+"px",height:e});this._getDownloadBadge().movie.setProgramme&&this._getDownloadBadge().movie.setProgramme(this._pid,this._versionId,this._playlistUrl,this._flashConfig.params.flashVars.bitrateFloor,this._flashConfig.params.flashVars.bitrateCeiling)}else if(e.length)e[0].title=""},hideDownloadCta:function(){var b=this._getDownloadCta();glow.dom.get(b).css({left:"",top:""})},_getDownloadCta:function(){var b=document.getElementById("electraContainer");f&&f.setPid(this._episode.getPid());
if(b)return b;b=glow.dom.create('<div id="electraContainer"></div>').appendTo("body");var e=glow.dom.get(b);g._downloadBadge=new glow.embed.Flash(iplayer.config.desktop.baseUrl+"iplayer_download_homepage_badge.swf",e,iplayer.config.emp.flashVersionRequired.full,this._flashConfig);this._getDownloadBadge().embed();return b[0]},_getDownloadBadge:function(){g._downloadBadge||this._getDownloadCta();return g._downloadBadge}};g.getHtml=function(b){return(new g(b)).getHtml()};g._downloadBadge=null;return iplayer.models.Cta=
g});
require.def("iplayer/controllers/listviewctamanager",["iplayer/utils/events","iplayer/models/loader","iplayer/models/episoderegistry","iplayer/models/cta"],function(k,f,g,b){var e=iplayer.useragent.browser,h=function(){if(!(e.msie&&e.version===6)){this._currentCta=null;this.bind(document.documentElement)}};glow.lang.extend(h,k,{".cta-add-to-favourites click":function(c){c.preventDefault();$anchor=glow.dom.get(c.source);if(!$anchor.hasClass("disabled")){$anchor.addClass("loading");var j=new f($anchor,"small",
"before");j.show();c=iplayer.utils.getPid(c.source);g.find(c).addToFavourites({onLoad:function(){j.hide();delete j;$anchor.removeClass("loading");$anchor.addClass("disabled");$anchor[0].title=""},onError:function(){j.hide();delete j;$anchor.removeClass("loading")}})}},".list-cta mouseover":function(c){c=glow.dom.get(c.source);var j=c.get(".ctas > li.cta-add-favourite > a"),l=iplayer.utils.getPid(j),m=c.get("li.cta-download > span"),r=g.find(l);c.addClass("list-cta-hover");r.isFavourited()&&j.addClass("disabled");
if(!m.get("> *").length){this._currentCta=new b(l);this._currentCta.showDownloadCta(m)}},"body mouseout":function(){return iplayer.config.electra.debug&&window.location.search.indexOf("overlay-debug")!==-1?function(){}:function(c){try{if(this._currentCta){var j=glow.dom.get(".list-cta-hover"),l=glow.dom.get(c.relatedTarget),m=glow.dom.get("#electraContainer");if(!l.eq(j)&&!l.isWithin(j)&&!l.eq(m)&&!l.isWithin(m)){j.removeClass("list-cta-hover");this._currentCta.hideDownloadCta();this._currentCta=
null}}}catch(r){log(r,r.message)}}}()});return iplayer.controllers.ListViewCtaManager=h});
require.def("iplayer/controllers/livestats",["iplayer/utils/events"],function(k){var f=function(){this._statsTemplate="~RS~s~RS~iplayer~RS~t~RS~{pageType}~RS~i~RS~{pid}~RS~p~RS~{parentSection}~RS~a~RS~{contentType}~RS~u~RS~{uri}~RS~r~RS~{referrer}~RS~q~RS~{queryString}~RS~z~RS~{rand}~RS~";this.bind()};glow.lang.extend(f,k,{"iplayer:livestats:download subscribe":function(g){this._sendStats({pageType:"Web_Downl",pid:g.pid,contentType:"v"})},_sendStats:function(g){glow.lang.apply(g,{parentSection:"0",
uri:window.location.href,referrer:document.referrer,queryString:"",rand:(new Date).getSeconds()});g=glow.lang.interpolate(this._statsTemplate,g);var b=document.createElement("img");b.width=1;b.height=1;b.src="http://stats.bbc.co.uk/o.gif?"+g;document.body.appendChild(b)}});return iplayer.controllers.LiveStats=f});
require.def("iplayer/models/genericdialog",["iplayer/utils/events"],function(k){var f=function(g,b,e,h,c,j){this._name=g;this._title=b;this._htmlMsg=e;this._closeButtonText=h?h:"";this._confirmButtonText=c?c:"";this._dialog=null;this._callback=j};glow.lang.extend(f,k,{".close > a click":function(g){g.preventDefault();iplayer.events.publish("iplayer:dialog:"+this._name+":close")},"a.confirm click":function(g){g.preventDefault();iplayer.events.publish("iplayer:dialog:"+this._name+":confirm")},show:function(){var g=
this._getDom();this._dialog=new glow.widgets.Overlay(g,{modal:true,closeOnMaskClick:false,x:"50%",y:"35%"});this.bind(this._dialog);this._dialog.show()},hide:function(){glow.events.addListener(this._dialog,"afterHide",function(){this._dialog=null;this.unbind();this._callback&&this._callback.call(this)},this);this._dialog.hide()},isShown:function(){return this._dialog?this._dialog.isShown:false},_getDom:function(){var g=glow.dom.create('<div id="bip-modaldialog" class="'+this._name+'"><h2>{title}</h2><div class="content">{htmlMsg}</div><p class="button close"><a href="#">{closeButtonText}</a></p></div>',
{interpolate:{title:this._title,htmlMsg:this._htmlMsg,closeButtonText:this._closeButtonText}}),b=g.get("> .close");b.css("display",this._closeButtonText?"inline":"none");this._confirmButtonText&&glow.dom.create('<p class="button"><a href="#" class="confirm">'+this._confirmButtonText+"</a></p>").insertBefore(b);return g}});return iplayer.models.GenericDialog=f});
require.def("iplayer/controllers/migrationoverlay",["iplayer/utils/events","iplayer/models/user","iplayer/models/genericdialog"],function(k,f,g){var b=function(){this.bind();this._dialog=null;if(f.isFreshSignin()){log("Fresh signin detected");f.getMigrationStatus()}iplayer.utils.removeUrlHash("freshSignin")};glow.lang.extend(b,k,{"iplayer:user:canmigrate subscribe":function(){this._dialog=new g("migration","Save your BBC iPlayer settings","<p>BBC iPlayer lets you save all of your favourite programmes and settings so that they are stored against your BBC ID account. This enables you to use your personal settings on other computers simply by logging in.</p><p>The following settings will be saved:</p><ul><li>TV and Radio favourites</li><li>My categories</li><li>Last played programmes</li><li>Radio stations</li></ul><p>Don't worry, it is a simple one off process.</p><p>We do not recommend saving your settings on a shared or public computer as other user's favourites may accidentally be added.</p><p>Remember to log into BBC Identity whenever you are on the site to make the most of the features.</p>",
"No thanks","Save settings");this._dialog.show()},"iplayer:dialog:migration:confirm subscribe":function(){this._dialog.hide();f.doMigration()},"iplayer:dialog:migration:close subscribe":function(){this._dialog.hide();f.deferMigration()},"iplayer:user:migrationerror subscribe":function(){delete this._dialog;this._dialog=new g("error","An error has occurred","<p>We were unable to save your settings</p>","Close","Try again");this._dialog.show()},"iplayer:dialog:error:close subscribe":function(){this._dialog.hide()},
"iplayer:dialog:error:confirm subscribe":function(){this._dialog.hide();f.doMigration()},"iplayer:user:migrationcomplete subscribe":function(){this._dialog=null;var e=window.location.pathname.indexOf("iplayer/console")!==-1?"OK":"Close";this._dialog=new g("complete","Successfully saved.","<p>Your settings have now been saved. Remember to sign in to BBC ID every time you use BBC iPlayer to view your favourite programmes.</p>",e);this._dialog.show()},"iplayer:dialog:complete:close subscribe":function(){this._dialog.hide();
iplayer.utils.shouldReloadPage()?window.location.reload():iplayer.events.publish("iplayer:signin")}});return iplayer.controllers.MigrationOverlay=b});
require.def("iplayer/models/overlay",["iplayer/models/episoderegistry","iplayer/models/cta"],function(k,f){var g=function(b,e,h){this._$element=glow.dom.get(e);this._pid=b;this._episode=k.find(b);this._$overlay=null;this._styles=h;this._cta=null;if(!this._episode)throw new Error("Episode "+b+" is not in the registry");this._styles.titling=this._styles.titling||"listing";this._episode.setStyle(this._styles.titling)};g.prototype={show:function(){var b=this.getDom(),e;if(!b)return false;e=this._getStyles();
this._cta=new f(this._pid);this._cta.getHtml().appendTo(b);b.appendTo("body").css(e);this._cta.showDownloadCta();return true},hide:function(){var b=this.getDom();if(!b)return false;b.destroy();this._cta.hideDownloadCta();this._$overlay=null;return true},getDom:function(){if(this._$overlay)return this._$overlay;var b=this._getImageDetails();this._episode.isFavourited();var e="overlay-"+this._styles.overlay;if(!b)return false;var h=iplayer.utils.getAncestor(this._$element[0],"div","for-you");return this._$overlay=
glow.dom.create(iplayer.config.ctaOverlay,{interpolate:{extra_class:this._episode.getServiceType()==="radio"&&iplayer.config.radio.useConsole?"pop-radioconsole":"",style:e,img_source:b.src,img_width:b.width,img_height:b.height,my_url:h!==false?this._episode.getRecommendPageUrl("homepage"):this._episode.getPageUrl(),title:this._episode.displayTitle(),subtitle:this._episode.displaySubtitle(),fullTitle:this._episode.displayFulltitle(),description:this._episode.displayDescription()}})},_getImageDetails:function(){var b=
this._$element[0].getElementsByTagName("img")[0];if(!b)return false;return{width:b.offsetWidth||b.width,height:b.offsetHeight||b.height,src:b.src}},_getStyles:function(){var b,e;b=iplayer.utils.getPosition(this._$element);if(this._styles.overlay.indexOf("featureHero")!==-1){e=b.x;b=b.y-1}else{e=b.x-5;b=b.y-5}return{top:b+"px",left:e+"px"}}};g.getInstance=function(b,e,h){var c,j=glow.dom.get(e);if(!(c=j.data(b))){c=new g(b,e,h);j.data(b,c)}return c};return iplayer.models.Overlay=g});
require.def("iplayer/controllers/overlaymanager",["iplayer/utils/events","iplayer/models/overlay","iplayer/models/loader","iplayer/models/episoderegistry"],function(k,f,g,b){var e=iplayer.useragent.browser,h=function(c){if(!(e.msie&&e.version===6)){this._$parentContainer=c.addClass?c.slice(0,1):glow.dom.get(c).slice(0,1);this._currentOverlay=null;this.bind(document.documentElement)}};glow.lang.extend(h,k,{".cta mouseover":function(c){c.preventDefault();var j,l={};if(!(glow.dom.get(c.source).isWithin(glow.dom.get("#drawer-4"))&&
!glow.dom.get("#drawer-4").hasClass("drawer-open"))){j=iplayer.utils.getPid(c.source);l.overlay=this._getOverlayStyle(c.source);l.titling=this._getTitlingStyle(c.source);try{if(this._currentOverlay){this._currentOverlay.hide();this._currentOverlay=null}this._currentOverlay=new f(j,c.source,l);this._currentOverlay.show()}catch(m){log("OverlayManager .cta mouseenter error: ",m.message)}}},"body mouseout":function(){return iplayer.config.electra.debug&&window.location.search.indexOf("overlay-debug")!==
-1?function(){}:function(c){try{if(this._currentOverlay){var j=glow.dom.get("#cta-overlay"),l=glow.dom.get(c.relatedTarget),m=glow.dom.get("#electraContainer");!l.eq(j)&&!l.isWithin(j)&&!l.eq(m)&&!l.isWithin(m)&&this._currentOverlay.hide()}}catch(r){log(r,r.message)}}}(),".cta-add-favourite a click":function(c){c.preventDefault();var j=glow.dom.get(c.source);if(!j.hasClass("disabled")){j.addClass("loading");var l=new g(j,"small","before");l.show();c=iplayer.utils.getPid(c.source);b.find(c).addToFavourites({onLoad:function(){l.hide();
delete l;j.removeClass("loading");j.addClass("disabled");j[0].title=""},onError:function(){l.hide();delete l;j.removeClass("loading")}})}},_getOverlayStyle:function(c){return this._getPatternFromClass(c,/\b(overlay-style-([^\s]*))\b/)},_getTitlingStyle:function(c){return(c=this._getPatternFromClass(c,/\b(titling-style-([^\s]*))\b/))?c:"listing"},_getPatternFromClass:function(c,j){c=(c.className||"").match(j);return c!==null&&c[2]?c[2]:false}});return iplayer.controllers.OverlayManager=h});
require.def("iplayer/models/schedule",["iplayer/models/episoderegistry"],function(k){var f=function(g,b,e,h,c){this.serviceType=g;this.serviceId=b;this.day=e;this._programmeTimetable=h;this._isAllDay=c;this.AREA_COOKIE_KEY="region"};f.prototype={reload:function(g,b){this._load(this.day,g,b)},getNextSchedule:function(g,b){var e=new Date;e.setDate(this.day.getDate()+1);this._load(e,g,b)},getProgrammeAt:function(g){return this._programmeTimetable[g]},_getFirstEpoch:function(){var g="a";for(var b in this._programmeTimetable)if(b<
g)g=b;return g},_getFormattedDate:function(g){var b=g.getMonth()+1;if(b<10)b="0"+b;var e=g.getDate();if(e<10)e="0"+e;return""+g.getFullYear()+b+e},_update:function(g,b,e){try{if(!b)throw"No current episode start time has been provided.";var h=this.getProgrammeAt(b);if(!h)throw"No episode with that start time has been found.";b={};var c=g.episodes;for(var j in c)b[c[j]._json.id]=c[j]._json;k.addData(b);this.day.setDate(this.day.getDate()+1);this._programmeTimetable=g.programmeTimetable;var l=k.find(c[0]._json.id),
m=k.find(h.id),r=this.getProgrammeAt(this._getFirstEpoch());l.startTime=r.startTime;l.endTime=r.endTime;if(e&&e.onSuccess){log("Timetable updated.");e.onSuccess(m,l)}return true}catch(o){log("Timetable update failed: "+o);e&&e.onFailure&&e.onFailure();return false}},_load:function(g,b,e){g=this._getFormattedDate(g);log("Schedule "+g+" requested.");var h=this;glow.net.get(iplayer.config.root+"schedule/"+this.serviceType+"/"+this.serviceId+"/"+g,{headers:{Accept:"application/json"},useCache:true,onLoad:function(c){log("Schedule request succeeded. Updating the timetable...");
h._update(c.json(),b,e)},onError:function(c){log("Schedule request failed: "+c);e.onFailure&&e.onFailure()}})},setArea:function(g){iplayer.cookie.set("BBCiPlayer",this.AREA_COOKIE_KEY,g);var b="/iplayer/pagecomponents/programmelist/invoke?servicetype="+this.serviceType+"&service="+this.serviceId+"&date="+this.day+"&area="+g;if(this._isAllDay)b+="&filter=day";glow.net.get(b,{useCache:false,onLoad:function(e){try{log("Area changed. Updating the programme list...");var h=glow.dom.get("#schedule-area-selector option");
h.removeAttr("class");h.each(function(){(this.selected=this.value==g)&&glow.dom.get(this).addClass("selected")});var c=iplayer.utils.getScripts(e.text()),j=iplayer.utils.removeInlineScripts(e.text());iplayer.utils.evalScripts(c);glow.dom.get("#schedule-programme-list").replaceWith(j);log("Programme list updated.");var l=glow.dom.get("#schedule-service-title").text();glow.dom.get("#schedule-service-title").remove();document.title="BBC iPlayer - "+l;glow.anim.fadeTo(glow.dom.get("#schedule-aria-label"),
0.1,0.7,{onComplete:function(){glow.dom.get("#schedule-aria-label").text(l);glow.anim.fadeIn(glow.dom.get("#schedule-aria-label"),1,0.7)}})}finally{iplayer.events.publish("iplayer:schedule:programmelist:updated")}},onError:function(){log("Area change failed.");iplayer.events.publish("iplayer:schedule:programmelist:updated")}})}};return iplayer.models.Schedule=f});
require.def("iplayer/controllers/schedule",["iplayer/utils/events","iplayer/models/schedule","iplayer/models/loader"],function(k,f,g){var b=function(e,h,c,j){this._model=new f(e,h,c,null,j);glow.dom.get("#schedule-service-title").remove();this.bind(document);if(iplayer.utils.arrayIndexOf(["bbc_one","bbc_two"],h)!==-1){(e=iplayer.cookie.get("BBCiPlayer",this._model.AREA_COOKIE_KEY))||(e="london");iplayer.events.publish("iplayer:schedule:selector:change",{source:{value:e}})}};glow.lang.extend(b,k,{"#schedule-area-selector change":function(e){iplayer.events.publish("iplayer:schedule:selector:change",
e)},"iplayer:schedule:selector:change subscribe":function(e){var h=glow.dom.get("#schedule-area-selector").value;e=e.source.value;if(h!=e){this._startUpdate("#schedule-programme-list");this._model.setArea(e)}},_startUpdate:function(e){glow.dom.get(e).prepend('<div class="link-protector"></div>');glow.anim.fadeTo(glow.dom.get(e),0.1,1);if(undefined==this.loader){this.loader=new g(glow.dom.get(e),null,"before");this.loader.show()}this.loader.affectedElementId=e},"iplayer:schedule:programmelist:updated subscribe":function(){var e=
this.loader.affectedElementId;this.loader.hide();delete this.loader;glow.anim.fadeIn(glow.dom.get(e),0.5);glow.dom.get(e+" .link-protector").remove()}});return iplayer.controllers.Schedule=b});
require.def("iplayer/models/schedulecomponent",["iplayer/utils/events","iplayer/models/loader"],function(k,f){var g=function(){this._lastSelectorDate=null;this.isProcessing=false;this._storedState={};this.init();this.saveCurrentScheduleState();this.bind("#schedule")};glow.lang.extend(g,k,{init:function(){this.__scrollToCurrentProgramme()||this.__updateScrollButtons()},setService:function(b){if(!this.isProcessing&&(b.source.tagName=="A"||b.source.tagName=="SPAN")){var e=b.source.tagName=="SPAN"?b.source.parentNode:
b.source,h=/service-selector-(.*)-(.*)/.exec(e.id),c=h[2];h=h[1];if(!glow.dom.get(e).parent().hasClass("selected"))try{var j=glow.dom.get("#schedule-day-selector .selected a"),l=j.length===0?this._lastSelectorDate:/schedule-day-selector-(.*)/.exec(j[0].id)[1];this._lastSelectorDate=l;this.isSettingService=true;this._updateProgrammeList(c,h,l)}finally{b.preventDefault()}}else b.preventDefault()},setDay:function(b){if(!this.isProcessing){var e=/schedule-day-selector-(.*)/.exec(b.source.id)[1],h=glow.dom.get("#services-list .selected a");
if(h.length>0){var c=/service-selector-(.*)-(.*)/.exec(h[0].id);h=c[1];c=c[2];this.isSettingService=false;this._updateProgrammeList(c,h,e)}}b.preventDefault()},saveCurrentScheduleState:function(){var b=glow.dom.get("#services-list .selected a");if(b.length!==0){b=/service-selector-(.*)-(.*)/.exec(b[0].id);this._storedState.serviceType=b[1];this._storedState.serviceId=b[2]}b=glow.dom.get("#schedule-info-column .selected a");if(b.length!==0)this._storedState.serviceDay=/schedule-day-selector-(.*)/.exec(b[0].id)[1]},
restoreSavedScheduleState:function(){var b=glow.dom.get("#service-selector-"+this._storedState.serviceType+"-"+this._storedState.serviceId);if(b.length===0){b=this._getDefaultStation();this._storedState.serviceType=b.serviceType;this._storedState.serviceId=b.serviceId;b=b.buttonNodeList}this._updateProgrammeList(this._storedState.serviceId,this._storedState.serviceType,this._storedState.serviceDay);b.parent().addClass("selected")},_getDefaultStation:function(){var b=glow.dom.get("ul#services-list li a")[0];
b=glow.dom.get(b);var e=/service-selector-(.*)-(.*)/.exec(b.attr("id"));return{serviceId:e[2],serviceType:e[1],buttonNodeList:b}},_updateProgrammeList:function(b,e,h){if(null!==b&&null!==h){var c=glow.dom.get("#schedule-info-column"),j=iplayer.config.root+"pagecomponents/schedule/invoke?service="+b+"&servicetype="+e+"&date="+h;this.nextServiceId="#service-selector-"+e+"-"+b;this.__startOperation();var l=this;glow.net.get(j,{useCache:true,onLoad:function(m){try{c.html(m.text());glow.dom.get(".schedule-day-selector").parent().removeClass("selected");
glow.dom.get("#schedule-day-selector-"+h).parent().addClass("selected");var r=glow.dom.get("#schedule-day-selector-"+h)[0].href;glow.dom.get("#schedule-show-all a")[0].href=r;glow.dom.get("#schedule h2 a")[0].href=r;l.init()}finally{l.__endOperation()}},onError:function(){c.html("Sorry, no schedule information is available.");l.__endOperation()}})}},scrollProgrammeList:function(b){b.preventDefault();b.stopPropagation();var e=glow.dom.get("#schedule-programme-list .table-container")[0],h=b.source.id;
if(""===h)h=b.source.parentNode.id;b=/schedule-programme-list-scroll-(.*)/.exec(h)[1];if(b=="up"&&e.scrollTop<=0||b=="down"&&e.scrollTop>=e.scrollHeight-e.clientHeight)return false;h=new glow.anim.Animation(1,{tween:glow.tweens.easeOut()});var c=b=="up"?-1:1,j=e.clientHeight*0.9,l=e.scrollTop;glow.events.addListener(h,"frame",function(){e.scrollTop=l+j*this.value*c});glow.events.addListener(h,"complete",this.__updateScrollButtons);h.start();return false},__scrollToCurrentProgramme:function(){var b=
glow.dom.get("#schedule-programme-list-on-now")[0];if(undefined!=b){var e=glow.dom.get("#schedule-programme-list .table-container")[0],h=new glow.anim.Animation(1,{tween:glow.tweens.easeOut()}),c=b.offsetTop;glow.events.addListener(h,"frame",function(){e.scrollTop=c*this.value});glow.events.addListener(h,"complete",this.__updateScrollButtons);h.start();return true}else return false},__updateScrollButtons:function(){var b=glow.dom.get("#schedule-programme-list .table-container")[0],e=glow.dom.get("#schedule-programme-list-scroll-up"),
h=glow.dom.get("#schedule-programme-list-scroll-down");b.scrollTop<=0?e.addClass("disabled"):e.removeClass("disabled");b.scrollTop>=b.scrollHeight-b.clientHeight?h.addClass("disabled"):h.removeClass("disabled")},__startOperation:function(){this.isProcessing=true;glow.dom.get("#schedule").prepend('<div class="link-protector"></div>');if(this.isSettingService===true){glow.dom.get("#services-list li").removeClass("selected");var b=glow.dom.get(this.nextServiceId).parent(),e=glow.dom.get("#services-list li");
b.addClass("selected");e.each(function(){glow.dom.get(this).hasClass("selected")||glow.anim.fadeTo(this,0.4)});glow.anim.fadeTo(glow.dom.get("#schedule-on-now"),0.4);glow.anim.fadeTo(glow.dom.get("#schedule-day-selector"),0.4);glow.anim.fadeTo(glow.dom.get("#schedule-programme-list"),0.1);glow.anim.fadeTo(glow.dom.get("#schedule-show-all"),0.4)}else glow.anim.fadeTo(glow.dom.get("#schedule-programme-list"),0.1);glow.dom.get("#schedule .loader").remove();this.loader=new f(glow.dom.get("#schedule-info-column"),
null,"prepend");this.loader.show()},__endOperation:function(){this.isProcessing=false;this.loader.hide();delete this.loader;if(this.isSettingService===true){glow.anim.fadeIn(glow.dom.get("#schedule-on-now"));glow.anim.fadeIn(glow.dom.get("#schedule-day-selector"));glow.anim.fadeIn(glow.dom.get("#schedule-programme-list"));glow.anim.fadeIn(glow.dom.get("#services-list li"));glow.anim.fadeIn(glow.dom.get("#schedule-show-all"))}else glow.anim.fadeIn(glow.dom.get("#schedule-programme-list"));glow.dom.get("#schedule .link-protector").destroy()}});
return iplayer.models.schedulecomponent=g});
require.def("iplayer/controllers/schedulecomponent",["iplayer/utils/events","iplayer/models/schedulecomponent"],function(k,f){var g=function(){this._model=new f;this.onPageLoad();this.bind("#schedule")};glow.lang.extend(g,k,{onPageLoad:function(){},"#services-list li a.service-selector click":function(b){if(b.source.parentNode.className.indexOf("selected")===-1){b.preventDefault();this._model.setService(b)}return false},"#schedule-day-selector ul li a click":function(b){b.preventDefault();this._model.setDay(b)},
"#schedule-programme-list-scroll-up click":function(b){b.preventDefault();this._model.scrollProgrammeList(b)},"#schedule-programme-list-scroll-down click":function(b){b.preventDefault();this._model.scrollProgrammeList(b)},"iplayer:editstations:destroySchedule subscribe":function(){this._model.saveCurrentScheduleState()},"iplayer:editstations:showSchedule subscribe":function(){this._model.restoreSavedScheduleState()}});return iplayer.controllers.schedulecomponent=g});
require.def("iplayer/controllers/search",["iplayer/utils/events","iplayer/accordion/accordion"],function(k,f){var g=function(b){new f("ul.result-list > li","a.toggle","> ul",{ANIM_SPEED:0.4});new f("ul.episodelist > li","a.more-in-this-series","ol",{openStateText:"close"});this._failedRequestAttempts=0;this._circuitBreakerKill=3;this.bind(b);iplayer.config.loadlocalradioresult&&this.loadLocalRadioSearchResults()};glow.lang.extend(g,k,{loadLocalRadioSearchResults:function(){var b=this;glow.net.get(iplayer.config.root+
"usercomponents/search/localradio"+window.location.search,{onLoad:function(e){e=glow.dom.create(e.text());e.get("#local-radio-result").css("opacity",0);glow.dom.get("#search .results").before(e);glow.anim.fadeIn("#local-radio-result",2)},onError:function(){b._failedRequestAttempts++;b._failedRequestAttempts<b._circuitBreakerKill&&b.loadLocalRadioSearchResults()}})}});return iplayer.controllers.Search=g});
require.def("iplayer/controllers/signin",["iplayer/models/user"],function(k){return iplayer.controllers.Signin=function(f){f.onLoad(function(){f.setStatusbarPtrt({register:"http://"+window.location.hostname+window.location.pathname+"#freshSignin=true"});if(f.addSigninHandler){f.addSigninHandler(function(){if(iplayer.utils.shouldReloadPage()){k.signinOrigin!=="recommend"&&iplayer.utils.addUrlHash({freshSignin:true});window.location.reload()}else{k.signinOrigin!=="recommend"&&k.getMigrationStatus();
iplayer.events.publish("iplayer:signin")}});f.addSigninCancelHandler(function(){iplayer.events.publish("iplayer:signincancel")})}})}});
require.def("iplayer/controllers/tabs",["iplayer/utils/events"],function(k){var f=function(){this._tabs=glow.dom.get("#tabs li");this._content=glow.dom.get(".tab-content");this._currentTab=1;this._content.slice(this._currentTab).css("display","none");this._showTab(this._currentTab);this.bind()};glow.lang.extend(f,k,{_showTab:function(g){this._content.slice(g-1,g).css("display","block");this._tabs.slice(g-1,g).addClass("selected")},_hideTab:function(g){this._content.slice(g-1,g).css("display","none");
this._tabs.slice(g-1,g).removeClass("selected")},"#tabs a click":function(g){g.preventDefault();this._hideTab(this._currentTab);this._currentTab=/tab-(.*)/.exec(g.source.parentNode.id)[1];this._showTab(this._currentTab)}});return iplayer.controllers.Tabs=f});
require.def("iplayer/utils/hash",function(){var k=function(f,g){this._hashKey=f;this._arrayProvider=g};k.prototype={PREKEYED_KEY:"PREKEYED",lookup:function(f){return this._getHashTable()[f]},invalidateHashTable:function(){this._hashTablesValid=false},_getHashTable:function(){this._hashTablesValid===false&&this._createHashTables();return this._hashTable},_hashTablesValid:false,_hashTable:{},_addArrayToHash:function(f){for(var g in f)this._hashTable[f[g][this._hashKey]]=f[g]},_createHashTables:function(){if(this._hashKey==
this.PREKEYED_KEY)this._hashTable=this._arrayProvider();else{this._hashTable={};this._addArrayToHash(this._arrayProvider())}this._hashTablesValid=true}};return iplayer.utils.Hash=k});
require.def("iplayer/models/editstations",["iplayer/utils/events","iplayer/utils/hash"],function(k,f){var g=function(){this._nationalStations=this._regionalStations=this._localStations=this._scheduleSelectedStation=this._scheduleSelectedDay=null;this._stationsUpdating=this._stationsUptodate=false;this._getSelectedStationsCallbacks=[];this._selectedStations=[];this._isDefaultStationSelection=null;this._cachedSelectedStations=[];this._startMode=g.prototype.LIST_STATIONS_MODE;this.bind()};glow.lang.extend(g,
k,{init:function(b,e,h,c){this._selectedStationsHash=new f("id",this.selectedStationsArrayProvider());this._stationsHash=new f("PREKEYED",this.stationsHashTableProvider());this.setLocalStations(b);this.setRegionalStations(e);this.setNationalStations(h);c&&this.insertUserStationPresets(c)},getInstance:function(){if(!g.prototype._instance)g.prototype._instance=new g;return g.prototype._instance},SELECTED_STATIONS_MIN:1,TOO_FEW_STATIONS_MESSAGE:"<p class='error-heading'>Minimum Selected</p><p>You must have at least {SELECTED_STATIONS_MIN} Radio Station.</p>",
SELECTED_STATIONS_MAX:15,TOO_MANY_STATIONS_MESSAGE:"<p class='error-heading'>Maximum Selected</p><p>You can only have a maximum of {SELECTED_STATIONS_MAX} Radio stations.</p>",MAX_NUMBER_OF_LOCAL_STATIONS:2,MAX_NUMBER_OF_LOCAL_STATIONS_REACHED_MESSAGE:"<p class='error-heading'>Maximum Selected</p><p>You can only have a maximum of {MAX_NUMBER_OF_LOCAL_STATIONS} local radio stations.</p>",EDIT_STATIONS_MODE:"edit",LIST_STATIONS_MODE:"list",setPreferredStartMode:function(b){this._startMode=b},getPreferredStartMode:function(){return this._startMode},
setScheduleSelectedDay:function(b){this._scheduleSelectedDay=b},getScheduleSelectedDay:function(){return this._scheduleSelectedDay},setScheduleSelectedStation:function(b){this._scheduleSelectedStation=b},getScheduleSelectedStation:function(){return this._scheduleSelectedStation},getPostCodeResults:function(b,e){glow.net.get(iplayer.config.root+"rest/console/postcode/"+b,{onLoad:function(h){h=glow.data.decodeJson(h.text());e&&e.onLoad(h);iplayer.events.publish("iplayer:editstations:postcodesearch-load",
{data:h})},onError:function(h){e&&e.onError({message:h.statusText()});iplayer.events.publish("iplayer:editstations:error",{fatal:false,message:'<p class="error-heading">Sorry,</p><p>There was a technical error loading your search results.</p>'})}})},loadUserStationPresets:function(b,e){if(this._stationsUptodate===true&&e!==true)this._onLoadUserStationPresets(b,glow.lang.clone(this._cachedSelectedStations));else{this._stationsUptodate=false;this._stationsUpdating=true;var h=this;glow.net.get(iplayer.config.root+
"usercomponents/reststationpresets",{onLoad:function(c){c=glow.data.decodeJson(c.text()).presets;h._cachedSelectedStations=glow.lang.clone(c);h._onLoadUserStationPresets(b,c)},onError:function(){var c=h.getPresetStations();h._onLoadUserStationPresets(b,c);h._stationsUptodate=false;iplayer.events.publish("iplayer:editstations:error",{fatal:true,message:'<p class="error-heading">Sorry,</p><p>There was a technical error loading your stations.</p>'})}})}},insertUserStationPresets:function(b){this._onLoadUserStationPresets(null,
b);this._cachedSelectedStations=glow.lang.clone(b)},_onLoadUserStationPresets:function(b,e){this._stationsUpdating=false;e&&this._setSelectedStations(e);iplayer.events.publish("iplayer:presets:load",{});b&&b.onLoad()},saveUserStationPresets:function(b){glow.dom.get("#stations #stations-preloader").addClass("loading");this._stationsUptodate=false;this._stationsUpdating=true;var e=this;iplayer.net.send("PUT",iplayer.config.root+"usercomponents/reststationpresets",{stationPresets:[this._selectedStations]},
{onLoad:function(h){h=glow.data.decodeJson(h.text()).presets;e._cachedSelectedStations=glow.lang.clone(h);e._onDeleteOrSaveUserStationPresets(b,h)},onError:function(h){e._onDeleteOrSaveUserStationPresets(b);b&&b.onError({msg:h.statusText()});iplayer.events.publish("iplayer:editstations:error",{fatal:true,message:'<p class="error-heading">Sorry,</p><p>There was a technical error saving your stations.</p>'})}})},deleteUserStationPresets:function(b){glow.dom.get("#stations #stations-preloader").addClass("loading");
this._stationsUptodate=false;this._stationsUpdating=true;var e=this;iplayer.net.send("DELETE",iplayer.config.root+"usercomponents/reststationpresets",{},{onLoad:function(h){h=glow.data.decodeJson(h.text()).presets;e._cachedSelectedStations=glow.lang.clone(h);e._onDeleteOrSaveUserStationPresets(b,h)},onError:function(h){e._onDeleteOrSaveUserStationPresets(b);b&&b.onError({msg:h.statusText()});iplayer.events.publish("iplayer:editstations:error",{fatal:true,message:'<p class="error-heading">Sorry,</p><p>There was a technical error resetting your stations.</p>'})}})},
_onDeleteOrSaveUserStationPresets:function(b,e){this._stationsUpdating=false;e&&this._setSelectedStations(e);b&&b.onLoad();iplayer.events.publish("iplayer:presets:save",{})},getSelectedStations:function(b){if(this._stationsUptodate===false){this._stationsUpdating===false&&this.loadUserStationPresets();b&&this._getSelectedStationsCallbacks.push(b);return false}else{b&&b.onLoad(this._selectedStations);return this._selectedStations}},"iplayer:presets:load subscribe":function(){for(var b in this._getSelectedStationsCallbacks)this._getSelectedStationsCallbacks.hasOwnProperty(b)&&
this._getSelectedStationsCallbacks[b].onLoad(this._selectedStations);this._getSelectedStationsCallbacks=[]},"iplayer:presets:save subscribe":function(){for(var b in this._getSelectedStationsCallbacks)this._getSelectedStationsCallbacks.hasOwnProperty(b)&&this._getSelectedStationsCallbacks[b].onLoad(this._selectedStations);this._getSelectedStationsCallbacks=[]},isDefaultLayout:function(){return this._isDefaultStationSelection},isStationSelected:function(b){if(this._selectedStationsHash.lookup(b)===
undefined)return false;return true},selectStation:function(b){if(this._selectedStationsHash.lookup(b)!==undefined)return false;if(this._selectedStations.length>=this.SELECTED_STATIONS_MAX){b=this.TOO_MANY_STATIONS_MESSAGE;b=glow.lang.interpolate(b,{SELECTED_STATIONS_MAX:this.SELECTED_STATIONS_MAX});iplayer.events.publish("iplayer:editstations:error",{fatal:false,message:b});return false}var e=this.getStation(b);if(!e)return false;if(e.type=="local")if(this._countSelectedLocalStations()>=this.MAX_NUMBER_OF_LOCAL_STATIONS){b=
this.MAX_NUMBER_OF_LOCAL_STATIONS_REACHED_MESSAGE;b=glow.lang.interpolate(b,{MAX_NUMBER_OF_LOCAL_STATIONS:this.MAX_NUMBER_OF_LOCAL_STATIONS});iplayer.events.publish("iplayer:editstations:error",{fatal:false,message:b});return false}this._selectedStations.push(b);this._selectedStationsHash.invalidateHashTable();this._sortSelectedStations();iplayer.events.publish("iplayer:editstations:selectStation",{id:b});return true},deselectStation:function(b){if(this._selectedStations.length<=this.SELECTED_STATIONS_MIN){b=
this.TOO_FEW_STATIONS_MESSAGE;b=glow.lang.interpolate(b,{SELECTED_STATIONS_MIN:this.SELECTED_STATIONS_MIN});iplayer.events.publish("iplayer:editstations:error",{fatal:false,message:b});return false}if(this._remove(b,this.getSelectedStations())){this._selectedStationsHash.invalidateHashTable();this._sortSelectedStations();iplayer.events.publish("iplayer:editstations:deselectStation",{id:b});return true}return false},selectedStationsArrayProvider:function(){var b=this;return function(){var e=[];for(var h in b._selectedStations)b._selectedStations.hasOwnProperty(h)&&
e.push({id:b._selectedStations[h]});return e}},_sortSelectedStations:function(){var b=this;this._selectedStations.sort(function(e,h){e=b._stationsHash.lookup(e);h=b._stationsHash.lookup(h);if(e===undefined||h===undefined)return 0;return e.index-h.index})},_setSelectedStations:function(b){this._selectedStations=b;this._isDefaultStationSelection=this._initalCheckIfDefaultStationSelection(b);this._stationsUptodate=true;this._selectedStationsHash.invalidateHashTable();this._removeInvalidSelectedStations();
this._sortSelectedStations()},DEFAULT_STATION_SELECTION_FAKE_ION_KEY:"add_local_station",_initalCheckIfDefaultStationSelection:function(b){for(var e in b)if(b.hasOwnProperty(e))if(b[e]==this.DEFAULT_STATION_SELECTION_FAKE_ION_KEY)return true;return false},_removeInvalidSelectedStations:function(){var b=[];for(var e in this._selectedStations)if(this._selectedStations.hasOwnProperty(e)){var h=this._selectedStations[e];this._stationsHash.lookup(h)!==undefined&&b.push(h)}this._selectedStations=b},_countSelectedLocalStations:function(){var b=
0;for(var e in this._selectedStations)this._selectedStations.hasOwnProperty(e)&&this.getStation(this._selectedStations[e]).type=="local"&&b++;return b},_remove:function(b,e){for(var h in e)if(e.hasOwnProperty(h))if(b==e[h]){e.splice(h,1);return true}return false},getStation:function(b){return this._stationsHash.lookup(b)},stationsHashTableProvider:function(){var b=this;return function(){var e={};glow.lang.apply(e,b.getLocalStations());glow.lang.apply(e,b.getRegionalStations());glow.lang.apply(e,b.getNationalStations());
return e}},setLocalStations:function(b){this._stationsHash.invalidateHashTable();this._localStations=this._processArray(b,"local",1E4)},getLocalStations:function(){return this._localStations},setRegionalStations:function(b){this._stationsHash.invalidateHashTable();this._regionalStations=this._processArray(b,"regional",100)},getRegionalStations:function(){return this._regionalStations},setNationalStations:function(b){this._stationsHash.invalidateHashTable();this._nationalStations=this._processArray(b,
"national",0)},getNationalStations:function(){return this._nationalStations},getPresetStations:function(){var b=glow.lang.clone(this.getNationalStations()),e=[];for(a in hash)hash.hasOwnProperty(a)&&e.push(b[a].id);return e},_processArray:function(b,e,h){var c,j,l,m=0;for(c in b)if(b.hasOwnProperty(c)){j=b[c];l=h+m;m++;b[c]={id:c,title:j,type:e,index:l}}return b}});return iplayer.models.EditStations=g});
require.def("iplayer/controllers/urlaction",["iplayer/models/editstations"],function(k){var f=function(){try{var g=glow.data.decodeUrl(window.location.hash.substr(1)),b,e;for(p in g)if((b=/^action:(.*)/.exec(p))&&(e=b[1]))if(this[e])this[e](g[p]);else DEBUG&&console.error("Action ["+e+"] retrieved from URL hash, but iplayer.controllers.UrlAction has no such method")}catch(h){}};f.prototype={comment:function(){glow.events.addListener(document,"iplayer:episodetools:ready",function(){iplayer.events.publish("iplayer:episodetools:comment")})},
showeditstations:function(){k.prototype.getInstance().setPreferredStartMode(k.prototype.EDIT_STATIONS_MODE);window.location.hash="schedule"},showdrawer:function(g){iplayer.events.publish("iplayer:drawermanager:toggle",{id:"drawer-"+g})}};return iplayer.controllers.UrlAction=f});
require.def("iplayer/controllers/user",["iplayer/utils/events","iplayer/models/user"],function(k,f){var g=function(){this.bind(document)};glow.lang.extend(g,k,{"iplayer:signin subscribe":function(b){log("User signin",window.location);window.location=window.location;glow.net.get("/iplayer/restuser/"+f.getUserId(),{onLoad:function(e){glow.lang.apply(f,e.json());b.callback&&b.callback.fire("iplayer:user:reloaded")}})}});return iplayer.controllers.User=g});
require.def("iplayer/controllers/userrecommendations",function(){return iplayer.controllers.UserRecommendations=function(){var k=iplayer.config.root+"usercomponents/userrecommendations/drawer?servicetype="+iplayer.servicetype.master;iplayer.managers.drawerManager.getDrawerByIndex("drawer-2").setDataProvider(k).loadContentFromProvider()}});
require.def("iplayer/models/dialog",["iplayer/utils/events","iplayer/localisation/en"],function(k,f){var g=function(b,e,h,c,j){this._title=b;this._htmlMsg=e;this._closeButtonText=h?h:"";this._downloadUrl=c;this._episode=j;this._dialog=null};glow.lang.extend(g,k,{".close > a click":function(b){b.preventDefault();this.hide()},"a.download click":function(){this._episode&&iplayer.events.publish("iplayer:livestats:download",{pid:this._episode.getPid()});this.hide()},show:function(){var b=this._getDom();
this._dialog=new glow.widgets.Overlay(b,{modal:true,closeOnMaskClick:false,x:"50%",y:"35%"});this.bind(this._dialog);this._dialog.show()},hide:function(){this._dialog.hide();this._dialog=null;this.unbind();this._callback&&this._callback.call(this)},_getDom:function(){var b=glow.dom.create('<div id="bip-modaldialog"><h1>{title}</h1><div class="content">{htmlMsg}</div><p class="button close"><a href="#">{closeButtonText}</a></p></div>',{interpolate:{title:this._title,htmlMsg:this._htmlMsg,closeButtonText:this._closeButtonText}}),
e=b.get("> .close");e.css("display",this._closeButtonText?"inline":"none");this._downloadUrl&&glow.dom.create('<p class="button"><a href="{url}" class="download">{downloadText}</a></p>',{interpolate:{url:this._downloadUrl,downloadText:f.download}}).insertBefore(e);return b}});return iplayer.models.Dialog=g});
require.def("iplayer/views/social",function(){return iplayer.views.social={getCta:function(k,f){var g="";g=k?f?"Your profile is public":"Make your profile public":"Register to make your profile public";return glow.lang.interpolate('<div id="social-cta" class="{loggedInClass}{hasProfileClass}"><ol><li class="step-1"><span>1</span> {step1text}</li><li class="step-2"><span>2</span> Connect to your friends</li><li class="step-3"><span>3</span> Send and receive recommendations</li></ol><p><a href="{getStartedUrl}" class="get-started" title="Get started">Get started</a></p><p><a href="{findOutMoreUrl}" class="find-out-more" title="Find out more">Find out more</a></p></div>',
{loggedInClass:k?"logged-in":"",hasProfileClass:f?" has-profile":"",step1text:g,getStartedUrl:glow.lang.interpolate(iplayer.config.flow.loginUrl,{ptrt:window.location}),findOutMoreUrl:iplayer.config.flow.findOutMoreUrl})}}});
require.def("iplayer/models/socialdialog",["iplayer/utils/events","iplayer/models/user","iplayer/views/social"],function(k,f,g){var b=function(e){this._title=e;this._isLoggedIn=f.isLoggedIn();this._hasProfile=f.hasProfile();this._dialog=null};glow.lang.extend(b,k,{".close > a click":function(e){e.preventDefault();this.hide()},show:function(){var e=this._getDom();this._dialog=new glow.widgets.Overlay(e,{modal:true,closeOnMaskClick:false,x:"50%",y:"35%"});this.bind(this._dialog);this._dialog.show()},
hide:function(){this._dialog.hide();this._dialog=null;this.unbind();this._callback&&this._callback.call(this)},_getDom:function(){return glow.dom.create('<div id="bip-modaldialog" class="social"><h2>{title}</h2><p class="close"><a href="#">Close</a></p><p class="intro">Setting up recommendations is easy...</p>{mainContent}</div>',{interpolate:{title:this._title,mainContent:g.getCta(this._isLoggedIn,this._hasProfile)}})}});return iplayer.models.Socialdialog=b});require.def("builder/iplayer-live",function(){});
var Mustache=function(){var k=function(){};k.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(f,g,b,e){if(!e){this.context=g;this.buffer=[]}if(!this.includes("",f))if(e)return f;else{this.send(f);return}f=this.render_pragmas(f);f=this.render_section(f,g,b);if(e)return this.render_tags(f,g,b,e);this.render_tags(f,g,b,e)},send:function(f){f!=""&&this.buffer.push(f)},render_pragmas:function(f){if(!this.includes("%",f))return f;
var g=this;return f.replace(new RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(b,e,h){if(!g.pragmas_implemented[e])throw{message:"This implementation of mustache doesn't understand the '"+e+"' pragma"};g.pragmas[e]={};if(h){b=h.split("=");g.pragmas[e][b[0]]=b[1]}return""})},render_partial:function(f,g,b){f=this.trim(f);if(!b||b[f]===undefined)throw{message:"unknown_partial '"+f+"'"};if(typeof g[f]!="object")return this.render(b[f],g,b,true);return this.render(b[f],g[f],b,true)},
render_section:function(f,g,b){if(!this.includes("#",f)&&!this.includes("^",f))return f;var e=this;return f.replace(new RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(h,c,j,l){h=e.find(j,g);if(c=="^")return!h||e.is_array(h)&&h.length===0?e.render(l,g,b,true):"";else if(c=="#")return e.is_array(h)?e.map(h,function(m){return e.render(l,e.create_context(m),b,true)}).join(""):e.is_object(h)?e.render(l,e.create_context(h),
b,true):typeof h==="function"?h.call(g,l,function(m){return e.render(m,g,b,true)}):h?e.render(l,g,b,true):""})},render_tags:function(f,g,b,e){var h=this,c=function(){return new RegExp(h.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+h.ctag+"+","g")},j=c(),l=function(r,o,w){switch(o){case "!":return"";case "=":h.set_delimiters(w);j=c();return"";case ">":return h.render_partial(w,g,b);case "{":return h.find(w,g);default:return h.escape(h.find(w,g))}};f=f.split("\n");for(var m=0;m<f.length;m++){f[m]=f[m].replace(j,
l,this);e||this.send(f[m])}if(e)return f.join("\n")},set_delimiters:function(f){f=f.split(" ");this.otag=this.escape_regex(f[0]);this.ctag=this.escape_regex(f[1])},escape_regex:function(f){if(!arguments.callee.sRE)arguments.callee.sRE=new RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return f.replace(arguments.callee.sRE,"\\$1")},find:function(f,g){function b(h){return h===false||h===0||h}f=this.trim(f);var e;if(b(g[f]))e=g[f];else if(b(this.context[f]))e=this.context[f];if(typeof e===
"function")return e.apply(g);if(e!==undefined)return e;return""},includes:function(f,g){return g.indexOf(this.otag+f)!=-1},escape:function(f){f=String(f===null?"":f);return f.replace(/&(?!\w+;)|["<>\\]/g,function(g){switch(g){case "&":return"&amp;";case "\\":return"\\\\";case '"':return'"';case "<":return"&lt;";case ">":return"&gt;";default:return g}})},create_context:function(f){if(this.is_object(f))return f;else{var g=".";if(this.pragmas["IMPLICIT-ITERATOR"])g=this.pragmas["IMPLICIT-ITERATOR"].iterator;
var b={};b[g]=f;return b}},is_object:function(f){return f&&typeof f=="object"},is_array:function(f){return Object.prototype.toString.call(f)==="[object Array]"},trim:function(f){return f.replace(/^\s*|\s*$/g,"")},map:function(f,g){if(typeof f.map=="function")return f.map(g);else{for(var b=[],e=f.length,h=0;h<e;h++)b.push(g(f[h]));return b}}};return{name:"mustache.js",version:"0.3.0",to_html:function(f,g,b,e){var h=new k;if(e)h.send=e;h.render(f,g,b);if(!e)return h.buffer.join("\n")}}}();
require.def("lib/mustache",function(){});require.resume();